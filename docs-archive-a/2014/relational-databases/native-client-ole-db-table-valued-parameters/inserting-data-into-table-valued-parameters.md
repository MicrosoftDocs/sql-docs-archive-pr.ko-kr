---
title: 테이블 반환 매개 변수에 데이터 삽입 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- table-valued parameters, inserting data into
ms.assetid: 9c1a3234-4675-40d3-b473-8df06208f880
author: rothja
ms.author: jroth
ms.openlocfilehash: 38e33c6e58bc2633591fa80e095ceafe46f67045
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87649032"
---
# <a name="inserting-data-into-table-valued-parameters"></a><span data-ttu-id="bfcec-102">테이블 반환 매개 변수에 데이터 삽입</span><span class="sxs-lookup"><span data-stu-id="bfcec-102">Inserting Data into Table-Valued Parameters</span></span>
  <span data-ttu-id="bfcec-103">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]Native Client OLE DB 공급자는 소비자가 테이블 반환 매개 변수 행의 데이터를 지정 하는 두 가지 모델, 밀어넣기 모델 및 끌어오기 모델을 지원 합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-103">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider supports two models for the consumer to specify data for table valued parameter rows: a push model and a pull model.</span></span> <span data-ttu-id="bfcec-104">끌어오기 모델을 보여 주는 예제를 사용할 수 있습니다. [SQL Server 데이터 프로그래밍 예제](https://msftdpprodsamples.codeplex.com/)를 참조하십시오.</span><span class="sxs-lookup"><span data-stu-id="bfcec-104">A sample that demonstrates the pull model is available; see [SQL Server Data Programming Samples](https://msftdpprodsamples.codeplex.com/).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="bfcec-105">테이블 반환 매개 변수 열은 모든 행에 기본값이 아닌 값이 있거나 모든 행에 기본값이 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-105">A table-valued parameter column must have either non-default values in all rows or default values in all rows.</span></span> <span data-ttu-id="bfcec-106">일부 행에만 기본값이 있으면 안 됩니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-106">It is not possible to have default values in some rows but not others.</span></span> <span data-ttu-id="bfcec-107">따라서 테이블 반환 매개 변수 바인딩에서 테이블 반환 매개 변수 행 집합 열 데이터에는 DBSTATUS_S_ISNULL 및 DBSTATUS_S_OK 상태 값만 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-107">Therefore, in table-valued parameter bindings, the only status values allowed for table-valued parameter rowset column data are DBSTATUS_S_ISNULL and DBSTATUS_S_OK.</span></span> <span data-ttu-id="bfcec-108">DBSTATUS_S_DEFAULT를 사용하면 오류가 발생하며 바인딩 상태 값은 DBSTATUS_E_BADSTATUS로 설정됩니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-108">DBSTATUS_S_DEFAULT will result in a failure and the bound status value will be set to DBSTATUS_E_BADSTATUS.</span></span>  
  
## <a name="push-model-loads-all-table-valued-paremeter-data-in-memory"></a><span data-ttu-id="bfcec-109">밀어넣기 모델(모든 테이블 반환 매개 변수 데이터를 메모리에 로드)</span><span class="sxs-lookup"><span data-stu-id="bfcec-109">Push Model (Loads All Table-Valued Paremeter Data in Memory)</span></span>  
 <span data-ttu-id="bfcec-110">밀어넣기 모델은 매개 변수 집합(ICommand::Execute의 DBPARAMS 매개 변수)을 사용하는 것과 비슷합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-110">The push model is similar to the use of parameter sets (that is, the DBPARAMS parameter in ICommand::Execute).</span></span> <span data-ttu-id="bfcec-111">테이블 반환 매개 변수 행 집합 개체가 IRowset 인터페이스의 사용자 지정된 구현 없이 사용되는 경우에만 밀어넣기 모델이 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-111">The push model is only used if table-valued parameter rowset objects are used without a customized implementation of IRowset interfaces.</span></span> <span data-ttu-id="bfcec-112">밀어넣기 모델은 테이블 반환 매개 변수 행 집합의 행 수가 적어 애플리케이션에 과도한 메모리 부담을 주지 않는 경우에만 사용하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-112">The push model is recommended when the number of rows in the table-valued parameter rowset is small and is not expected to put excessive memory pressure on the application.</span></span> <span data-ttu-id="bfcec-113">이 모델은 현재 일반적인 OLE DB 애플리케이션에서 흔히 사용되는 기능 이외의 기능은 소비자 애플리케이션에 요구하지 않기 때문에 끌어오기 모델보다 간단합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-113">This is simpler than the pull model, because it does not require any more functionality from the consumer application than what is currently common in typical OLE DB applications.</span></span>  
  
 <span data-ttu-id="bfcec-114">소비자는 명령을 실행하기 전에 모든 테이블 반환 매개 변수 데이터를 공급자에게 제공해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-114">The consumer is expected to provide all the table-valued parameter data to the provider before executing a command.</span></span> <span data-ttu-id="bfcec-115">데이터를 제공하기 위해 소비자는 각 테이블 반환 매개 변수의 테이블 반환 매개 변수 행 집합 개체를 채웁니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-115">To provide the data, the consumer populates a table-valued parameter rowset object for each table-valued parameter.</span></span> <span data-ttu-id="bfcec-116">테이블 반환 매개 변수 행 집합 개체는 행 집합 삽입, 설정 및 삭제 작업을 제공하며, 소비자는 이를 사용하여 테이블 반환 매개 변수 데이터를 조작합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-116">The table-valued parameter rowset object exposes rowset Insert, Set, and Delete operations, which the consumer will use to manipulate the table-valued parameter data.</span></span> <span data-ttu-id="bfcec-117">공급자는 실행 시에 이 테이블 반환 매개 변수 행 집합 개체에서 데이터를 인출합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-117">The provider will fetch the data from this table-valued parameter rowset object at execution time.</span></span>  
  
 <span data-ttu-id="bfcec-118">테이블 반환 매개 변수 행 집합 개체가 소비자에 제공되면 소비자는 이를 행 집합 개체로 처리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-118">When a table-valued parameter rowset object is provided to the consumer, the consumer can process it as a rowset object.</span></span> <span data-ttu-id="bfcec-119">소비자는 IColumnsInfo::GetColumnInfo 또는 IColumnsRowset::GetColumnsRowset 인터페이스 메서드를 사용하여 각 열의 형식 정보(형식, 최대 길이, 전체 자릿수 및 소수 자릿수)를 가져올 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-119">The consumer can obtain the type information of each column (type, maximum length, precision, and scale) by using the IColumnsInfo::GetColumnInfo or IColumnsRowset::GetColumnsRowset interface method.</span></span> <span data-ttu-id="bfcec-120">그런 다음 소비자는 데이터에 대한 바인딩을 지정하기 위한 접근자를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-120">The consumer then creates an accessor to specify the bindings for the data.</span></span> <span data-ttu-id="bfcec-121">다음 단계는 데이터의 행을 테이블 반환 매개 변수 행 집합에 삽입하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-121">The next step is to insert rows of data into the table-valued parameter rowset.</span></span> <span data-ttu-id="bfcec-122">이 작업은 IRowsetChange::InsertRow를 사용하여 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-122">This can be done by using IRowsetChange::InsertRow.</span></span> <span data-ttu-id="bfcec-123">데이터를 조작해야 하는 경우 테이블 반환 매개 변수 행 집합 개체에 대해 IRowsetChange::SetData 또는 IRowsetChange::DeleteRows를 사용할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-123">IRowsetChange::SetData or IRowsetChange::DeleteRows can also be used on the table-valued parameter rowset object if you have to manipulate the data.</span></span> <span data-ttu-id="bfcec-124">테이블 반환 매개 변수 행 집합 개체는 스트림 개체와 비슷하게 참조 횟수가 계산됩니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-124">Table-valued parameter rowset objects are reference counted, similar to stream objects.</span></span>  
  
 <span data-ttu-id="bfcec-125">IColumnsRowset::GetColumnsRowset를 사용하는 경우 결과 열의 행 집합 개체에 대해 IRowset::GetNextRows, IRowset::GetData 및 IRowset::ReleaseRows 메서드를 다음에 호출합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-125">If IColumnsRowset::GetColumnsRowset is used, there will be subsequent calls to IRowset::GetNextRows, IRowset::GetData, and IRowset::ReleaseRows methods on the rowset object of the resulting column.</span></span>  
  
 <span data-ttu-id="bfcec-126">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]Native Client OLE DB 공급자가 명령 실행을 시작 하면이 테이블 반환 매개 변수 행 집합 개체에서 테이블 반환 매개 변수 값이 인출 되어 서버로 전송 됩니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-126">After the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider begins executing the command, the table-valued parameter values will be fetched from this table-valued parameter rowset object and sent to the server.</span></span>  
  
 <span data-ttu-id="bfcec-127">밀어넣기 모델에서는 필요한 소비자 작업이 최소화되지만 실행 시 모든 테이블 반환 매개 변수 데이터가 메모리 내에 있어야 하므로 끌어오기 모델에 비해 더 많은 메모리가 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-127">The push model requires minimal work by the consumer, but uses more memory than the pull model, because all the table-valued parameter data has to be in memory at execution time.</span></span>  
  
## <a name="pull-model-obtaining-table-valued-parameter-data-on-demand-from-the-consumer"></a><span data-ttu-id="bfcec-128">끌어오기 모델(요청 시 소비자로부터 테이블 반환 매개 변수 데이터를 가져옴)</span><span class="sxs-lookup"><span data-stu-id="bfcec-128">Pull Model (Obtaining Table-Valued Parameter Data on Demand from the Consumer)</span></span>  
 <span data-ttu-id="bfcec-129">끌어오기 모델은 다음과 같은 두 가지 경우에 유용합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-129">The pull model is useful for two scenarios:</span></span>  
  
-   <span data-ttu-id="bfcec-130">행을 스트리밍하려는 경우</span><span class="sxs-lookup"><span data-stu-id="bfcec-130">To stream rows.</span></span>  
  
-   <span data-ttu-id="bfcec-131">다른 공급자의 행 집합이 테이블 반환 매개 변수 값으로 사용되는 경우.</span><span class="sxs-lookup"><span data-stu-id="bfcec-131">If a rowset from another provider is being used as the table-valued parameter value.</span></span>  
  
 <span data-ttu-id="bfcec-132">끌어오기 모델에서는 소비자가 공급자에게 데이터를 요청 시 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-132">In the pull model, the consumer provides data on demand to the provider.</span></span> <span data-ttu-id="bfcec-133">애플리케이션에 데이터 삽입 내용이 많고, 메모리의 테이블 반환 매개 변수 행 집합 데이터로 인해 과도한 메모리 액세스가 발생할 가능성이 높은 경우 이 방법을 사용하십시오.</span><span class="sxs-lookup"><span data-stu-id="bfcec-133">Use this approach if your application has many data insertions, and table-valued parameter rowset data in memory would result in excessive memory access.</span></span> <span data-ttu-id="bfcec-134">여러 OLE DB 공급자가 사용되는 경우 소비자 끌어오기 모델을 통해 소비자는 모든 행 집합 개체를 테이블 반환 매개 변수 값으로 제공할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-134">If multiple OLE DB providers are used, the consumer pull model enables the consumer to provide any rowset object as the table-valued parameter value.</span></span>  
  
 <span data-ttu-id="bfcec-135">끌어오기 모델을 사용하려면 소비자는 행 집합 개체의 자체 구현을 제공해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-135">To use the pull model, consumers have to provide their own implementation of a rowset object.</span></span> <span data-ttu-id="bfcec-136">테이블 반환 매개 변수 행 집합(CLSID_ROWSET_TVP)과 함께 끌어오기 모델을 사용하는 경우 소비자는 공급자가 ITableDefinitionWithConstraints::CreateTableWithConstraints 메서드 또는 IOpenRowset::OpenRowset 메서드를 통해 노출하는 테이블 반환 매개 변수 행 집합 개체를 집계해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-136">When using the pull model with table-valued parameter rowsets (CLSID_ROWSET_TVP), the consumer is required to aggregate the table-valued parameter rowset object that the provider exposes through the ITableDefinitionWithConstraints::CreateTableWithConstraints method or the IOpenRowset::OpenRowset method.</span></span> <span data-ttu-id="bfcec-137">소비자 개체는 IRowset 인터페이스 구현만 재정의해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-137">The consumer object is only expected to override the IRowset interface implementation.</span></span> <span data-ttu-id="bfcec-138">다음 함수는 사용자가 재정의해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-138">You must override the following functions:</span></span>  
  
-   <span data-ttu-id="bfcec-139">IRowset::GetNextRows</span><span class="sxs-lookup"><span data-stu-id="bfcec-139">IRowset::GetNextRows</span></span>  
  
-   <span data-ttu-id="bfcec-140">IRowset::AddRefRows</span><span class="sxs-lookup"><span data-stu-id="bfcec-140">IRowset::AddRefRows</span></span>  
  
-   <span data-ttu-id="bfcec-141">IRowset::GetData</span><span class="sxs-lookup"><span data-stu-id="bfcec-141">IRowset::GetData</span></span>  
  
-   <span data-ttu-id="bfcec-142">IRowset::ReleaseRows</span><span class="sxs-lookup"><span data-stu-id="bfcec-142">IRowset::ReleaseRows</span></span>  
  
-   <span data-ttu-id="bfcec-143">IRowset::RestartPosition</span><span class="sxs-lookup"><span data-stu-id="bfcec-143">IRowset::RestartPosition</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="bfcec-144">Native Client OLE DB 공급자는 소비자 행 집합 개체에서 한 번에 하나 이상의 행을 읽어 테이블 반환 매개 변수의 스트리밍 동작을 지원합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-144">Native Client OLE DB Provider will read one or more rows at a time from the consumer rowset object to support streaming behavior in table-valued parameters.</span></span> <span data-ttu-id="bfcec-145">예를 들어 사용자의 테이블 반환 매개 변수 행 집합 데이터가 메모리가 아닌 디스크에 있고 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB 공급자에서 해당 데이터를 요구하는 경우 사용자가 디스크에서 데이터를 읽는 기능을 구현할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-145">For example, the user might have the table-valued parameter rowset data on disk (not in memory) and might implement the functionality to read data from the disk when required by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider.</span></span>  
  
 <span data-ttu-id="bfcec-146">소비자는 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 테이블 반환 매개 변수 행 집합 개체에 대해 IAccessor:: CreateAccessor를 사용 하 여 해당 데이터 형식을 Native Client OLE DB 공급자에 게 전달 합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-146">The consumer will communicate its data format to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider by using IAccessor::CreateAccessor on the table-valued parameter rowset object.</span></span> <span data-ttu-id="bfcec-147">공급자는 소비자 버퍼에서 데이터를 읽을 때 최소한 하나의 접근자 핸들을 통해 쓰기 가능하고 기본 열이 아닌 모든 열을 사용할 수 있는지 확인하고, 해당 핸들을 사용하여 열 데이터를 읽습니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-147">When reading data from the consumer buffer, the provider verifies that all the writable and non-default columns are available through at least one accessor handle, and uses the corresponding handles to read columns data.</span></span> <span data-ttu-id="bfcec-148">모호성을 피하려면 테이블 반환 매개 변수 행 집합 열과 바인딩이 일 대 일로 대응해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-148">To avoid ambiguity, there should be a one-to-one correspondence between a table-valued parameter rowset column and a binding.</span></span> <span data-ttu-id="bfcec-149">동일한 열에 대한 중복 바인딩은 오류를 일으킵니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-149">Duplicate bindings to the same column will result in an error.</span></span> <span data-ttu-id="bfcec-150">또한 각 접근자에는 DBBindings의 *iOrdinal* 멤버가 순서대로 포함되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-150">Also, each accessor is expected to have the *iOrdinal* member of DBBindings in sequence.</span></span> <span data-ttu-id="bfcec-151">IRowset::GetData는 행당 접근자 수만큼 호출되며 *iOrdinal* 값을 기반으로 낮은 값에서 높은 값 순서로 호출됩니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-151">There will be as many calls to IRowset::GetData as the number of accessors per row, and the order of calls will be based on the order of *iOrdinal* value from lower to higher values.</span></span>  
  
 <span data-ttu-id="bfcec-152">공급자는 테이블 반환 매개 변수 행 집합 개체에 의해 제공되는 인터페이스의 대부분을 구현해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-152">The provider is expected to implement most of the interfaces exposed by the table-valued parameter rowset object.</span></span> <span data-ttu-id="bfcec-153">소비자는 최소한의 인터페이스(IRowset)로 행 집합 개체를 구현합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-153">The consumer will implement a rowset object with minimal interfaces (IRowset).</span></span> <span data-ttu-id="bfcec-154">무계획적인 집계로 인해 남은 필수 행 집합 개체 인터페이스는 테이블 반환 매개 변수 행 집합 개체에 의해 구현됩니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-154">Because of blind aggregation, the remaining mandatory rowset object interfaces will be implemented by the table-valued parameter rowset object.</span></span>  
  
 <span data-ttu-id="bfcec-155">OLE DB 공급자에 대해 가져온 행 집합 개체를 비롯한 다른 모든 행 집합 개체의 경우 소비자가 제공한 행 집합은 OLE DB 사양에 지정된 대로 모든 필수 행 집합 개체 인터페이스를 구현해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-155">For any other rowset object, such as rowset objects obtained for any OLE DB provider, the consumer-provided rowset must implement all the mandatory rowset object interfaces as specified in the OLE DB specification.</span></span>  
  
 <span data-ttu-id="bfcec-156">실행 시점에 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB 공급자는 행 집합 개체를 호출하여 행을 인출하고 열 데이터를 읽습니다.</span><span class="sxs-lookup"><span data-stu-id="bfcec-156">At the time of execution, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider will call back to the rowset object to fetch rows and read column data.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="bfcec-157">참고 항목</span><span class="sxs-lookup"><span data-stu-id="bfcec-157">See Also</span></span>  
 <span data-ttu-id="bfcec-158">[테이블 반환 매개 변수 OLE DB &#40;&#41;](table-valued-parameters-ole-db.md) </span><span class="sxs-lookup"><span data-stu-id="bfcec-158">[Table-Valued Parameters &#40;OLE DB&#41;](table-valued-parameters-ole-db.md) </span></span>  
 [<span data-ttu-id="bfcec-159">테이블 반환 매개 변수&#40;OLE DB&#41; 사용</span><span class="sxs-lookup"><span data-stu-id="bfcec-159">Use Table-Valued Parameters &#40;OLE DB&#41;</span></span>](../native-client-ole-db-how-to/use-table-valued-parameters-ole-db.md)  
  
