---
title: 공간 인덱스 개요 | Microsoft 문서
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- spatial indexes [SQL Server]
ms.assetid: b1ae7b78-182a-459e-ab28-f743e43f8293
author: MladjoA
ms.author: mlandzic
ms.openlocfilehash: 36406bd60b4204469aca3d20862020870a8832fe
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87652057"
---
# <a name="spatial-indexes-overview"></a><span data-ttu-id="038d2-102">공간 인덱스 개요</span><span class="sxs-lookup"><span data-stu-id="038d2-102">Spatial Indexes Overview</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="038d2-103">에서는 공간 데이터 및 공간 인덱스를 지원합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-103">supports spatial data and spatial indexes.</span></span> <span data-ttu-id="038d2-104">*공간 인덱스* 는 공간 열을 인덱싱할 수 있는 확장된 인덱스의 유형입니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-104">A *spatial index* is a type of extended index that allows you to index a spatial column.</span></span> <span data-ttu-id="038d2-105">공간 열은 `geometry` 또는 `geography`와 같은 공간 데이터 형식의 데이터를 포함하는 테이블 열입니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-105">A spatial column is a table column that contains data of a spatial data type, such as `geometry` or `geography`.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="038d2-106">[!INCLUDE[ssSQL11](../../includes/sssql11-md.md)]에서 도입된 공간 기능에 대한 자세한 설명 및 예와 공간 인덱스에 영향을 주는 기능에 대한 정보를 보려면 [SQL Server 2012의 새로운 공간 기능](https://go.microsoft.com/fwlink/?LinkId=226407)백서를 다운로드하세요.</span><span class="sxs-lookup"><span data-stu-id="038d2-106">For a detailed description and examples of spatial features introduced in [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)], including features that affect spatial indexes, download the white paper, [New Spatial Features in SQL Server 2012](https://go.microsoft.com/fwlink/?LinkId=226407).</span></span>

##  <a name="about-spatial-indexes"></a><a name="about"></a> <span data-ttu-id="038d2-107">공간 인덱스 정보</span><span class="sxs-lookup"><span data-stu-id="038d2-107">About Spatial Indexes</span></span>

###  <a name="decomposing-indexed-space-into-a-grid-hierarchy"></a><a name="decompose"></a> <span data-ttu-id="038d2-108">인덱싱된 공간을 표 계층 구조로 분해</span><span class="sxs-lookup"><span data-stu-id="038d2-108">Decomposing Indexed Space into a Grid Hierarchy</span></span>
 <span data-ttu-id="038d2-109">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]에서 공간 인덱스는 B-트리를 사용하여 구성됩니다. 즉, 인덱스가 2차원 공간 데이터를 B-트리의 선형 순서로 나타내야 한다는 뜻입니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-109">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], spatial indexes are built using B-trees, which means that the indexes must represent the 2-dimensional spatial data in the linear order of B-trees.</span></span> <span data-ttu-id="038d2-110">따라서 데이터를 공간 인덱스로 읽기 전에 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 에서는 공간을 계층적으로 균일하게 분해하는 작업을 구현해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-110">Therefore, before reading data into a spatial index, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] implements a hierarchical uniform decomposition of space.</span></span> <span data-ttu-id="038d2-111">인덱스 생성 프로세스에서는 공간을 4-수준 *표 계층 구조* 로 *분해*합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-111">The index-creation process *decomposes* the space into a four-level *grid hierarchy*.</span></span> <span data-ttu-id="038d2-112">이러한 수준은 *수준 1* (최상위 수준), *수준 2*, *수준 3*및 *수준 4*라고 합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-112">These levels are referred to as *level 1* (the top level), *level 2*, *level 3*, and *level 4*.</span></span>

 <span data-ttu-id="038d2-113">각각의 연속되는 수준이 이전 수준을 더 분해하므로 각 상위 수준의 셀은 다음 수준에서 완전한 표를 포함하게 됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-113">Each successive level further decomposes the level above it, so each upper-level cell contains a complete grid at the next level.</span></span> <span data-ttu-id="038d2-114">지정된 수준에서 모든 표에는 양쪽 축(예: 4x4 또는 8x8)을 따라 동일한 셀 개수가 있으며 셀의 크기는 모두 같습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-114">On a given level, all the grids have the same number of cells along both axes (for example, 4x4 or 8x8), and the cells are all one size.</span></span>

 <span data-ttu-id="038d2-115">다음 그림에서는 표 계층 구조의 각 수준에서 오른쪽 상단의 셀을 4x4 표로 분해하는 것을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-115">The following illustration shows the decomposition for the upper-right cell at each level of the grid hierarchy into a 4x4 grid.</span></span> <span data-ttu-id="038d2-116">실제로 모든 셀이 이러한 방식으로 분해됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-116">In reality, all the cells are decomposed in this way.</span></span> <span data-ttu-id="038d2-117">즉, 예를 들어 공간을 4x4 표의 4-수준으로 분해하면 총 65,536수준의 셀 4개가 실제로 생성됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-117">Thus, for example, decomposing a space into four levels of 4x4 grids actually produces a total of 65,536 level-four cells.</span></span>

 <span data-ttu-id="038d2-118">![재귀 공간 분할(tessellation)의 4개 수준](../../database-engine/media/spndx-recursive-levels-telescoped.gif "재귀 공간 분할(tessellation)의 4가지 수준")</span><span class="sxs-lookup"><span data-stu-id="038d2-118">![Four-levels of recursive tessellation](../../database-engine/media/spndx-recursive-levels-telescoped.gif "Four-levels of recursive tessellation")</span></span>

> [!NOTE]
>  <span data-ttu-id="038d2-119">공간 인덱스에 대한 공간 분해는 애플리케이션 데이터에서 사용하는 측정 단위의 영향을 받지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-119">The decomposition of space for a spatial index is independent of the unit of measurement that the application data uses.</span></span>

 <span data-ttu-id="038d2-120">표 계층 구조 셀은 힐베르트 공간 채움 곡선의 변형을 사용하여 선형으로 번호가 매겨집니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-120">Grid hierarchy cells are numbered in a linear fashion by using a variation of the Hilbert space-filling curve.</span></span> <span data-ttu-id="038d2-121">그러나 이해하기 쉽도록 이 설명에서는 힐베르트 곡선에 따라 실제로 생성되는 번호 매기기 대신 간단한 행 단위 번호 매기기를 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-121">For the purpose of illustration, however, this discussion uses a simple row-wise numbering, instead of the numbering that is actually produced by the Hilbert curve.</span></span> <span data-ttu-id="038d2-122">다음 그림에서는 건물을 나타내는 여러 다각형과 도로를 나타내는 선이 이미 4x4, 수준-1 표에 배치되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-122">In the following illustration, several polygons that represent buildings, and lines that represent streets, have already been placed into a 4x4, level-1 grid.</span></span> <span data-ttu-id="038d2-123">수준-1 셀은 상단 왼쪽 셀에서부터 1에서 16까지 번호가 매겨져 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-123">The level-1 cells are numbered from 1 through 16, starting with the upper-left cell.</span></span>

 <span data-ttu-id="038d2-124">![4x4 수준 1 표에 배치된 다각형 및 선](../../database-engine/media/spndx-level-1-objects.gif "4x4 수준 1 표에 배치된 다각형 및 선")</span><span class="sxs-lookup"><span data-stu-id="038d2-124">![Polygons and lines placed into a 4x4 level-1 grid](../../database-engine/media/spndx-level-1-objects.gif "Polygons and lines placed into a 4x4 level-1 grid")</span></span>

#### <a name="grid-density"></a><span data-ttu-id="038d2-125">표 밀도</span><span class="sxs-lookup"><span data-stu-id="038d2-125">Grid Density</span></span>
 <span data-ttu-id="038d2-126">표의 축에 따른 셀 수로 표의 *밀도*가 결정되며 셀 수가 많을수록 표의 밀도가 높습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-126">The number of cells along the axes of a grid determines its *density*: the larger the number, the denser the grid.</span></span> <span data-ttu-id="038d2-127">예를 들어 8x8 표(64개의 셀을 생성함)는 4x4 표(16개의 셀을 생성함)보다 밀도가 높습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-127">For example, an 8x8 grid (which produces 64 cells), is denser than a 4x4 grid (which produces 16 cells).</span></span> <span data-ttu-id="038d2-128">표 밀도는 수준별 기준으로 정의됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-128">Grid density is defined on a per-level basis.</span></span>

 <span data-ttu-id="038d2-129">공간 인덱스의 [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] 문은 각 수준별로 다른 표 밀도를 지정할 수 있는 GRIDS 절을 지원합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-129">The [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement supports a GRIDS clause that enables you to specify different grid densities at different levels.</span></span> <span data-ttu-id="038d2-130">다음 키워드 중 하나를 사용하여 지정된 수준의 표 밀도를 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-130">The grid density for a given level is specified by using one of the following keywords.</span></span>

|<span data-ttu-id="038d2-131">키워드</span><span class="sxs-lookup"><span data-stu-id="038d2-131">Keyword</span></span>|<span data-ttu-id="038d2-132">표 구성</span><span class="sxs-lookup"><span data-stu-id="038d2-132">Grid configuration</span></span>|<span data-ttu-id="038d2-133">셀 개수</span><span class="sxs-lookup"><span data-stu-id="038d2-133">Number of cells</span></span>|
|-------------|------------------------|---------------------|
|<span data-ttu-id="038d2-134">LOW</span><span class="sxs-lookup"><span data-stu-id="038d2-134">LOW</span></span>|<span data-ttu-id="038d2-135">4X4</span><span class="sxs-lookup"><span data-stu-id="038d2-135">4X4</span></span>|<span data-ttu-id="038d2-136">16</span><span class="sxs-lookup"><span data-stu-id="038d2-136">16</span></span>|
|<span data-ttu-id="038d2-137">MEDIUM</span><span class="sxs-lookup"><span data-stu-id="038d2-137">MEDIUM</span></span>|<span data-ttu-id="038d2-138">8X8</span><span class="sxs-lookup"><span data-stu-id="038d2-138">8X8</span></span>|<span data-ttu-id="038d2-139">64</span><span class="sxs-lookup"><span data-stu-id="038d2-139">64</span></span>|
|<span data-ttu-id="038d2-140">HIGH</span><span class="sxs-lookup"><span data-stu-id="038d2-140">HIGH</span></span>|<span data-ttu-id="038d2-141">16X16</span><span class="sxs-lookup"><span data-stu-id="038d2-141">16X16</span></span>|<span data-ttu-id="038d2-142">256</span><span class="sxs-lookup"><span data-stu-id="038d2-142">256</span></span>|

 <span data-ttu-id="038d2-143">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]에서 데이터베이스 호환성 수준이 100 이하로 설정된 경우 모든 수준의 기본값은 MEDIUM입니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-143">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], when the database compatibility level is set to 100 or lower, then the default is MEDIUM on all levels.</span></span> <span data-ttu-id="038d2-144">데이터베이스 호환성 수준이 110 이상으로 설정된 경우에는 기본값이 자동 표 구성표입니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-144">When the database compatibility level is set to 110 or higher, then the default is an auto grid scheme.</span></span>

 <span data-ttu-id="038d2-145">기본값이 아닌 표 밀도를 지정하여 분해 프로세스를 제어할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-145">You can control the decomposition process by specifying non-default grid densities.</span></span> <span data-ttu-id="038d2-146">예를 들어 각 수준별로 서로 다른 표 밀도는 인덱싱된 공간의 크기와 공간 열의 개체를 기준으로 인덱스를 미세하게 조정하는 데 유용할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-146">For example, different grid densities on different levels might be useful for fine tuning an index based on the size of the indexed space and the objects in the spatial column.</span></span>

> [!NOTE]
>  <span data-ttu-id="038d2-147">공간 인덱스의 표 밀도는 데이터베이스 호환성 수준이 100 이하로 설정된 경우 [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) 카탈로그 뷰의 level_1_grid, level_2_grid, level_3_grid 및 level_4_grid 열에서 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-147">The grid densities of a spatial index are visible in the level_1_grid, level_2_grid, level_3_grid, and level_4_grid columns of the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view when the database compatibility level is set to 100 or lower.</span></span> <span data-ttu-id="038d2-148">`GEOMETRY_AUTO_GRID` / `GEOGRAPHY_AUTO_GRID` 공간 분할 (tessellation) 구성표 옵션은 이러한 열을 채우지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-148">The `GEOMETRY_AUTO_GRID`/`GEOGRAPHY_AUTO_GRID` tessellation scheme options do not populate these columns.</span></span> <span data-ttu-id="038d2-149">`NULL`자동 표 옵션이 사용 된 경우에는 spatial_index_tessellations 카탈로그 뷰에 이러한 열에 대 한 값이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-149">sys.spatial_index_tessellations catalog view has `NULL` values for these columns when the auto grid options are used.</span></span>

###  <a name="tessellation"></a><a name="tessellation"></a><span data-ttu-id="038d2-150">분할</span><span class="sxs-lookup"><span data-stu-id="038d2-150">Tessellation</span></span>
 <span data-ttu-id="038d2-151">인덱싱된 공간을 표 계층 구조로 분해한 후 공간 인덱스는 공간 열에서 데이터를 한 번에 한 행씩 읽습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-151">After decomposition of an indexed space into a grid hierarchy, the spatial index reads the data from the spatial column, row by row.</span></span> <span data-ttu-id="038d2-152">공간 개체나 인스턴스의 데이터를 읽은 후 공간 인덱스는 해당 개체에 대해 *공간 분할 프로세스* 를 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-152">After reading the data for a spatial object (or instance), the spatial index performs a *tessellation process* for that object.</span></span> <span data-ttu-id="038d2-153">공간 분할 프로세스는 개체를 표 형태 셀의 집합과 연결하여(*연결된 셀*) 개체를 표 계층 구조에 맞게 조정합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-153">The tessellation processfits the object into the grid hierarchy by associating the object with a set of grid cells that it touches (*touched cells*).</span></span> <span data-ttu-id="038d2-154">표 계층 구조의 수준 1에서 시작하면 공간 분할 프로세스는 전체 수준에서 *너비 우선* 으로 진행됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-154">Starting at level 1 of the grid hierarchy, the tessellation process proceeds *breadth first* across the level.</span></span> <span data-ttu-id="038d2-155">이 프로세스는 한 번에 한 수준씩 4-수준 전체에서 계속 진행될 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-155">Potentially, the process can continue through all four levels, one level at a time.</span></span>

 <span data-ttu-id="038d2-156">공간 분할 프로세스의 출력은 개체의 공간 인덱스에 기록된 연결된 셀의 집합입니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-156">The output of the tessellation process is a set of touched cells that are recorded in the spatial index for the object.</span></span> <span data-ttu-id="038d2-157">이러한 기록된 셀을 참조함으로써 공간 인덱스는 인덱스에도 저장된 공간 열의 다른 개체와 연관된 공간에 개체를 배치할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-157">By referring to these recorded cells, the spatial index can locate the object in space relative to other objects in the spatial column that are also stored in the index.</span></span>

#### <a name="tessellation-rules"></a><span data-ttu-id="038d2-158">공간 분할 규칙</span><span class="sxs-lookup"><span data-stu-id="038d2-158">Tessellation Rules</span></span>
 <span data-ttu-id="038d2-159">개체에 대해 기록된 연결된 셀 개수를 제한하기 위해 공간 분할 프로세스에서는 여러 가지 공간 분할 규칙을 적용합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-159">To limit the number of touched cells that are recorded for an object, the tessellation process applies several tessellation rules.</span></span> <span data-ttu-id="038d2-160">이러한 규칙은 공간 분할 프로세스와 인덱스에 기록된 연결된 셀의 깊이를 결정합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-160">These rules determine the depth of the tessellation process and which of the touched cells are recorded in the index.</span></span>

 <span data-ttu-id="038d2-161">이러한 규칙은 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-161">These rules are as follows:</span></span>

-   <span data-ttu-id="038d2-162">포함 규칙</span><span class="sxs-lookup"><span data-stu-id="038d2-162">The covering rule</span></span>

     <span data-ttu-id="038d2-163">개체가 한 셀을 완전히 포함할 경우 해당 셀은 개체에 의해 *포함* 되어 있다고 합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-163">If the object completely covers a cell, that cell is said to be *covered* by the object.</span></span> <span data-ttu-id="038d2-164">포함된 셀은 개수가 계산되지만 공간 분할이 수행되지는 않습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-164">A covered cell is counted and is not tessellated.</span></span> <span data-ttu-id="038d2-165">이 규칙은 표 계층 구조의 모든 수준에 적용됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-165">This rule applies at all levels of the grid hierarchy.</span></span> <span data-ttu-id="038d2-166">포함 규칙은 공간 분할 프로세스를 단순화하고 공간 인덱스에 기록된 데이터의 양을 감소시킵니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-166">The covering rule simplifies the tessellation process and reduces the amount of data that a spatial index records.</span></span>

-   <span data-ttu-id="038d2-167">개체당 셀 수 규칙</span><span class="sxs-lookup"><span data-stu-id="038d2-167">The cells-per-object rule</span></span>

     <span data-ttu-id="038d2-168">이 규칙은 *개체당 셀 수 제한*을 적용하여 각 개체에 대해 계산될 수 있는 최대 셀 수를 결정합니다(수준 1은 제외).</span><span class="sxs-lookup"><span data-stu-id="038d2-168">This rule enforces the *cells-per-object limit*, which determines the maximum number of cells that can be counted for each object, except on level 1.</span></span> <span data-ttu-id="038d2-169">하위 수준에서 개체당 셀 수 규칙은 개체에 대해 기록될 수 있는 정보량을 제어합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-169">At lower levels, the cells-per-object rule controls the amount of information that can be recorded about the object.</span></span>

-   <span data-ttu-id="038d2-170">최하위 셀 규칙</span><span class="sxs-lookup"><span data-stu-id="038d2-170">The deepest-cell rule</span></span>

     <span data-ttu-id="038d2-171">최하위 셀 규칙은 개체에 대해 공간 분할된 최하위 셀만 기록하여 최적의 개체 근사값을 생성합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-171">The deepest-cell rule generates the best approximation of an object by recording only the bottom-most cells that have been tessellated for the object.</span></span> <span data-ttu-id="038d2-172">부모 셀은 개체당 셀 수 계산에 영향을 주지 않으며 인덱스에 기록되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-172">Parent cells do not contribute to the cells-per-object count, and they are not recorded in the index.</span></span>

 <span data-ttu-id="038d2-173">이러한 공간 분할 규칙은 표 수준마다 반복하여 적용됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-173">These tessellation rules are applied recursively on each grid level.</span></span> <span data-ttu-id="038d2-174">이 섹션의 나머지 부분에서는 공간 분할 규칙을 좀 더 자세히 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-174">The rest of this section describes the tessellation rules in more detail.</span></span>

#### <a name="covering-rule"></a><span data-ttu-id="038d2-175">포함 규칙</span><span class="sxs-lookup"><span data-stu-id="038d2-175">Covering Rule</span></span>
 <span data-ttu-id="038d2-176">개체가 한 셀을 완전히 포함할 경우 해당 셀은 개체에 의해 *포함* 되어 있다고 합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-176">If an object completely covers a cell, that cell is said to be *covered* by the object.</span></span> <span data-ttu-id="038d2-177">예를 들어 다음 그림에서 2-수준 셀 중 하나(15.11)가 팔각형의 가운데 위치에 완전히 포함되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-177">For example, in the following illustration, one of the second-level cells, 15.11, is completely covered by the middle portion of an octagon.</span></span>

 <span data-ttu-id="038d2-178">![포함 최적화](../../database-engine/media/spndx-opt-covering.gif "포함 최적화")</span><span class="sxs-lookup"><span data-stu-id="038d2-178">![Covering optimization](../../database-engine/media/spndx-opt-covering.gif "Covering optimization")</span></span>

 <span data-ttu-id="038d2-179">포함된 셀은 개수가 계산되고 인덱스에 기록되지만 더 이상 공간 분할이 수행되지는 않습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-179">A covered cell is counted and recorded in the index, and the cell is not tessellated any further.</span></span>

#### <a name="cells-per-object-rule"></a><span data-ttu-id="038d2-180">개체당 셀 수 규칙</span><span class="sxs-lookup"><span data-stu-id="038d2-180">Cells-Per-Object Rule</span></span>
 <span data-ttu-id="038d2-181">각 개체의 공간 분할 범위는 주로 공간 인덱스의 *개체당 셀 수 제한* 의 영향을 받습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-181">The extent of tessellation of each object depends primarily on the *cells-per-object limit* of the spatial index.</span></span> <span data-ttu-id="038d2-182">이 제한은 공간 분할에서 개체당 계산할 수 있는 최대 셀 수를 정의합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-182">This limit defines the maximum number of cells that tessellation can count per object.</span></span> <span data-ttu-id="038d2-183">그러나 개체당 셀 수 규칙은 수준 1에 적용되지 않으므로 이 제한이 초과될 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-183">Note, however, that the cells-per-object rule is not enforced for level 1, so it is possible to exceed this limit.</span></span> <span data-ttu-id="038d2-184">수준-1 개수가 개체당 셀 수 제한에 도달하거나 초과할 경우 하위 수준에서 더 이상의 공간 분할이 발생하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-184">If the level-1 count reaches, or exceeds, the cells-per-object limit, no further tessellation occurs at the lower levels.</span></span>

 <span data-ttu-id="038d2-185">해당 개수가 개체당 셀 수보다 적은 한 공간 분할 프로세스는 계속 진행됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-185">As long as the count is less than the cells-per-object limit, the tessellation process continues.</span></span> <span data-ttu-id="038d2-186">공간 분할하는 셀이 개체당 셀 수 제한을 초과하면 해당 셀은 개수가 계산되고 공간 분할이 수행되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-186">Starting with the lowest-number touched cell (for example, cell 15.6 in the preceding illustration), the process tests each cell to evaluate whether to count it or tessellate it.</span></span> <span data-ttu-id="038d2-187">공간 분할한 셀이 개체당 셀 수 제한을 초과하면 해당 셀은 개수가 계산되지 않고 공간 분할이 수행되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-187">If tessellating a cell would exceed the cells-per-object limit, the cell is counted and not tessellated.</span></span> <span data-ttu-id="038d2-188">그렇지 않은 경우 해당 셀은 공간 분할이 수행되고 개체와 연결된 하위 수준 셀의 개수가 계산됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-188">Otherwise, the cell is tessellated, and the lower-level cells that are touched by the object are counted.</span></span> <span data-ttu-id="038d2-189">공간 분할 프로세스는 전체 수준에서 이런 방식으로 계속 진행됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-189">The tessellation process continues in this way, breadth-wise, across the level.</span></span> <span data-ttu-id="038d2-190">이 프로세스는 제한에 도달하거나 더 이상 계산할 셀이 없을 때까지 공간 분할이 수행된 셀의 하위 수준 표에 대해 계속 반복됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-190">This process is repeated recursively for the lower-level grids of the tessellated cells until the limit is reached or there are no more cells to count.</span></span>

 <span data-ttu-id="038d2-191">예를 들어 수준-1 표의 셀 15에 꼭 맞는 팔각형을 보여 주는 위의 그림을 검토해 봅니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-191">For example, consider the preceding illustration, which shows an octagon that fits completely into cell 15 of the level-1 grid.</span></span> <span data-ttu-id="038d2-192">그림에서는 팔각형을 수준-2의 셀 9개로 나누어서 셀 15가 공간 분할되었습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-192">In the figure, cell 15 has been tessellated, dissecting the octagon into nine level-2 cells.</span></span> <span data-ttu-id="038d2-193">이 그림에서는 개체당 셀 수 제한을 9개 이상으로 가정합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-193">This illustration assumes that the cells-per-object limit is 9 or more.</span></span> <span data-ttu-id="038d2-194">개체당 셀 수 제한이 8개 이하라면 셀 15는 공간 분할되지 않고 해당 셀 15만 개체의 개수로 계산됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-194">If the cells-per-object limit were 8 or less, however, cell 15 would not be tessellated, and only that cell 15 would be counted for the object.</span></span>

 <span data-ttu-id="038d2-195">기본적으로 대부분의 공간 인덱스에 대해 공간과 자릿수 간의 적절한 균형을 이루는 개체당 셀 수 제한은 개체당 셀 16개입니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-195">By default, the cells-per-object limit is 16 cells per object, which provides a satisfactory trade-off between space and precision for most spatial indexes.</span></span> <span data-ttu-id="038d2-196">그러나 [CREATE 공간 인덱스](/sql/t-sql/statements/create-spatial-index-transact-sql) [!INCLUDE[tsql](../../../includes/tsql-md.md)] 문은 CELLS_PER_OBJECT `=` *n* 절을 지원 합니다 .이 절을 사용 하면 1과 8192 (포함) 사이의 개체당 셀 수 제한을 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-196">However, the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement supports a CELLS_PER_OBJECT`=`*n* clause that enables you to specify a cells-per-object limit between 1 and 8192, inclusive.</span></span>

> [!NOTE]
>  <span data-ttu-id="038d2-197">공간 인덱스의 **cells_per_object** 설정은 [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) 카탈로그 뷰에서 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-197">The **cells_per_object** setting of a spatial index is visible in the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view.</span></span>

#### <a name="deepest-cell-rule"></a><span data-ttu-id="038d2-198">최하위 셀 규칙</span><span class="sxs-lookup"><span data-stu-id="038d2-198">Deepest-Cell Rule</span></span>
 <span data-ttu-id="038d2-199">최하위 셀 규칙은 모든 하위 셀이 상위 셀에 속한다는 사실을 활용합니다. 즉, 수준-4 셀은 수준-3 셀에 속하고, 수준-3 셀은 수준-2 셀에 속하며, 수준-2 셀은 수준-1 셀에 속합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-199">The deepest-cell rule exploits the fact that every lower-level cell belongs to the cell above it: a level-4 cell belongs to a level-3 cell, a level-3 cell belongs to a level-2 cell, and a level-2 cell belongs to a level-1 cell.</span></span> <span data-ttu-id="038d2-200">예를 들어 셀 1.1.1.1에 속하는 개체는 셀 1.1.1, 셀 1.1 및 셀 1에도 속합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-200">For example, an object that belongs to cell 1.1.1.1 also belongs to cell 1.1.1, cell 1.1, and cell 1.</span></span> <span data-ttu-id="038d2-201">이러한 셀 계층 관계에 대한 정보는 쿼리 프로세서에 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-201">Knowledge of such cell-hierarchy relationships is built into the query processor.</span></span> <span data-ttu-id="038d2-202">따라서 인덱스가 저장해야 하는 정보를 최소화하기 위해 최하위 수준의 셀만 인덱스에 기록해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-202">Therefore, only the deepest-level cells need to be recorded in the index, minimizing the information that the index needs to store.</span></span>

 <span data-ttu-id="038d2-203">다음 그림에서는 비교적 작은 다이아몬드형 다각형이 공간 분할되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-203">In the following illustration, a relatively small diamond-shaped polygon is tessellated.</span></span> <span data-ttu-id="038d2-204">인덱스는 개체당 셀 수로 기본값 16을 사용하며 이 값은 이러한 작은 개체로는 도달되지 않는 값입니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-204">The index uses the default cells-per-object limit of 16, which is not reached for this small object.</span></span> <span data-ttu-id="038d2-205">따라서 공간 분할은 수준 4까지 계속되며,</span><span class="sxs-lookup"><span data-stu-id="038d2-205">Therefore, tessellation continues down to level 4.</span></span> <span data-ttu-id="038d2-206">다각형은 수준-1에서 수준-3 셀까지 4, 4.4, 4.4.10 및 4.4.14에 위치합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-206">The polygon resides in the following level-1 through level-3 cells: 4, 4.4, and 4.4.10 and 4.4.14.</span></span> <span data-ttu-id="038d2-207">그러나 최하위 셀 규칙을 사용하면 공간 분할에서는 수준-4 셀 12개만(4.4.10.13-15, 4.4.14.1-3, 4.4.14.5-7, 4.4.14.9-11 등) 계산합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-207">However, using the deepest-cell rule, the tessellation counts only the twelve level-4 cells: 4.4.10.13-15 and 4.4.14.1-3, 4.4.14.5-7, and 4.4.14.9-11.</span></span>

 <span data-ttu-id="038d2-208">![최하위 셀 최적화](../../database-engine/media/spndx-opt-deepest-cell.gif "최하위 셀 최적화")</span><span class="sxs-lookup"><span data-stu-id="038d2-208">![Deepest-cell optimization](../../database-engine/media/spndx-opt-deepest-cell.gif "Deepest-cell optimization")</span></span>

###  <a name="tessellation-schemes"></a><a name="schemes"></a><span data-ttu-id="038d2-209">공간 분할 구성표</span><span class="sxs-lookup"><span data-stu-id="038d2-209">Tessellation Schemes</span></span>
 <span data-ttu-id="038d2-210">공간 인덱스의 동작은 부분적으로 해당 *공간 분할(tessellation) 구성표*의 영향을 받습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-210">The behavior of a spatial index depends partly on its *tessellation scheme*.</span></span> <span data-ttu-id="038d2-211">공간 분할(tessellation) 구성표는 데이터 형식에 따라 달라집니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-211">The tessellation scheme is data-type specific.</span></span> <span data-ttu-id="038d2-212">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]에서 공간 인덱스는 두 가지 공간 분할(tessellation) 구성표를 지원합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-212">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], spatial indexes support two tessellation schemes:</span></span>

-   <span data-ttu-id="038d2-213">*기 하 도형 표 공간 분할*-데이터 형식에 대 한 스키마입니다 `geometry` .</span><span class="sxs-lookup"><span data-stu-id="038d2-213">*Geometry grid tessellation*, which is the scheme for the `geometry` data type.</span></span>

-   <span data-ttu-id="038d2-214">*지리 표 공간 분할*-데이터 형식의 열에 적용 됩니다 `geography` .</span><span class="sxs-lookup"><span data-stu-id="038d2-214">*Geography grid tessellation*, which applies to columns of the `geography` data type.</span></span>

> [!NOTE]
>  <span data-ttu-id="038d2-215">공간 인덱스의 **tessellation_scheme** 설정은 [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) 카탈로그 뷰에서 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-215">The **tessellation_scheme** setting of a spatial index is visible in the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view.</span></span>

#### <a name="geometry-grid-tessellation-scheme"></a><span data-ttu-id="038d2-216">기하 도형 표 공간 분할(tessellation) 구성표</span><span class="sxs-lookup"><span data-stu-id="038d2-216">Geometry Grid Tessellation Scheme</span></span>
 <span data-ttu-id="038d2-217">GEOMETRY_AUTO_GRID 공간 분할은 `geometry` 이상에서 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 데이터 형식의 기본 공간 분할(tessellation) 구성표입니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-217">GEOMETRY_AUTO_GRID tessellation is the default tessellation scheme for the `geometry` data type for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and later.</span></span>  <span data-ttu-id="038d2-218">GEOMETRY_GRID 공간 분할은 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]에서 geometry 데이터 형식에 사용할 수 있는 유일한 공간 분할(tessellation) 구성표입니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-218">GEOMETRY_GRID tessellation is the only tessellation scheme available for geometry data types in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="038d2-219">이 섹션에서는 공간 인덱스 작업과 연관된 기하 도형 표 공간 분할의 측면에서 지원되는 메서드 및 경계 상자에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-219">This section discusses aspects of geometry grid tessellation that are relevant to working with spatial indexes: supported methods and bounding boxes.</span></span>

> [!NOTE]
>  <span data-ttu-id="038d2-220">[CREATE 공간 인덱스](/sql/t-sql/statements/create-spatial-index-transact-sql) 문의 using (GEOMETRY_AUTO_GRID/GEOMETRY_GRID) 절을 사용 하 여이 공간 분할 (tessellation) 구성표를 명시적으로 지정할 수 있습니다 [!INCLUDE[tsql](../../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="038d2-220">You can explicitly specify this tessellation scheme by using the USING (GEOMETRY_AUTO_GRID/GEOMETRY_GRID) clause of the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span>

##### <a name="the-bounding-box"></a><span data-ttu-id="038d2-221">경계 상자</span><span class="sxs-lookup"><span data-stu-id="038d2-221">The Bounding Box</span></span>
 <span data-ttu-id="038d2-222">기하학적 데이터는 무한할 수 있는 평면을 차지합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-222">Geometric data occupies a plane that can be infinite.</span></span> <span data-ttu-id="038d2-223">그러나 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]에서 공간 인덱스는 제한된 공간을 필요로 합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-223">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], however, a spatial index requires a finite space.</span></span> <span data-ttu-id="038d2-224">분해를 위한 제한된 공간을 설정하려면 기하 도형 표 공간 분할 구성표에는 사각형 *경계 상자*가 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-224">To establish a finite space for decomposition, the geometry grid tessellation scheme requires a rectangular *bounding box*.</span></span> <span data-ttu-id="038d2-225">경계 상자는 `(` _x-min_**,**_y-min_ `)` `(` _x-max_**,** 공간 인덱스의 속성으로 저장_y-max_되는 4 개 좌표 x 분, y 분, x 최대값, y 최대값으로 정의 됩니다 `)` .</span><span class="sxs-lookup"><span data-stu-id="038d2-225">The bounding box is defined by four coordinates, `(`_x-min_**,**_y-min_`)` and `(`_x-max_**,**_y-max_`)`, which are stored as properties of the spatial index.</span></span> <span data-ttu-id="038d2-226">이러한 좌표는 다음을 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-226">These coordinates represent the following:</span></span>

-   <span data-ttu-id="038d2-227">*x-min* 은 경계 상자의 왼쪽 아래 모퉁이의 X 좌표입니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-227">*x-min* is the x-coordinate of the lower-left corner of the bounding box.</span></span>

-   <span data-ttu-id="038d2-228">*y-min* 은 왼쪽 아래 모퉁이의 Y 좌표입니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-228">*y-min* is the y-coordinate of the lower-left corner.</span></span>

-   <span data-ttu-id="038d2-229">*x-max* 는 오른쪽 위 모퉁이의 X 좌표입니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-229">*x-max* is the x-coordinate of the upper-right corner.</span></span>

-   <span data-ttu-id="038d2-230">*y-max* 는 오른쪽 위 모퉁이의 Y 좌표입니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-230">*y-max* is the y-coordinate of upper-right corner.</span></span>

> [!NOTE]
>  <span data-ttu-id="038d2-231">이러한 좌표는 [CREATE 공간 인덱스](/sql/t-sql/statements/create-spatial-index-transact-sql) 문의 BOUNDING_BOX 절에 의해 지정 됩니다 [!INCLUDE[tsql](../../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="038d2-231">These coordinates are specified by the BOUNDING_BOX clause of the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span>

 <span data-ttu-id="038d2-232">`(` _X 분_**,**_y-min_ `)` 및 `(` _x max_**,**_y 최대값_ `)` 좌표는 경계 상자의 배치와 크기를 결정 합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-232">The `(`_x-min_**,**_y-min_`)` and `(`_x-max_**,**_y-max_`)` coordinates determine the placement and dimensions of the bounding box.</span></span> <span data-ttu-id="038d2-233">경계 상자 외부의 공간은 번호가 0으로 매겨진 단일 셀로 처리됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-233">The space outside of the bounding box is treated as a single cell that is numbered 0.</span></span>

 <span data-ttu-id="038d2-234">공간 인덱스는 경계 상자 내부의 공간을 분해합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-234">The spatial index decomposes the space inside the bounding box.</span></span> <span data-ttu-id="038d2-235">표 계층 구조 수준-1 표가 경계 상자를 채웁니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-235">The level-1 grid of the grid hierarchy fills the bounding box.</span></span> <span data-ttu-id="038d2-236">표 계층 구조에서 기하학적 개체를 배치하기 위해 공간 인덱스에서는 개체 좌표와 경계 상자 좌표를 비교합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-236">To place a geometric object in the grid hierarchy, the spatial index compares the coordinates of the object to the bounding-box coordinates.</span></span>

 <span data-ttu-id="038d2-237">다음 그림에서는 `(` 경계 상자의 _x 분_**,**_y 분_ , `)` `(` _x_최대값 **,**_y 최대값_ `)` 좌표에 의해 정의 되는 요소를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-237">The following illustration shows the points defined by the `(`_x-min_**,**_y-min_`)` and `(`_x-max_**,**_y-max_`)` coordinates of the bounding box.</span></span> <span data-ttu-id="038d2-238">표 계층 구조의 최상위 수준이 4x4 표로 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-238">The top-level of the grid hierarchy is shown as a 4x4 grid.</span></span> <span data-ttu-id="038d2-239">이해하기 쉽도록 하위 수준은 생략되었습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-239">For the purpose of illustration, the lower levels are omitted.</span></span> <span data-ttu-id="038d2-240">경계 상자 외부의 공간은 0으로 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-240">The space outside of the bounding box is indicated by a zero (0).</span></span> <span data-ttu-id="038d2-241">'A' 개체는 부분적으로 상자 밖으로 뻗어 있고 'B' 개체는 완전히 셀 0의 상자 바깥쪽에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-241">Note that object 'A' extends partly beyond the box, and object 'B' lies completely outside the box in cell 0.</span></span>

 <span data-ttu-id="038d2-242">![좌표 및 셀 0을 보여 주는 경계 상자](../../database-engine/media/spndx-bb-4x4-objects.gif "좌표 및 셀 0을 보여 주는 경계 상자")</span><span class="sxs-lookup"><span data-stu-id="038d2-242">![Bounding box showing coordinates and cell 0.](../../database-engine/media/spndx-bb-4x4-objects.gif "Bounding box showing coordinates and cell 0.")</span></span>

 <span data-ttu-id="038d2-243">경계 상자는 애플리케이션 공간 데이터의 일부분에 해당합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-243">A bounding box corresponds to some portion of an application's spatial data.</span></span> <span data-ttu-id="038d2-244">인덱스의 경계 상자가 공간 열에 저장된 데이터를 완전히 포함하거나 일부만 포함하는지는 애플리케이션에 따라 좌우됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-244">Whether the bounding-box of the index completely contains the data stored in the spatial column, or only contains a portion, is up to the application.</span></span> <span data-ttu-id="038d2-245">전체적으로 경계 상자의 내부에 있는 개체에서 처리되는 작업만 공간 인덱스의 이점을 활용합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-245">Only operations computed on objects that are entirely inside of the bounding box benefit from the spatial index.</span></span> <span data-ttu-id="038d2-246">따라서 `geometry` 열의 공간 인덱스의 이점을 최대한 활용하려면 개체의 전체 또는 대부분을 포함하는 경계 상자를 지정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-246">Therefore, to gain the greatest advantage from a spatial index on a `geometry` column, you need to specify a bounding-box that contains all or most of the objects.</span></span>

> [!NOTE]
>  <span data-ttu-id="038d2-247">공간 인덱스의 표 밀도는 [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) 카탈로그 뷰의 bounding_box_xmin, bounding_box_ymin, bounding_box_xmax 및 bounding_box_ymax 열에서 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-247">The grid densities of a spatial index are visible in the bounding_box_xmin, bounding_box_ymin, bounding_box_xmax, and bounding_box_ymax columns of the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view.</span></span>

#### <a name="the-geography-grid-tessellation-scheme"></a><span data-ttu-id="038d2-248">지리 표 공간 분할 구성표</span><span class="sxs-lookup"><span data-stu-id="038d2-248">The Geography Grid Tessellation Scheme</span></span>
 <span data-ttu-id="038d2-249">공간 분할 구성표는 `geography` 열에만 적용합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-249">This tessellation scheme applies only to a `geography` column.</span></span> <span data-ttu-id="038d2-250">이 섹션에서는 지리 표 공간 분할에서 지원되는 메서드에 대해 요약하고 측지 공간이 평면에 표시되는 방법에 대해 설명합니다. 이 측지 공간은 표 계층 구조로 분해됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-250">This section summarizes the methods that are supported by geography grid tessellation and discusses how geodetic space is projected onto a plane, which is then decomposed into a grid hierarchy.</span></span>

> [!NOTE]
>  <span data-ttu-id="038d2-251">[CREATE 공간 인덱스](/sql/t-sql/statements/create-spatial-index-transact-sql) 문의 using (GEOGRAPHY_AUTO_GRID/GEOGRAPHY_GRID) 절을 사용 하 여이 공간 분할 (tessellation) 구성표를 명시적으로 지정할 수 있습니다 [!INCLUDE[tsql](../../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="038d2-251">You can explicitly specify this tessellation scheme by using the USING (GEOGRAPHY_AUTO_GRID/GEOGRAPHY_GRID) clause of the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span>

##### <a name="projection-of-the-geodetic-space-onto-a-plane"></a><span data-ttu-id="038d2-252">측지 공간을 평면에 표시</span><span class="sxs-lookup"><span data-stu-id="038d2-252">Projection of the Geodetic Space onto a Plane</span></span>
 <span data-ttu-id="038d2-253">`geography` 인스턴스(개체)에서의 계산은 개체를 포함하는 공간을 측지 타원면으로 처리합니다</span><span class="sxs-lookup"><span data-stu-id="038d2-253">Computations on `geography` instances (objects) treat the space containing the objects as a geodetic ellipsoid.</span></span> <span data-ttu-id="038d2-254">이 공간을 분해하기 위해 지리 표 공간 분할 구성표에서는 타원면의 표면을 해당하는 위쪽 반구와 아래쪽 반구로 나눈 후 다음 단계를 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-254">To decompose this space, the geography grid tessellation scheme divides the surface of the ellipsoid into its upper and lower hemispheres and then performs the following steps:</span></span>

1.  <span data-ttu-id="038d2-255">각 반구를 사변형 피라미드의 각 면으로 표시합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-255">Projects each hemisphere onto the facets of a quadrilateral pyramid.</span></span>

2.  <span data-ttu-id="038d2-256">두 피라미드를 평평하게 합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-256">Flattens the two pyramids.</span></span>

3.  <span data-ttu-id="038d2-257">평평해진 피라미드를 비유클리드 평면을 구성하도록 조인합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-257">Joins the flattened pyramids to form a non-Euclidean plane.</span></span>

 <span data-ttu-id="038d2-258">다음 그림에서는 3단계의 분해 프로세스를 도식 보기로 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-258">The following illustration shows a schematic view of the three-step decomposition process.</span></span> <span data-ttu-id="038d2-259">피라미드에서 점선은 각 피라미드에서 네 면의 경계를 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-259">In the pyramids, the dotted lines represent the boundaries of the four facets of each pyramid.</span></span> <span data-ttu-id="038d2-260">1단계와 2단계는 측지 타원면에 대해 설명하며 녹색 가로선을 사용하여 적도 지역 경도 선을 나타내고 녹색 세로선을 사용하여 여러 위도 선을 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-260">Steps 1 and 2 illustrate the geodetic ellipsoid, using a green horizontal line to represent the equatorial longitude line and a series of green vertical lines to represent several latitude lines.</span></span> <span data-ttu-id="038d2-261">1단계에서는 양쪽 반구로 표시되는 피라미드를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-261">Step 1 shows the pyramids being projected over the two hemispheres.</span></span> <span data-ttu-id="038d2-262">2단계에서는 평평해지는 피라미드를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-262">Step 2 shows the pyramids being flattened.</span></span> <span data-ttu-id="038d2-263">3단계에서는 평평해진 피라미드가 평면을 구성하도록 결합된 후의 모양을 보여 줍니다. 여기에는 표시된 경도가 많이 나타납니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-263">Step 3 illustrates the flattened pyramids, after they have been combined to form a plane, showing a number of projected longitude lines.</span></span> <span data-ttu-id="038d2-264">이렇게 표시된 선은 직선이며 피라미드에 놓이는 위치에 따라 길이가 다양합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-264">Notice that these projected lines are straightened and vary in length, depending on where they fall on the pyramids.</span></span>

 <span data-ttu-id="038d2-265">![타원면을 평면에 표시](../../database-engine/media/spndx-geodetic-projection.gif "타원면을 평면에 표시")</span><span class="sxs-lookup"><span data-stu-id="038d2-265">![Projection of the ellipsoid onto a plane](../../database-engine/media/spndx-geodetic-projection.gif "Projection of the ellipsoid onto a plane")</span></span>

 <span data-ttu-id="038d2-266">일단 공간이 평면으로 표시되면 이 평면은 4-수준의 표 계층 구조로 분해됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-266">Once the space has been projected onto the plane, the plane is decomposed into the four-level grid hierarchy.</span></span> <span data-ttu-id="038d2-267">각 수준은 서로 다른 표 밀도를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-267">Different levels can use different grid densities.</span></span> <span data-ttu-id="038d2-268">다음 그림에서는 4x4 수준-1 표로 분해된 후의 평면을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-268">The following illustration shows the plane after it has been decomposed into a 4x4 level-1 grid.</span></span> <span data-ttu-id="038d2-269">이해하기 쉽도록 하위 수준의 표 계층 구조는 생략됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-269">For the purposes of illustration, the lower-levels of the grid hierarchy are omitted.</span></span> <span data-ttu-id="038d2-270">실제로 평면은 4-수준 표 계층 구조로 완전히 분해됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-270">In actuality, the plane is fully decomposed into a four-level grid hierarchy.</span></span> <span data-ttu-id="038d2-271">분해 프로세스가 완료된 후 지리 열에서 지리적 데이터를 한 번에 한 행씩 읽고 공간 분할 프로세스를 각 개체에 대해 차례로 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-271">After the decomposition process finishes, the geographic data is read, row by row, from the geography column, and the tessellation process is performed for each object in turn.</span></span>

 <span data-ttu-id="038d2-272">![수준 1 지리 표](../../database-engine/media/spndx-geodetic-level1grid.gif "수준 1 지리 표")</span><span class="sxs-lookup"><span data-stu-id="038d2-272">![Level-1 geography grid](../../database-engine/media/spndx-geodetic-level1grid.gif "Level-1 geography grid")</span></span>

##  <a name="methods-supported-by-spatial-indexes"></a><a name="methods"></a><span data-ttu-id="038d2-273">공간 인덱스에서 지원 되는 메서드</span><span class="sxs-lookup"><span data-stu-id="038d2-273">Methods Supported by Spatial Indexes</span></span>

###  <a name="geometry-methods-supported-by-spatial-indexes"></a><a name="geometry"></a><span data-ttu-id="038d2-274">공간 인덱스에서 지원 되는 기 하 도형 메서드</span><span class="sxs-lookup"><span data-stu-id="038d2-274">Geometry Methods Supported by Spatial Indexes</span></span>
 <span data-ttu-id="038d2-275">공간 인덱스는 특정 조건에서 STContains(), STDistance(), STEquals(), STIntersects(), STOverlaps(), STTouches() 및 STWithin()과 같은 집합 지향 geometry 메서드를 지원합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-275">Spatial indexes support the following set-oriented geometry methods under certain conditions: STContains(), STDistance(), STEquals(), STIntersects(), STOverlaps(), STTouches(), and STWithin().</span></span> <span data-ttu-id="038d2-276">공간 인덱스의 지원을 받기 위해 이러한 메서드는 쿼리의 WHERE 또는 JOIN ON 절 내에 사용해야 하며 다음 일반 형식의 조건자 내에서 발생해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-276">To be supported by a spatial index, these methods must be used within the WHERE or JOIN ON clause of a query, and they must occur within a predicate of the following general form:</span></span>

 <span data-ttu-id="038d2-277">*geometry1*. *method_name*(*geometry2*)*comparison_operator \* \* valid_number*</span><span class="sxs-lookup"><span data-stu-id="038d2-277">*geometry1*.*method_name*(*geometry2*)*comparison_operator\*\*valid_number*</span></span>

 <span data-ttu-id="038d2-278">Null이 아닌 결과를 반환하려면 *geometry1* 및 *geometry2* 에 동일한 [SRID(Spatial Reference Identifier)](../spatial/spatial-reference-identifiers-srids.md)가 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-278">To return a non-null result, *geometry1* and *geometry2* must have the same [spatial reference identifier (SRID)](../spatial/spatial-reference-identifiers-srids.md).</span></span> <span data-ttu-id="038d2-279">그렇지 않으면 메서드가 NULL을 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-279">Otherwise, the method returns NULL.</span></span>

 <span data-ttu-id="038d2-280">공간 인덱스는 다음 조건자 형식을 지원합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-280">Spatial indexes support the following predicate forms:</span></span>

-   <span data-ttu-id="038d2-281">*geometry1*.[STContains](/sql/t-sql/spatial-geometry/stcontains-geometry-data-type)(*geometry2*) = 1</span><span class="sxs-lookup"><span data-stu-id="038d2-281">*geometry1*.[STContains](/sql/t-sql/spatial-geometry/stcontains-geometry-data-type)(*geometry2*) = 1</span></span>

-   <span data-ttu-id="038d2-282">*geometry1*. [Stdistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*geometry2*) < *번호*</span><span class="sxs-lookup"><span data-stu-id="038d2-282">*geometry1*.[STDistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*geometry2*) < *number*</span></span>

-   <span data-ttu-id="038d2-283">*geometry1*.[STDistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*geometry2*) <= *number*</span><span class="sxs-lookup"><span data-stu-id="038d2-283">*geometry1*.[STDistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*geometry2*) <= *number*</span></span>

-   <span data-ttu-id="038d2-284">*geometry1*.[STEquals](/sql/t-sql/spatial-geometry/stequals-geometry-data-type)(*geometry2*)= 1</span><span class="sxs-lookup"><span data-stu-id="038d2-284">*geometry1*.[STEquals](/sql/t-sql/spatial-geometry/stequals-geometry-data-type)(*geometry2*)= 1</span></span>

-   <span data-ttu-id="038d2-285">*geometry1*.[STIntersects](/sql/t-sql/spatial-geometry/stintersects-geometry-data-type)(*geometry2*)= 1</span><span class="sxs-lookup"><span data-stu-id="038d2-285">*geometry1*.[STIntersects](/sql/t-sql/spatial-geometry/stintersects-geometry-data-type)(*geometry2*)= 1</span></span>

-   <span data-ttu-id="038d2-286">*geometry1.*</span><span class="sxs-lookup"><span data-stu-id="038d2-286">*geometry1.*</span></span> <span data-ttu-id="038d2-287">[STOverlaps](/sql/t-sql/spatial-geometry/stoverlaps-geometry-data-type) *(geometry2) = 1*</span><span class="sxs-lookup"><span data-stu-id="038d2-287">[STOverlaps](/sql/t-sql/spatial-geometry/stoverlaps-geometry-data-type) *(geometry2) = 1*</span></span>

-   <span data-ttu-id="038d2-288">*geometry1*.[STTouches](/sql/t-sql/spatial-geometry/sttouches-geometry-data-type)(*geometry2*) = 1</span><span class="sxs-lookup"><span data-stu-id="038d2-288">*geometry1*.[STTouches](/sql/t-sql/spatial-geometry/sttouches-geometry-data-type)(*geometry2*) = 1</span></span>

-   <span data-ttu-id="038d2-289">*geometry1*.[STWithin](/sql/t-sql/spatial-geometry/stwithin-geometry-data-type)(*geometry2*)= 1</span><span class="sxs-lookup"><span data-stu-id="038d2-289">*geometry1*.[STWithin](/sql/t-sql/spatial-geometry/stwithin-geometry-data-type)(*geometry2*)= 1</span></span>

###  <a name="geography-methods-supported-by-spatial-indexes"></a><a name="geography"></a><span data-ttu-id="038d2-290">공간 인덱스에서 지원 되는 지리 메서드</span><span class="sxs-lookup"><span data-stu-id="038d2-290">Geography Methods Supported by Spatial Indexes</span></span>
 <span data-ttu-id="038d2-291">특정 조건에서 공간 인덱스는 STIntersects(),STEquals() 및 STDistance()와 같은 집합 지향 지리 메서드를 지원합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-291">Under certain conditions, spatial indexes support the following set-oriented geography methods: STIntersects(),STEquals(), and STDistance().</span></span> <span data-ttu-id="038d2-292">공간 인덱스의 지원을 받기 위해 이러한 메서드는 쿼리의 WHERE 절 내에 사용해야 하며 다음 일반 형식의 조건자 내에서 발생해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-292">To be supported by a spatial index, these methods must be used within the WHERE clause of a query, and they must occur within a predicate of the following general form:</span></span>

 <span data-ttu-id="038d2-293">*geography1*. *method_name*(*geography2*)*comparison_operator \* \* valid_number*</span><span class="sxs-lookup"><span data-stu-id="038d2-293">*geography1*.*method_name*(*geography2*)*comparison_operator\*\*valid_number*</span></span>

 <span data-ttu-id="038d2-294">Null이 아닌 결과를 반환하려면 *geography1* 및 *geography2* 에 동일한 [SRID(Spatial Reference Identifier)](../spatial/spatial-reference-identifiers-srids.md)가 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-294">To return a non-null result, *geography1* and *geography2* must have the same [Spatial Reference Identifier (SRID)](../spatial/spatial-reference-identifiers-srids.md).</span></span> <span data-ttu-id="038d2-295">그렇지 않으면 메서드가 NULL을 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-295">Otherwise, the method returns NULL.</span></span>

 <span data-ttu-id="038d2-296">공간 인덱스는 다음 조건자 형식을 지원합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-296">Spatial indexes support the following predicate forms:</span></span>

-   <span data-ttu-id="038d2-297">*geography1*.[STIntersects](/sql/t-sql/spatial-geography/stintersects-geography-data-type)(*geography2*)= 1</span><span class="sxs-lookup"><span data-stu-id="038d2-297">*geography1*.[STIntersects](/sql/t-sql/spatial-geography/stintersects-geography-data-type)(*geography2*)= 1</span></span>

-   <span data-ttu-id="038d2-298">*geography1*.[STEquals](/sql/t-sql/spatial-geography/stequals-geography-data-type)(*geography2*)= 1</span><span class="sxs-lookup"><span data-stu-id="038d2-298">*geography1*.[STEquals](/sql/t-sql/spatial-geography/stequals-geography-data-type)(*geography2*)= 1</span></span>

-   <span data-ttu-id="038d2-299">*geography1*. [Stdistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*) < *번호*</span><span class="sxs-lookup"><span data-stu-id="038d2-299">*geography1*.[STDistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*) < *number*</span></span>

-   <span data-ttu-id="038d2-300">*geography1*.[STDistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*) <= *number*</span><span class="sxs-lookup"><span data-stu-id="038d2-300">*geography1*.[STDistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*) <= *number*</span></span>

### <a name="queries-that-use-spatial-indexes"></a><span data-ttu-id="038d2-301">공간 인덱스를 사용하는 쿼리</span><span class="sxs-lookup"><span data-stu-id="038d2-301">Queries that use Spatial Indexes</span></span>
 <span data-ttu-id="038d2-302">공간 인덱스는 `WHERE`절에서 인덱싱된 공간 연산자를 포함하는 쿼리에서만 지원됩니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-302">Spatial indexes are only supported in queries that include an indexed spatial operator in the `WHERE` clause.</span></span> <span data-ttu-id="038d2-303">예를 들어 다음과 같은 예제 구문의 경우</span><span class="sxs-lookup"><span data-stu-id="038d2-303">For example syntax such as:</span></span>

```
[spatial object].SpatialMethod([reference spatial object]) [ = | < ] [const literal or variable]
```

 <span data-ttu-id="038d2-304">쿼리 최적화 프로그램은 공간 연산의 교환( `@a.STIntersects(@b) = @b.STInterestcs(@a)` )을 인식합니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-304">The query optimizer understands the commutativity of spatial operations (that `@a.STIntersects(@b) = @b.STInterestcs(@a)` ).</span></span> <span data-ttu-id="038d2-305">그러나 비교의 시작 부분에 공간 연산자가 포함되어 있지 않은 경우 공간 인덱스가 사용되지 않습니다. 예를 들어 `WHERE 1 = spatial op` 는 공간 인덱스를 사용하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-305">However, the spatial index will not be used if the beginning of a comparison does not contain the spatial operator (for example `WHERE 1 = spatial op` will not use the spatial index).</span></span> <span data-ttu-id="038d2-306">공간 인덱스를 사용하려면 비교를 다시 씁니다(예: `WHERE spatial op = 1`).</span><span class="sxs-lookup"><span data-stu-id="038d2-306">To use the spatial index, rewrite the comparison (for example `WHERE spatial op = 1`).</span></span>

 <span data-ttu-id="038d2-307">다른 인덱스를 사용하는 것처럼 공간 인덱스가 지원되는 경우 비용을 기반으로 공간 인덱스가 선택되므로 사용 요구 사항이 모두 충족되는 경우에도 쿼리 최적화 프로그램은 공간 인덱스를 사용하도록 선택하지 않을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-307">As with any other index, when a spatial index is supported, the use of the spatial index is chosen based on cost, so the query optimizer might not choose to use the spatial index even though all requirements for using it are met.</span></span> <span data-ttu-id="038d2-308">실행 계획을 사용하여 공간 인덱스를 사용하는지 여부를 확인하고, 필요할 경우 원하는 쿼리 계획을 강제로 수행하도록 쿼리 힌트를 제공하세요.</span><span class="sxs-lookup"><span data-stu-id="038d2-308">Use showplan to see if the spatial index was used and if necessary provide query hints to force a desired query plan.</span></span>

 <span data-ttu-id="038d2-309">가장 인접한 쿼리 유형도 공간 인덱스를 지원하지만 특정 쿼리 구문인 경우에만 쓰여집니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-309">The nearest neighbor type of query also supports spatial indexes however only if a specific query syntax is written.</span></span> <span data-ttu-id="038d2-310">적합한 구문은 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="038d2-310">The appropriate syntax is:</span></span>

```
SELECT TOP(K) [WITH TIES] * 
FROM <Table> AS T [WITH(INDEX(<SpatialIndex>))]
WHERE <SpatialColumn>.STDistance(@reference_object) IS NOT NULL
ORDER BY <SpatialColumn>.STDistance(@reference_object) [;]
```

## <a name="see-also"></a><span data-ttu-id="038d2-311">참고 항목</span><span class="sxs-lookup"><span data-stu-id="038d2-311">See Also</span></span>
 [<span data-ttu-id="038d2-312">공간 데이터&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="038d2-312">Spatial Data &#40;SQL Server&#41;</span></span>](../spatial/spatial-data-sql-server.md)


