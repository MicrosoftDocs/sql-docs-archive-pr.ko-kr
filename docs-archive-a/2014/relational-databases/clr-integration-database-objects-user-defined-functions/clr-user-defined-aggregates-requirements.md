---
title: CLR 사용자 정의 집계에 대 한 요구 사항 | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: clr
ms.topic: reference
helpviewer_keywords:
- aggregate functions [CLR integration]
- user-defined types [CLR integration], user-defined aggregates
- CREATE AGGREGATE statement
- SqlUserDefinedAggregate attribute
- aggregate methods [CLR integration]
- assemblies [CLR integration], user-defined aggregate functions
- custom aggregates [CLR integration]
- user-defined functions [CLR integration]
- UDTs [CLR integration], user-defined aggregates
ms.assetid: dbf9eb5a-bd99-42f7-b275-556d0def045d
author: rothja
ms.author: jroth
ms.openlocfilehash: 8123f8324d43212007857dbb596a4fc61872bd2e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87651727"
---
# <a name="requirements-for-clr-user-defined-aggregates"></a><span data-ttu-id="9ac0c-102">CLR 사용자 정의 집계 요구 사항</span><span class="sxs-lookup"><span data-stu-id="9ac0c-102">Requirements for CLR User-Defined Aggregates</span></span>
  <span data-ttu-id="9ac0c-103">공용 언어 런타임(CLR) 어셈블리의 형식이 필요한 집계 계약을 구현한다면 해당 형식을 사용자 정의 집계 함수로 등록할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-103">A type in a common language runtime (CLR) assembly can be registered as a user-defined aggregate function, as long as it implements the required aggregation contract.</span></span> <span data-ttu-id="9ac0c-104">이 계약은 `SqlUserDefinedAggregate` 특성과 집계 계약 메서드로 구성됩니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-104">This contract consists of the `SqlUserDefinedAggregate` attribute and the aggregation contract methods.</span></span> <span data-ttu-id="9ac0c-105">집계 계약은 집계의 중간 상태를 저장하는 메커니즘과 새 값을 누적하는 메커니즘을 포함하며 `Init`, `Accumulate`, `Merge` 및 `Terminate`의 4가지 메서드로 구성됩니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-105">The aggregation contract includes the mechanism to save the intermediate state of the aggregation, and the mechanism to accumulate new values, which consists of four methods: `Init`, `Accumulate`, `Merge`, and `Terminate`.</span></span> <span data-ttu-id="9ac0c-106">이러한 요구 사항을 충족 하는 경우에서 사용자 정의 집계를 모두 활용할 수 있습니다 [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="9ac0c-106">When you have met these requirements, you will be able to take full advantage of user-defined aggregates in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="9ac0c-107">이 항목의 다음 섹션에서는 사용자 정의 집계를 만드는 방법과 사용하는 방법에 대한 자세한 정보를 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-107">The following sections of this topic provide additional details about how to create and work with user-defined aggregates.</span></span> <span data-ttu-id="9ac0c-108">예제는 [CLR 사용자 정의 집계 함수 호출](clr-user-defined-aggregate-invoking-functions.md)을 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-108">For an example, see [Invoking CLR User-Defined Aggregate Functions](clr-user-defined-aggregate-invoking-functions.md).</span></span>  
  
## <a name="sqluserdefinedaggregate"></a><span data-ttu-id="9ac0c-109">SqlUserDefinedAggregate</span><span class="sxs-lookup"><span data-stu-id="9ac0c-109">SqlUserDefinedAggregate</span></span>  
 <span data-ttu-id="9ac0c-110">자세한 내용은 [SqlUserDefinedAggregateAttribute](https://go.microsoft.com/fwlink/?LinkId=124626)를 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-110">For more information, see [SqlUserDefinedAggregateAttribute](https://go.microsoft.com/fwlink/?LinkId=124626).</span></span>  
  
## <a name="aggregation-methods"></a><span data-ttu-id="9ac0c-111">집계 메서드</span><span class="sxs-lookup"><span data-stu-id="9ac0c-111">Aggregation Methods</span></span>  
 <span data-ttu-id="9ac0c-112">사용자 정의 집계로 등록된 클래스는 다음과 같은 인스턴스 메서드를 지원해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-112">The class registered as a user-defined aggregate should support the following instance methods.</span></span> <span data-ttu-id="9ac0c-113">쿼리 프로세서는 이러한 메서드를 사용하여 집계를 컴퓨팅합니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-113">These are the methods that the query processor uses to compute the aggregation:</span></span>  
  
|<span data-ttu-id="9ac0c-114">방법</span><span class="sxs-lookup"><span data-stu-id="9ac0c-114">Method</span></span>|<span data-ttu-id="9ac0c-115">구문</span><span class="sxs-lookup"><span data-stu-id="9ac0c-115">Syntax</span></span>|<span data-ttu-id="9ac0c-116">Description</span><span class="sxs-lookup"><span data-stu-id="9ac0c-116">Description</span></span>|  
|------------|------------|-----------------|  
|`Init`|<span data-ttu-id="9ac0c-117">public void Init ();</span><span class="sxs-lookup"><span data-stu-id="9ac0c-117">public void Init();</span></span>|<span data-ttu-id="9ac0c-118">쿼리 프로세서는 이 메서드를 사용하여 집계 계산을 초기화합니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-118">The query processor uses this method to initialize the computation of the aggregation.</span></span> <span data-ttu-id="9ac0c-119">이 메서드는 쿼리 프로세서가 집계하는 각 그룹에 대해 한 번씩 호출됩니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-119">This method is invoked once for each group that the query processor is aggregating.</span></span> <span data-ttu-id="9ac0c-120">쿼리 프로세서는 여러 그룹의 집계를 계산할 때 집계 클래스의 동일한 인스턴스를 다시 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-120">The query processor may choose to reuse the same instance of the aggregate class for computing aggregates of multiple groups.</span></span> <span data-ttu-id="9ac0c-121">`Init` 메서드는 이전에 인스턴스를 사용할 때 필요했던 모든 정리를 수행하고 인스턴스를 사용하여 새 집계 계산을 다시 시작할 수 있도록 만들어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-121">The `Init` method should perform any clean-up as necessary from previous uses of this instance, and enable it to re-start a new aggregate computation.</span></span>|  
|`Accumulate`|<span data-ttu-id="9ac0c-122">public void 누적 (입력 형식 값 [, 입력-형식 값, ...]);</span><span class="sxs-lookup"><span data-stu-id="9ac0c-122">public void Accumulate ( input-type value[, input-type value, ...]);</span></span>|<span data-ttu-id="9ac0c-123">함수의 매개 변수를 나타내는 1개 이상의 매개 변수.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-123">One or more parameters representing the parameters of the function.</span></span> <span data-ttu-id="9ac0c-124">*input_type* 은 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 문에서 input_sqltype에 지정 된 네이티브 데이터 형식에 해당 하는 관리 되는 데이터 형식 이어야 합니다 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] *input_sqltype* `CREATE AGGREGATE` .</span><span class="sxs-lookup"><span data-stu-id="9ac0c-124">*input_type* should be the managed [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] data type equivalent to the native [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] data type specified by *input_sqltype* in the `CREATE AGGREGATE` statement.</span></span> <span data-ttu-id="9ac0c-125">자세한 내용은 [CLR 매개 변수 데이터 매핑](../clr-integration-database-objects-types-net-framework/mapping-clr-parameter-data.md)을 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-125">For more information, see [Mapping CLR Parameter Data](../clr-integration-database-objects-types-net-framework/mapping-clr-parameter-data.md).</span></span><br /><br /> <span data-ttu-id="9ac0c-126">UDT(사용자 정의 형식)의 경우 input-type이 UDT 형식과 동일합니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-126">For user-defined types (UDTs), the input-type is the same as the UDT type.</span></span> <span data-ttu-id="9ac0c-127">쿼리 프로세서는 이 메서드를 사용하여 집계 값을 누적시킵니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-127">The query processor uses this method to accumulate the aggregate values.</span></span> <span data-ttu-id="9ac0c-128">이 메서드는 집계되는 그룹의 각 값에 대해 한 번씩 호출됩니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-128">This is invoked once for each value in the group that is being aggregated.</span></span> <span data-ttu-id="9ac0c-129">쿼리 프로세서는 항상 집계 클래스의 지정된 인스턴스에서 `Init` 메서드를 호출한 후에만 이 메서드를 호출합니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-129">The query processor always calls this only after calling the `Init` method on the given instance of the aggregate-class.</span></span> <span data-ttu-id="9ac0c-130">이 메서드 구현은 전달되는 인수 값의 누적을 반영하도록 인스턴스 상태를 업데이트해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-130">The implementation of this method should update the state of the instance to reflect the accumulation of the argument value being passed in.</span></span>|  
|`Merge`|<span data-ttu-id="9ac0c-131">public void Merge (udagg_class 값);</span><span class="sxs-lookup"><span data-stu-id="9ac0c-131">public void Merge( udagg_class value);</span></span>|<span data-ttu-id="9ac0c-132">이 메서드를 사용하여 이 집계 클래스의 다른 인스턴스를 현재 인스턴스와 병합할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-132">This method can be used to merge another instance of this aggregate class with the current instance.</span></span> <span data-ttu-id="9ac0c-133">쿼리 프로세서는 이 메서드를 사용하여 집계의 다중 부분 계산을 병합합니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-133">The query processor uses this method to merge multiple partial computations of an aggregation.</span></span>|  
|`Terminate`|<span data-ttu-id="9ac0c-134">public return_type Terminate ();</span><span class="sxs-lookup"><span data-stu-id="9ac0c-134">public return_type Terminate();</span></span>|<span data-ttu-id="9ac0c-135">이 메서드는 집계 계산을 완료하고 집계 결과를 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-135">This method completes the aggregate computation and returns the result of the aggregation.</span></span> <span data-ttu-id="9ac0c-136">*Return_type* 는 문에 지정 된 return_sqltype에 해당 하는 관리 되는 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 데이터 *return_sqltype* 형식 이어야 합니다 `CREATE AGGREGATE` .</span><span class="sxs-lookup"><span data-stu-id="9ac0c-136">The *return_type* should be a managed [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] data type that is the managed equivalent of *return_sqltype* specified in the `CREATE AGGREGATE` statement.</span></span> <span data-ttu-id="9ac0c-137">*Return_type* 은 사용자 정의 형식일 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-137">The *return_type* can also be a user-defined type.</span></span>|  
  
### <a name="table-valued-parameters"></a><span data-ttu-id="9ac0c-138">테이블 반환 매개 변수</span><span class="sxs-lookup"><span data-stu-id="9ac0c-138">Table-Valued Parameters</span></span>  
 <span data-ttu-id="9ac0c-139">프로시저 또는 함수로 전달되는 사용자 정의 테이블 형식인 TVP(테이블 반환 매개 변수)를 사용하면 여러 개의 데이터 행을 서버로 편리하게 전달할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-139">Table-valued parameters (TVPs), user-defined table types that are passed into a procedure or function, provide an efficient way to pass multiple rows of data to the server.</span></span> <span data-ttu-id="9ac0c-140">TVP는 매개 변수 배열과 유사한 기능을 제공하지만 더 유연하며 [!INCLUDE[tsql](../../includes/tsql-md.md)]과 더 밀접하게 통합됩니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-140">TVPs provide similar functionality to parameter arrays, but offer greater flexibility and closer integration with [!INCLUDE[tsql](../../includes/tsql-md.md)].</span></span> <span data-ttu-id="9ac0c-141">또한 성능도 향상될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-141">They also provide the potential for better performance.</span></span> <span data-ttu-id="9ac0c-142">TVP는 또한 서버와의 왕복 횟수를 줄이는 데 도움이 될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-142">TVPs also help reduce the number of round trips to the server.</span></span> <span data-ttu-id="9ac0c-143">스칼라 매개 변수 목록과 같이 서버로 여러 개의 요청을 보내는 대신 서버에 데이터를 TVP로 보낼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-143">Instead of sending multiple requests to the server, such as with a list of scalar parameters, data can be sent to the server as a TVP.</span></span> <span data-ttu-id="9ac0c-144">사용자 정의 테이블 형식은 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 프로세스에서 실행 중인 관리되는 저장 프로시저 또는 함수에 테이블 반환 매개 변수로 전달되거나 이러한 저장 프로시저 또는 함수에서 테이블 반환 매개 변수로 반환될 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-144">A user-defined table type cannot be passed as a table-valued parameter to, or be returned from, a managed stored procedure or function executing in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] process.</span></span> <span data-ttu-id="9ac0c-145">또한 컨텍스트 연결의 범위 내에서 TVP를 사용할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-145">Also, TVPs cannot be used within the scope of a context connection.</span></span> <span data-ttu-id="9ac0c-146">하지만 컨텍스트 연결이 아닌 연결에 사용되는 경우 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 프로세스에서 실행하는 관리되는 저장 프로시저나 함수에서 SqlClient와 함께 TVP를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-146">However, a TVP can be used with SqlClient in managed stored procedures or functions executing in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] process, if it is used in a connection that is not a context connection.</span></span> <span data-ttu-id="9ac0c-147">이 경우 관리되는 프로시저나 함수를 실행하는 서버와 동일한 서버에 연결될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-147">The connection can be to the same server that is executing the managed procedure or function.</span></span> <span data-ttu-id="9ac0c-148">Tvp에 대 한 자세한 내용은 [데이터베이스 엔진&#41;&#40;테이블 반환 매개 변수 사용 ](../tables/use-table-valued-parameters-database-engine.md)을 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-148">For more information about TVPs, see [Use Table-Valued Parameters &#40;Database Engine&#41;](../tables/use-table-valued-parameters-database-engine.md).</span></span>  
  
## <a name="change-history"></a><span data-ttu-id="9ac0c-149">변경 내역</span><span class="sxs-lookup"><span data-stu-id="9ac0c-149">Change History</span></span>  
  
|<span data-ttu-id="9ac0c-150">업데이트된 내용</span><span class="sxs-lookup"><span data-stu-id="9ac0c-150">Updated content</span></span>|  
|---------------------|  
|<span data-ttu-id="9ac0c-151">`Accumulate` 메서드의 설명이 업데이트되어 이제 2개 이상의 매개 변수를 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="9ac0c-151">Updated the description of the `Accumulate` method; it now accepts more than one parameter.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="9ac0c-152">참고 항목</span><span class="sxs-lookup"><span data-stu-id="9ac0c-152">See Also</span></span>  
 <span data-ttu-id="9ac0c-153">[CLR 사용자 정의 형식](../clr-integration-database-objects-user-defined-types/clr-user-defined-types.md) </span><span class="sxs-lookup"><span data-stu-id="9ac0c-153">[CLR User-Defined Types](../clr-integration-database-objects-user-defined-types/clr-user-defined-types.md) </span></span>  
 [<span data-ttu-id="9ac0c-154">CLR 사용자 정의 집계 함수 호출</span><span class="sxs-lookup"><span data-stu-id="9ac0c-154">Invoking CLR User-Defined Aggregate Functions</span></span>](clr-user-defined-aggregate-invoking-functions.md)  
  
  
