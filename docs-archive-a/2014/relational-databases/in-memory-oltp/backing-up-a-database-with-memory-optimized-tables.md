---
title: 메모리 액세스에 최적화된 테이블이 포함된 데이터베이스 백업 | Microsoft 문서
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 83d47694-e56d-4dae-b54e-14945bf8ba31
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: 176448aa9d4bab4101ab2db12ffc9a8a7fd1a5b5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87647001"
---
# <a name="backing-up-a-database-with-memory-optimized-tables"></a><span data-ttu-id="19b42-102">메모리 액세스에 최적화된 테이블이 포함된 데이터베이스 백업</span><span class="sxs-lookup"><span data-stu-id="19b42-102">Backing Up a Database with Memory-Optimized Tables</span></span>
  <span data-ttu-id="19b42-103">메모리 액세스에 최적화된 테이블은 일반적인 데이터베이스 백업의 일부로 백업됩니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-103">Memory-optimized tables are backed up as part of regular database backups.</span></span> <span data-ttu-id="19b42-104">디스크 기반 테이블의 경우 스토리지 손상을 검색하기 위해 데이터베이스 백업의 일부로 데이터 및 델타 파일 쌍의 CHECKSUM 유효성이 검사됩니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-104">As for disk-based tables, the CHECKSUM of data and delta file pairs is validated as part of the database backup to detect storage corruption.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="19b42-105">백업하는 동안 메모리 최적화 파일 그룹의 하나 이상의 파일에서 CHECKSUM 오류가 발견되면 데이터베이스를 복원 및 다시 시작할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-105">During a backup, if you detect a CHECKSUM error in one or more files in a memory-optimized filegroup, you will not be able to restore and restart the database.</span></span> <span data-ttu-id="19b42-106">이 경우 마지막 양호한 백업으로 데이터베이스를 복원해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-106">In that situation, you must, restore your database with the last known good backup.</span></span> <span data-ttu-id="19b42-107">백업이 없는 경우 메모리 최적화 테이블 및 디스크 기반 테이블에서 데이터를 내보낼 수 있으며, 데이터베이스를 삭제하고 다시 만든 뒤 다시 로드할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-107">If you don't have a backup, you can export the data from memory-optimized tables and disk-based tables and reload after you drop and recreate the database.</span></span>  
  
 <span data-ttu-id="19b42-108">메모리 최적화 테이블이 하나 이상인 데이터베이스의 전체 백업은 디스크 기반 테이블의 할당된 스토리지(있는 경우), 활성 트랜잭션 로그, 메모리 최적화 테이블의 데이터 및 델타 파일 쌍(검사점 파일 쌍이라고도 함)으로 구성됩니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-108">A full backup of a database with one or more memory-optimized tables consists of the allocated storage for disk-based tables (if any), the active transaction log, and the data and delta file pairs (also known as checkpoint file pairs) for memory-optimized tables.</span></span> <span data-ttu-id="19b42-109">그러나 [메모리 최적화 테이블에 대한 내구성](memory-optimized-tables.md)에 설명된 대로 메모리 최적화 테이블에서 사용하는 스토리지는 메모리 내의 해당 크기보다 훨씬 클 수 있으며, 이는 데이터베이스 백업의 크기에 영향을 미칩니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-109">However, as described in [Durability for Memory-Optimized Tables](memory-optimized-tables.md), the storage used by memory-optimized tables can be much larger than its size in memory, and it affects the size of the database backup.</span></span>  
  
## <a name="full-database-backup"></a><span data-ttu-id="19b42-110">전체 데이터베이스 백업</span><span class="sxs-lookup"><span data-stu-id="19b42-110">Full Database Backup</span></span>  
 <span data-ttu-id="19b42-111">여기에서는 디스크 기반 테이블의 백업이 동일하기 때문에 메모리 최적화 영구 테이블이 포함된 데이터베이스의 백업을 중점적으로 살펴봅니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-111">This discussion will focus on database backups for databases with just durable memory-optimized tables, because the backup for disk-based tables is the same.</span></span> <span data-ttu-id="19b42-112">메모리 최적화 파일 그룹의 검사점 파일 쌍은 다양한 상태에 있을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-112">The checkpoint file pairs in the memory-optimized filegroup could be in various states.</span></span> <span data-ttu-id="19b42-113">아래의 표에서는 백업되는 파일의 부분에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-113">The table below describes what part of the files is backed.</span></span>  
  
|<span data-ttu-id="19b42-114">검사점 파일 쌍 상태</span><span class="sxs-lookup"><span data-stu-id="19b42-114">Checkpoint File Pair State</span></span>|<span data-ttu-id="19b42-115">Backup</span><span class="sxs-lookup"><span data-stu-id="19b42-115">Backup</span></span>|  
|--------------------------------|------------|  
|<span data-ttu-id="19b42-116">PRECREATED</span><span class="sxs-lookup"><span data-stu-id="19b42-116">PRECREATED</span></span>|<span data-ttu-id="19b42-117">파일 메타데이터만</span><span class="sxs-lookup"><span data-stu-id="19b42-117">File metadata only</span></span>|  
|<span data-ttu-id="19b42-118">UNDER CONSTRUCTION</span><span class="sxs-lookup"><span data-stu-id="19b42-118">UNDER CONSTRUCTION</span></span>|<span data-ttu-id="19b42-119">파일 메타데이터만</span><span class="sxs-lookup"><span data-stu-id="19b42-119">File metadata only</span></span>|  
|<span data-ttu-id="19b42-120">활성</span><span class="sxs-lookup"><span data-stu-id="19b42-120">Active</span></span>|<span data-ttu-id="19b42-121">파일 메타데이터와 사용된 바이트</span><span class="sxs-lookup"><span data-stu-id="19b42-121">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="19b42-122">MERGE SOURCE</span><span class="sxs-lookup"><span data-stu-id="19b42-122">Merge source</span></span>|<span data-ttu-id="19b42-123">파일 메타데이터와 사용된 바이트</span><span class="sxs-lookup"><span data-stu-id="19b42-123">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="19b42-124">MERGE TARGET</span><span class="sxs-lookup"><span data-stu-id="19b42-124">Merge target</span></span>|<span data-ttu-id="19b42-125">파일 메타데이터만</span><span class="sxs-lookup"><span data-stu-id="19b42-125">File metadata only</span></span>|  
|<span data-ttu-id="19b42-126">REQUIRED FOR BACKUP/HA</span><span class="sxs-lookup"><span data-stu-id="19b42-126">REQUIRED FOR BACKUP/HA</span></span>|<span data-ttu-id="19b42-127">파일 메타데이터와 사용된 바이트</span><span class="sxs-lookup"><span data-stu-id="19b42-127">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="19b42-128">IN TRANSITION TO TOMBSTONE</span><span class="sxs-lookup"><span data-stu-id="19b42-128">IN TRANSITION TO TOMBSTONE</span></span>|<span data-ttu-id="19b42-129">파일 메타데이터만</span><span class="sxs-lookup"><span data-stu-id="19b42-129">File metadata only</span></span>|  
|<span data-ttu-id="19b42-130">TOMBSTONE</span><span class="sxs-lookup"><span data-stu-id="19b42-130">TOMBSTONE</span></span>|<span data-ttu-id="19b42-131">파일 메타데이터만</span><span class="sxs-lookup"><span data-stu-id="19b42-131">File metadata only</span></span>|  
  
 <span data-ttu-id="19b42-132">메모리 최적화 테이블이 하나 이상 포함된 데이터베이스 백업의 크기는 일반적으로 메모리 내의 해당 크기보다 크지만 디스크상 스토리지보다는 작습니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-132">The size of database backups with one or more memory-optimized tables is typically larger than its size in memory but smaller than the on-disk storage.</span></span> <span data-ttu-id="19b42-133">추가 크기는 삭제된 행 수와 작업에 간접적으로 의존하는 REQUIRED FOR BACKUP/HA 및 MERGE SOURCE 상태의 검사점 파일 쌍 수에 따라 달라집니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-133">The extra size will depend upon the number of deleted rows and the number of checkpoint file pairs in the states Merge source and REQUIRED FOR BACKUP/HA which indirectly depends upon the workload.</span></span> <span data-ttu-id="19b42-134">검사점 파일 쌍의 상태에 대 한 설명은 [dm_db_xtp_checkpoint_files &#40;transact-sql&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql)을 참조 하십시오.</span><span class="sxs-lookup"><span data-stu-id="19b42-134">For descriptions of the states for checkpoint file pairs, see [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span></span>  
  
### <a name="estimating-size-of-full-database-backup"></a><span data-ttu-id="19b42-135">전체 데이터베이스 백업의 크기 예측</span><span class="sxs-lookup"><span data-stu-id="19b42-135">Estimating Size of Full Database Backup</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="19b42-136">메모리 내 OLTP에 대한 백업 크기를 추정하려면 BackupSizeInBytes 값을 사용하지 않는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-136">It's recommended that you not use the BackupSizeInBytes value to estimate the backup size for In-Memory OLTP.</span></span>  
  
 <span data-ttu-id="19b42-137">첫 번째 작업 시나리오는 대부분 삽입에 해당합니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-137">The first workload scenario is for (mostly) insert.</span></span> <span data-ttu-id="19b42-138">이 시나리오에서 대부분의 데이터 파일은 활성 상태이고 완전히 로드되며 삭제된 행이 매우 적습니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-138">In this scenario, most data files will be in the Active state, fully loaded, and with very few deleted rows.</span></span> <span data-ttu-id="19b42-139">데이터베이스 백업의 크기는 메모리 내의 데이터 크기에 가깝습니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-139">The size of database backup up will be close to the size of data in memory.</span></span>  
  
 <span data-ttu-id="19b42-140">두 번째 작업 시나리오는 빈번한 삽입, 삭제 및 업데이트 작업에 해당합니다. 최악의 경우 각 검사점 파일 쌍은 삭제된 행을 고려한 후 50% 로드됩니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-140">The second workload scenario is for frequent insert, delete, and update operations: In the worst case, each of the checkpoint file pairs are 50% loaded, after accounting for the deleted rows.</span></span> <span data-ttu-id="19b42-141">따라서 데이터베이스 백업의 크기는 적어도 메모리 내 데이터 크기의 2배입니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-141">So the size of the database backup will at least be 2 times the size of data in memory.</span></span> <span data-ttu-id="19b42-142">또한 데이터베이스 백업의 크기에 추가될 MERGE SOURCE 및 REQUIRED FOR BACKUP/HA 상태의 몇몇 검사점 파일 쌍이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-142">Additionally, there will few checkpoint file pairs in states Merge source and Required for backup/high availability that will add to the size of database backup.</span></span>  
  
## <a name="differential-backups-of-databases-with-memory-optimized-tables"></a><span data-ttu-id="19b42-143">메모리 액세스에 최적화된 테이블이 있는 데이터베이스의 차등 백업</span><span class="sxs-lookup"><span data-stu-id="19b42-143">Differential Backups of Databases with Memory-Optimized Tables</span></span>  
 <span data-ttu-id="19b42-144">메모리 최적화 테이블의 스토리지는 [메모리 최적화 테이블에 대한 내구성](memory-optimized-tables.md)에 설명된 대로 데이터 및 델타 파일로 구성되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-144">The storage for memory-optimized tables consists of data and delta files as described in [Durability for Memory-Optimized Tables](memory-optimized-tables.md).</span></span> <span data-ttu-id="19b42-145">메모리 최적화 테이블이 있는 데이터베이스의 차등 백업에는 다음 데이터가 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-145">The differential backup of a database with memory-optimized tables contains the following data:</span></span>  
  
-   <span data-ttu-id="19b42-146">메모리 최적화 테이블이 있어도 디스크를 기반으로 테이블을 저장하는 파일 차등 백업은 영향을 받지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-146">Differential backup for filegroups storing disk-based tables is not affected by the presence of memory-optimized tables.</span></span>  
  
-   <span data-ttu-id="19b42-147">활성 트랜잭션 로그는 전체 데이터베이스 백업에서 동일합니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-147">The active transaction log is the same as in a full database backup.</span></span>  
  
-   <span data-ttu-id="19b42-148">메모리 최적화 데이터 파일 그룹의 경우 차등 백업은 전체 데이터베이스 백업과 동일한 알고리즘을 사용하여 백업 데이터 및 델타 파일을 식별하지만, 그 후에 다음과 같이 하위 집합을 필터링합니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-148">For a memory-optimized data filegroup, the differential backup uses the same algorithm as full database backup to identify the data and delta files for backup but it then filters out the subset of files as follows:</span></span>  
  
    -   <span data-ttu-id="19b42-149">데이터 파일에 새로 삽입된 행이 있고 가득 찬 경우 이 데이터 파일은 닫히고 읽기 전용으로 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-149">A data file contains newly inserted rows and when it is full, it is closed and marked read-only.</span></span> <span data-ttu-id="19b42-150">데이터 파일은 마지막 전체 데이터베이스 백업 후 닫힌 경우에만 백업됩니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-150">A data file is backed up only if it was closed after the last full database backup.</span></span> <span data-ttu-id="19b42-151">차등 백업은 업데이트 및 삭제 시나리오 예외 조항이 있는 마지막 전체 데이터베이스 백업 이후에 삽입된 행을 포함하는 백업 데이터 파일만 백업하는데, 이때 삽입된 행 중 일부가 이미 가비지 수집으로 표시되었거나 이미 가비지 수집되었을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-151">The differential backup only backups up data files containing the inserted rows since the last full database backup with the exception of an update and delete scenario where it is possible that some of the inserted rows may have already been either marked for garbage collection or already garbage collected.</span></span>  
  
    -   <span data-ttu-id="19b42-152">델타 파일은 삭제된 데이터 행에 대한 참조를 저장합니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-152">A delta file stores references to the deleted data rows.</span></span> <span data-ttu-id="19b42-153">향후의 트랜잭션에서 행을 삭제할 수 있으므로 델타 파일은 언제든지 수정 가능하며 절대로 닫히지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-153">Since any future transaction can delete a row, a delta file can be modified anytime in its life time, it is never closed.</span></span> <span data-ttu-id="19b42-154">델타 파일은 항상 백업됩니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-154">A delta file is always backed up.</span></span> <span data-ttu-id="19b42-155">델타 파일은 일반적으로 10% 미만의 스토리지를 사용하므로 차등 백업의 크기에 미치는 영향이 최소화됩니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-155">Delta files typically use less than 10% of the storage, so delta files have a minimal impact on the size of differential backup.</span></span>  
  
 <span data-ttu-id="19b42-156">메모리 최적화 테이블이 데이터베이스 크기의 상당 부분을 차지하는 경우 차등 백업으로 데이터베이스 백업의 크기를 대폭 줄일 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-156">If memory-optimized tables are a significant portion of your database size, the differential backup can significantly reduce the size of your database backup.</span></span>  
  
 <span data-ttu-id="19b42-157">일반적인 OLTP 작업의 경우 차등 백업이 전체 데이터베이스 백업보다 상당히 작습니다.</span><span class="sxs-lookup"><span data-stu-id="19b42-157">For typical OLTP workloads, the differential backups will be considerably smaller than the full database backups.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="19b42-158">참고 항목</span><span class="sxs-lookup"><span data-stu-id="19b42-158">See Also</span></span>  
 [<span data-ttu-id="19b42-159">메모리 액세스에 최적화된 테이블의 백업, 복원 및 복구</span><span class="sxs-lookup"><span data-stu-id="19b42-159">Backup, Restore, and Recovery of Memory-Optimized Tables</span></span>](restore-and-recovery-of-memory-optimized-tables.md)  
  
  
