---
title: 대량 복사 일괄 처리 크기 관리 | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- SQL Server Native Client ODBC driver, bulk copy
- ODBC, bulk copy operations
- batches [ODBC]
- bulk copy [ODBC], batch sizes
ms.assetid: 4b24139f-788b-45a6-86dc-ae835435d737
author: rothja
ms.author: jroth
ms.openlocfilehash: 1f24ece176cbb834e4162f9e516ff23013fd256a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87653346"
---
# <a name="managing-bulk-copy-batch-sizes"></a><span data-ttu-id="9399a-102">대량 복사 일괄 처리 크기 관리</span><span class="sxs-lookup"><span data-stu-id="9399a-102">Managing Bulk Copy Batch Sizes</span></span>
  <span data-ttu-id="9399a-103">대량 복사 작업에서 일괄 처리의 주요 목적은 트랜잭션의 범위를 정의하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-103">The primary purpose of a batch in bulk copy operations is to define the scope of a transaction.</span></span> <span data-ttu-id="9399a-104">일괄 처리 크기를 설정하지 않으면 대량 복사 함수에서 전체 대량 복사를 하나의 트랜잭션으로 간주합니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-104">If a batch size is not set, then bulk copy functions consider an entire bulk copy to be one transaction.</span></span> <span data-ttu-id="9399a-105">일괄 처리 크기를 설정하면 각 일괄 처리에서 일괄 처리가 완료될 때 커밋되는 하나의 트랜잭션이 구성됩니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-105">If a batch size is set, then each batch constitutes a transaction that is committed when the batch finishes.</span></span>  
  
 <span data-ttu-id="9399a-106">일괄 처리 크기를 지정하지 않고 대량 복사를 수행하는 동안 오류가 발생하면 전체 대량 복사가 롤백됩니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-106">If a bulk copy is performed with no batch size specified and an error is encountered, the entire bulk copy is rolled back.</span></span> <span data-ttu-id="9399a-107">장기 실행 대량 복사는 복구하는 데 오랜 시간이 걸릴 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-107">The recovery of a long-running bulk copy can take a long time.</span></span> <span data-ttu-id="9399a-108">일괄 처리 크기를 설정하면 대량 복사에서 각 일괄 처리를 하나의 트랜잭션으로 간주하고 각 일괄 처리를 커밋합니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-108">When a batch size is set, bulk copy considers each batch a transaction and commits each batch.</span></span> <span data-ttu-id="9399a-109">오류가 발생할 경우 처리 중인 마지막 일괄 작업만 롤백되면 됩니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-109">If an error is encountered, only the last outstanding batch needs to be rolled back.</span></span>  
  
 <span data-ttu-id="9399a-110">일괄 처리 크기는 잠금 오버헤드에도 영향을 줄 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-110">The batch size can also affect locking overhead.</span></span> <span data-ttu-id="9399a-111">에 대해 대량 복사를 수행 하는 경우 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] [bcp_control](../native-client-odbc-extensions-bulk-copy-functions/bcp-control.md) 를 사용 하 여 TABLOCK 힌트를 지정 하 여 행 잠금 대신 테이블 잠금을 획득할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-111">When performing a bulk copy against [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the TABLOCK hint can be specified using [bcp_control](../native-client-odbc-extensions-bulk-copy-functions/bcp-control.md) to acquire a table lock instead of row locks.</span></span> <span data-ttu-id="9399a-112">오버헤드를 최소화하여 전체 대량 복사 작업에 대해 단일 테이블 잠금을 보유할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-112">The single table lock can be held with minimal overhead for an entire bulk copy operation.</span></span> <span data-ttu-id="9399a-113">TABLOCK을 지정하지 않으면 개별 행에 잠금이 설정되고, 대량 복사 기간 동안 모든 잠금을 유지 관리하는 오버헤드로 인해 성능이 느려질 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-113">If TABLOCK is not specified then locks are held on individual rows and the overhead of maintaining all the locks for the duration of the bulk copy can slow performance.</span></span> <span data-ttu-id="9399a-114">트랜잭션 기간 동안에만 잠금이 보유되므로 일괄 처리 크기를 지정하면 현재 보유된 잠금을 해제하는 커밋이 정기적으로 생성되어 이 문제가 해결됩니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-114">Because locks are only held for the length of a transaction, specifying a batch size addresses this problem by periodically generating a commit that frees the locks currently held.</span></span>  
  
 <span data-ttu-id="9399a-115">많은 행을 대량 복사하는 경우 일괄 처리를 구성하는 행 수가 성능에 큰 영향을 줄 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-115">The number of rows making up a batch can have significant performance effects when bulk copying a large number of rows.</span></span> <span data-ttu-id="9399a-116">권장되는 일괄 처리 크기는 수행하는 대량 복사 유형에 따라 달라집니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-116">The recommendations for batch size depend on the type of bulk copy being performed.</span></span>  
  
-   <span data-ttu-id="9399a-117">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]로 대량 복사하는 경우 TABLOCK 대량 복사 힌트를 지정하고 큰 일괄 처리 크기를 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-117">When bulk copying to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], specify the TABLOCK bulk copy hint and set a large batch size.</span></span>  
  
-   <span data-ttu-id="9399a-118">TABLOCK이 지정되지 않은 경우 일괄 처리 크기를 1,000행 미만으로 제한합니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-118">When TABLOCK is not specified, limit batch sizes to less than 1,000 rows.</span></span>  
  
 <span data-ttu-id="9399a-119">데이터 파일에서 대량 복사 하는 경우 [bcp_exec](../native-client-odbc-extensions-bulk-copy-functions/bcp-exec.md)를 호출 하기 전에 bcpbatch 옵션과 함께 **bcp_control** 를 호출 하 여 일괄 처리 크기를 지정 합니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-119">When bulk copying in from a data file, the batch size is specified by calling **bcp_control** with the BCPBATCH option before calling [bcp_exec](../native-client-odbc-extensions-bulk-copy-functions/bcp-exec.md).</span></span> <span data-ttu-id="9399a-120">[Bcp_bind](../native-client-odbc-extensions-bulk-copy-functions/bcp-bind.md) 및 [bcp_sendrow](../native-client-odbc-extensions-bulk-copy-functions/bcp-sendrow.md)를 사용 하 여 프로그램 변수에서 대량 복사 하는 경우 [bcp_sendrow](../native-client-odbc-extensions-bulk-copy-functions/bcp-sendrow.md) *x* 번 호출한 후 [bcp_batch](../native-client-odbc-extensions-bulk-copy-functions/bcp-batch.md) 를 호출 하 여 일괄 처리 크기를 제어 합니다. 여기서 *x* 는 일괄 처리의 행 수입니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-120">When bulk copying from program variables using [bcp_bind](../native-client-odbc-extensions-bulk-copy-functions/bcp-bind.md) and [bcp_sendrow](../native-client-odbc-extensions-bulk-copy-functions/bcp-sendrow.md), the batch size is controlled by calling [bcp_batch](../native-client-odbc-extensions-bulk-copy-functions/bcp-batch.md) after calling [bcp_sendrow](../native-client-odbc-extensions-bulk-copy-functions/bcp-sendrow.md) *x* times, where *x* is the number of rows in a batch.</span></span>  
  
 <span data-ttu-id="9399a-121">트랜잭션 크기를 지정하는 것 외에도 일괄 처리는 행이 네트워크를 통해 서버로 전송되는 시기에 영향을 줍니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-121">In addition to specifying the size of a transaction, batches also affect when rows are sent across the network to the server.</span></span> <span data-ttu-id="9399a-122">대량 복사 함수는 일반적으로 네트워크 패킷이 채워질 때까지 **bcp_sendrow** 의 행을 캐시 한 다음 전체 패킷을 서버에 보냅니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-122">Bulk copy functions normally cache the rows from **bcp_sendrow** until a network packet is filled, and then send the full packet to the server.</span></span> <span data-ttu-id="9399a-123">그러나 응용 프로그램에서 **bcp_batch**를 호출 하는 경우에는 입력 된 내용이 있는지 여부에 관계 없이 현재 패킷이 서버에 전송 됩니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-123">When an application calls **bcp_batch**, however, the current packet is sent to the server regardless of whether it has been filled.</span></span> <span data-ttu-id="9399a-124">매우 작은 일괄 처리 크기를 사용하면 부분적으로 채워진 많은 패킷이 서버로 전송되므로 성능이 느려질 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-124">Using a very low batch size can slow performance if it results in sending many partially filled packets to the server.</span></span> <span data-ttu-id="9399a-125">예를 들어 모든 **bcp_sendrow** 후 **bcp_batch** 를 호출 하면 각 행이 별도의 패킷으로 전송 되 고 행이 너무 크면 각 패킷의 공간을 낭비 하 게 됩니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-125">For example, calling **bcp_batch** after every **bcp_sendrow** causes each row to be sent in a separate packet and, unless the rows are very large, wastes space in each packet.</span></span> <span data-ttu-id="9399a-126">SQL Server에 대 한 네트워크 패킷의 기본 크기는 4kb 이지만 응용 프로그램에서 SQL_ATTR_PACKET_SIZE 특성을 지정 하 여 [SQLSetConnectAttr](../native-client-odbc-api/sqlsetconnectattr.md) 를 호출 하 여 크기를 변경할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-126">The default size of network packets for SQL Server is 4 KB, although an application can change the size by calling [SQLSetConnectAttr](../native-client-odbc-api/sqlsetconnectattr.md) specifying the SQL_ATTR_PACKET_SIZE attribute.</span></span>  
  
 <span data-ttu-id="9399a-127">일괄 처리의 또 다른 부작용은 **bcp_batch**를 사용 하 여 완료 될 때까지 각 일괄 처리가 처리 되지 않은 결과 집합으로 간주 된다는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-127">Another side effect of batches is that each batch is considered an outstanding result set until it is completed with **bcp_batch**.</span></span> <span data-ttu-id="9399a-128">일괄 처리가 처리 중인 동안 연결 핸들에서 다른 작업을 시도 하면 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native CLIENT ODBC 드라이버는 SQLState = "HY000"와 오류 메시지 문자열을 사용 하 여 오류를 발생 시킵니다.</span><span class="sxs-lookup"><span data-stu-id="9399a-128">If any other operations are attempted on a connection handle while a batch is outstanding, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver issues an error with SQLState = "HY000" and an error message string of:</span></span>  
  
```  
"[Microsoft][SQL Server Native Client] Connection is busy with  
results for another hstmt."  
```  
  
## <a name="see-also"></a><span data-ttu-id="9399a-129">참고 항목</span><span class="sxs-lookup"><span data-stu-id="9399a-129">See Also</span></span>  
 <span data-ttu-id="9399a-130">[ODBC&#41;&#40;대량 복사 작업 수행](performing-bulk-copy-operations-odbc.md) </span><span class="sxs-lookup"><span data-stu-id="9399a-130">[Performing Bulk Copy Operations &#40;ODBC&#41;](performing-bulk-copy-operations-odbc.md) </span></span>  
 [<span data-ttu-id="9399a-131">데이터 대량 가져오기 및 내보내기&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="9399a-131">Bulk Import and Export of Data &#40;SQL Server&#41;</span></span>](../import-export/bulk-import-and-export-of-data-sql-server.md)  
  
  
