---
title: LOGON 트리거 | Microsoft 문서
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
f1_keywords:
- logon triggers
- login triggers
helpviewer_keywords:
- triggers [SQL Server], logon
ms.assetid: 2f0ebb2f-de10-482d-9806-1a5de5b312b8
author: rothja
ms.author: jroth
ms.openlocfilehash: cda0be25f07ed2ee283b9707884041e7c6e4692f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87660385"
---
# <a name="logon-triggers"></a><span data-ttu-id="83da4-102">LOGON 트리거</span><span class="sxs-lookup"><span data-stu-id="83da4-102">Logon Triggers</span></span>
  <span data-ttu-id="83da4-103">LOGON 트리거는 LOGON 이벤트에 대한 응답으로 저장 프로시저를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-103">Logon triggers fire stored procedures in response to a LOGON event.</span></span> <span data-ttu-id="83da4-104">이 이벤트는 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]인스턴스에 사용자 세션이 설정된 경우 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-104">This event is raised when a user session is established with an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="83da4-105">LOGON 트리거는 로그인의 인증 단계가 완료되었지만 사용자 세션이 실제로 설정되기 전에 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-105">Logon triggers fire after the authentication phase of logging in finishes, but before the user session is actually established.</span></span> <span data-ttu-id="83da4-106">따라서 오류 메시지 및 PRINT 문의 메시지와 같이 일반적으로 사용자에게 전달되는 모든 트리거 내 발생 메시지는 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 오류 로그로 전달됩니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-106">Therefore, all messages originating inside the trigger that would typically reach the user, such as error messages and messages from the PRINT statement, are diverted to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span> <span data-ttu-id="83da4-107">인증에 실패할 경우 LOGON 트리거는 실행되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-107">Logon triggers do not fire if authentication fails.</span></span>  
  
 <span data-ttu-id="83da4-108">LOGON 트리거를 사용하면 로그인 작업 추적, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]에 대한 로그인 제한, 특정 로그인에 대한 세션 수 제한 등의 작업을 수행하여 서버 세션을 감사하고 제어할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-108">You can use logon triggers to audit and control server sessions, such as by tracking login activity, restricting logins to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], or limiting the number of sessions for a specific login.</span></span> <span data-ttu-id="83da4-109">예를 들어 다음 코드에서 LOGON 트리거는 로그인 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login_test *가 이미 3개의 사용자 세션을 만든 상태에서* 에 대한 로그인을 시도하면 해당 요청을 거부합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-109">For example, in the following code, the logon trigger denies log in attempts to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] initiated by login *login_test* if there are already three user sessions created by that login.</span></span>  
  
 [!code-sql[TriggerDDL#LogonTrigger1](../../snippets/tsql/SQL14/tsql/triggerddl/transact-sql/snippet_create_alter_drop_trigger.sql#logontrigger1)]  
  
 <span data-ttu-id="83da4-110">LOGON 이벤트는 [이벤트 알림](../service-broker/event-notifications.md)에 사용될 수 있는 AUDIT_LOGIN SQL 추적 이벤트에 해당합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-110">Note that the LOGON event corresponds to the AUDIT_LOGIN SQL Trace event, which can be used in [Event Notifications](../service-broker/event-notifications.md).</span></span> <span data-ttu-id="83da4-111">트리거와 이벤트 알림의 주요 차이점은 트리거는 이벤트와 동기적으로 발생하지만 이벤트 알림은 비동기적으로 발생한다는 점입니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-111">The primary difference between triggers and event notifications is that triggers are raised synchronously with events, whereas event notifications are asynchronous.</span></span> <span data-ttu-id="83da4-112">즉, 세션이 설정되지 않도록 하려는 경우 등에서 LOGON 트리거를 사용해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-112">This means, for example, that if you want to stop a session from being established, you must use a logon trigger.</span></span> <span data-ttu-id="83da4-113">이런 경우에는 AUDIT_LOGIN 이벤트의 이벤트 알림을 사용할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-113">An event notification on an AUDIT_LOGIN event cannot be used for this purpose.</span></span>  
  
## <a name="specifying-first-and-last-trigger"></a><span data-ttu-id="83da4-114">첫 번째 트리거 및 마지막 트리거 지정</span><span class="sxs-lookup"><span data-stu-id="83da4-114">Specifying First and Last Trigger</span></span>  
 <span data-ttu-id="83da4-115">LOGON 이벤트에 여러 트리거를 정의할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-115">Multiple triggers can be defined on the LOGON event.</span></span> <span data-ttu-id="83da4-116">[sp_settriggerorder](/sql/relational-databases/system-stored-procedures/sp-settriggerorder-transact-sql) 시스템 저장 프로시저를 사용하여 이러한 트리거 중 하나를 이벤트에서 실행될 첫 번째 트리거나 마지막 트리거로 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-116">Any one of these triggers can be designated the first or last trigger to be fired on an event by using the [sp_settriggerorder](/sql/relational-databases/system-stored-procedures/sp-settriggerorder-transact-sql) system stored procedure.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="83da4-117">는 남은 트리거의 실행 순서를 보장하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-117">does not guarantee the execution order of the remaining triggers.</span></span>  
  
## <a name="managing-transactions"></a><span data-ttu-id="83da4-118">트랜잭션 관리</span><span class="sxs-lookup"><span data-stu-id="83da4-118">Managing Transactions</span></span>  
 <span data-ttu-id="83da4-119">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 에서 LOGON 트리거를 실행하기 전에 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 에서는 어느 사용자 트랜잭션에도 종속되지 않은 암시적 트랜잭션을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-119">Before [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] fires a logon trigger, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] creates an implicit transaction that is independent from any user transaction.</span></span> <span data-ttu-id="83da4-120">따라서 첫 번째 LOGON 트리거가 실행을 시작하면 트랜잭션 개수가 1개입니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-120">Therefore, when the first logon trigger starts firing, the transaction count is 1.</span></span> <span data-ttu-id="83da4-121">모든 LOGON 트리거가 실행을 마친 후 트랜잭션은 커밋됩니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-121">After all the logon triggers finish executing, the transaction commits.</span></span> <span data-ttu-id="83da4-122">다른 트리거 유형과 마찬가지로 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 에서는 LOGON 트리거가 0개의 트랜잭션 개수로 실행을 마칠 경우 오류가 반환됩니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-122">As with other types of triggers, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] returns an error if a logon trigger finishes execution with a transaction count of 0.</span></span> <span data-ttu-id="83da4-123">ROLLBACK TRANSACTION 문은 중첩된 트랜잭션 내에서 문이 실행될 경우에도 트랜잭션 개수를 0으로 다시 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-123">The ROLLBACK TRANSACTION statement resets the transaction count to 0, even if the statement is issued inside a nested transaction.</span></span> <span data-ttu-id="83da4-124">COMMIT TRANSACTION은 트랜잭션 개수를 0으로 감소시킬 수 있으므로</span><span class="sxs-lookup"><span data-stu-id="83da4-124">COMMIT TRANSACTION might decrement the transaction count to 0.</span></span> <span data-ttu-id="83da4-125">로그온 트리거 내에서 COMMIT TRANSACTION 문을 실행하지 않는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-125">Therefore, we advise against issuing COMMIT TRANSACTION statements inside logon triggers.</span></span>  
  
 <span data-ttu-id="83da4-126">LOGON 트리거 내에서 ROLLBACK TRANSACTION 문을 사용할 때는 다음을 고려하십시오.</span><span class="sxs-lookup"><span data-stu-id="83da4-126">Consider the following when you are using a ROLLBACK TRANSACTION statement inside logon triggers:</span></span>  
  
-   <span data-ttu-id="83da4-127">ROLLBACK TRANSACTION에 대한 모든 데이터 수정 사항은 롤백됩니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-127">Any data modifications made up to the point of ROLLBACK TRANSACTION are rolled back.</span></span> <span data-ttu-id="83da4-128">이러한 수정 사항에는 동일한 이벤트에서 실행된 이전 트리거와 현재 트리거에 의해 수정된 내용이 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-128">These modifications include those made by the current trigger and those made by previous triggers that executed on the same event.</span></span> <span data-ttu-id="83da4-129">특정 이벤트에 대한 남은 트리거는 모두 실행되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-129">Any remaining triggers for the specific event are not executed.</span></span>  
  
-   <span data-ttu-id="83da4-130">현재 트리거는 ROLLBACK 문 다음에 표시되는 남아 있는 모든 문을 계속 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-130">The current trigger continues to execute any remaining statements that appear after the ROLLBACK statement.</span></span> <span data-ttu-id="83da4-131">이 문 중에서 데이터를 수정한 경우 수정 사항은 롤백되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-131">If any of these statements modify data, the modifications are not rolled back.</span></span>  
  
 <span data-ttu-id="83da4-132">LOGON 이벤트의 트리거가 실행되는 동안 다음 조건 중 하나라도 발생할 경우 사용자 세션이 설정되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-132">A user session is not established if any one of the following conditions occur during execution of a trigger on a LOGON event:</span></span>  
  
-   <span data-ttu-id="83da4-133">원래 암시적 트랜잭션이 롤백되거나 실패합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-133">The original implicit transaction is rolled back or fails.</span></span>  
  
-   <span data-ttu-id="83da4-134">심각도가 20 이상인 오류가 트리거 본문 내에 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-134">An error that has severity greater than 20 is raised inside the trigger body.</span></span>  
  
## <a name="disabling-a-logon-trigger"></a><span data-ttu-id="83da4-135">로그온 트리거 비활성화</span><span class="sxs-lookup"><span data-stu-id="83da4-135">Disabling a Logon Trigger</span></span>  
 <span data-ttu-id="83da4-136">로그온 트리거를 사용하면 `sysadmin` 고정 서버 역할의 멤버를 비롯한 모든 사용자에 대해 [!INCLUDE[ssDE](../../../includes/ssde-md.md)]에 성공적으로 연결하지 못하도록 효과적으로 차단할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-136">A logon trigger can effectively prevent successful connections to the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] for all users, including members of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="83da4-137">로그온 트리거가 연결을 차단 중인 경우 `sysadmin` 고정 서버 역할의 멤버는 관리자 전용 연결을 사용하거나 최소 구성 모드(-f)로 [!INCLUDE[ssDE](../../../includes/ssde-md.md)]을 시작하여 연결할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-137">When a logon trigger is preventing connections, members of the `sysadmin` fixed server role can connect by using the dedicated administrator connection, or by starting the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] in minimal configuration mode (-f).</span></span> <span data-ttu-id="83da4-138">자세한 내용은 [Database Engine Service Startup Options](../../database-engine/configure-windows/database-engine-service-startup-options.md)을(를) 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="83da4-138">For more information, see [Database Engine Service Startup Options](../../database-engine/configure-windows/database-engine-service-startup-options.md).</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="83da4-139">관련 작업</span><span class="sxs-lookup"><span data-stu-id="83da4-139">Related Tasks</span></span>  
  
|<span data-ttu-id="83da4-140">Task</span><span class="sxs-lookup"><span data-stu-id="83da4-140">Task</span></span>|<span data-ttu-id="83da4-141">항목</span><span class="sxs-lookup"><span data-stu-id="83da4-141">Topic</span></span>|  
|----------|-----------|  
|<span data-ttu-id="83da4-142">로그온 트리거를 만드는 방법에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-142">Describes how to create logon triggers.</span></span> <span data-ttu-id="83da4-143">LOGON 트리거는 모든 데이터베이스에서 만들 수 있지만 서버 수준에서 등록되며 **master** 데이터베이스에 저장됩니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-143">Logon triggers can be created from any database, but are registered at the server level and reside in the **master** database.</span></span>|[<span data-ttu-id="83da4-144">CREATE TRIGGER&#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="83da4-144">CREATE TRIGGER &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-trigger-transact-sql)|  
|<span data-ttu-id="83da4-145">로그온 트리거를 수정하는 방법에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-145">Describes how to modify logon triggers.</span></span>|[<span data-ttu-id="83da4-146">ALTER TRIGGER&#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="83da4-146">ALTER TRIGGER &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-trigger-transact-sql)|  
|<span data-ttu-id="83da4-147">로그온 트리거를 삭제하는 방법에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-147">Describes how to delete logon triggers.</span></span>|[<span data-ttu-id="83da4-148">DROP TRIGGER&#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="83da4-148">DROP TRIGGER &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-trigger-transact-sql)|  
|<span data-ttu-id="83da4-149">로그온 트리거에 대한 정보를 반환하는 방법에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-149">Describes how to return information about logon triggers.</span></span>|[<span data-ttu-id="83da4-150">sys.server_triggers&#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="83da4-150">sys.server_triggers &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-server-triggers-transact-sql)<br /><br /> [<span data-ttu-id="83da4-151">sys.server_trigger_events&#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="83da4-151">sys.server_trigger_events &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-server-trigger-events-transact-sql)|  
|<span data-ttu-id="83da4-152">로그온 트리거 이벤트 데이터를 캡처하는 방법에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="83da4-152">Describes how to capture logon trigger event data.</span></span>||  
  
## <a name="see-also"></a><span data-ttu-id="83da4-153">참고 항목</span><span class="sxs-lookup"><span data-stu-id="83da4-153">See Also</span></span>  
 [<span data-ttu-id="83da4-154">DDL 트리거</span><span class="sxs-lookup"><span data-stu-id="83da4-154">DDL Triggers</span></span>](../triggers/ddl-triggers.md)  
  
  
