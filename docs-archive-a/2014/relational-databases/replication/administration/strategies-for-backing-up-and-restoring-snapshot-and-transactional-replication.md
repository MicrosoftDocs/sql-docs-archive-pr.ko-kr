---
title: 스냅샷 및 트랜잭션 복제의 백업 및 복원 전략 | Microsoft 문서
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- backups [SQL Server replication], snapshot replication
- restoring [SQL Server replication], transactional replication
- snapshot replication [SQL Server], backup and restore
- restoring [SQL Server replication], snapshot replication
- recovery [SQL Server replication], transactional replication
- transactional replication, backup and restore
- recovery [SQL Server replication], snapshot replication
- sync with backup [SQL Server replication]
- backups [SQL Server replication], transactional replication
ms.assetid: a8afcdbc-55db-4916-a219-19454f561f9e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: e26f6cf1a61e4df9db79bc5fd90429f86d70a99f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87661646"
---
# <a name="strategies-for-backing-up-and-restoring-snapshot-and-transactional-replication"></a><span data-ttu-id="89fd8-102">스냅샷 및 트랜잭션 복제의 백업 및 복원을 위한 전략</span><span class="sxs-lookup"><span data-stu-id="89fd8-102">Strategies for Backing Up and Restoring Snapshot and Transactional Replication</span></span>
  <span data-ttu-id="89fd8-103">스냅샷 및 트랜잭션 복제에 대한 백업 및 복원 전략을 설계할 때 다음 세 가지 영역을 고려해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-103">When you design a backup and restore strategy for snapshot and transactional replication, there are three areas to consider:</span></span>  
  
-   <span data-ttu-id="89fd8-104">백업할 데이터베이스</span><span class="sxs-lookup"><span data-stu-id="89fd8-104">Which databases to back up.</span></span>  
  
-   <span data-ttu-id="89fd8-105">트랜잭션 복제에 대한 백업 설정</span><span class="sxs-lookup"><span data-stu-id="89fd8-105">Backup settings for transactional replication.</span></span>  
  
-   <span data-ttu-id="89fd8-106">데이터베이스를 복원하는 데 필요한 단계.</span><span class="sxs-lookup"><span data-stu-id="89fd8-106">The steps that are required to restore a database.</span></span> <span data-ttu-id="89fd8-107">이 단계는 선택한 복제 유형 및 옵션에 따라 달라집니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-107">These depend on the type of replication and options chosen.</span></span>  
  
 <span data-ttu-id="89fd8-108">이 항목에서는 다음 3개의 섹션에서 각 영역을 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-108">This topic covers each of these areas in the next three sections.</span></span> <span data-ttu-id="89fd8-109">Oracle 게시에 대한 백업 및 복원에 대한 자세한 내용은 [Oracle 게시자 백업 및 복원](../non-sql/backup-and-restore-for-oracle-publishers.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-109">For information about backup and restore for Oracle publishing, see [Backup and Restore for Oracle Publishers](../non-sql/backup-and-restore-for-oracle-publishers.md).</span></span>  
  
## <a name="backing-up-databases"></a><span data-ttu-id="89fd8-110">데이터베이스 백업</span><span class="sxs-lookup"><span data-stu-id="89fd8-110">Backing up Databases</span></span>  
 <span data-ttu-id="89fd8-111">스냅샷 및 트랜잭션 복제의 경우 다음 데이터베이스를 정기적으로 백업해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-111">For snapshot and transactional replication, you should regularly back up the following databases:</span></span>  
  
-   <span data-ttu-id="89fd8-112">게시자의 게시 데이터베이스</span><span class="sxs-lookup"><span data-stu-id="89fd8-112">The publication database at the Publisher.</span></span>  
  
-   <span data-ttu-id="89fd8-113">배포자의 배포 데이터베이스</span><span class="sxs-lookup"><span data-stu-id="89fd8-113">The distribution database at the Distributor.</span></span>  
  
-   <span data-ttu-id="89fd8-114">각 구독자의 구독 데이터베이스</span><span class="sxs-lookup"><span data-stu-id="89fd8-114">The subscription database at each Subscriber.</span></span>  
  
-   <span data-ttu-id="89fd8-115">게시자, 배포자 및 모든 구독자의 **master** 및 **msdb** 시스템 데이터베이스.</span><span class="sxs-lookup"><span data-stu-id="89fd8-115">The **master** and **msdb** system databases at the Publisher, Distributor and all Subscribers.</span></span> <span data-ttu-id="89fd8-116">이러한 데이터베이스는 각각 그리고 관련 복제 데이터베이스와 동시에 백업되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-116">These databases should be backed up at the same time as each other and the relevant replication database.</span></span> <span data-ttu-id="89fd8-117">예를 들어 게시 데이터베이스를 백업할 때는 게시자의 **master** 및 **msdb** 데이터베이스를 동시에 백업합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-117">For example, back up the **master** and **msdb** databases at the Publisher at the same time that you back up the publication database.</span></span> <span data-ttu-id="89fd8-118">게시 데이터베이스를 복원한 경우에는 **master** 및 **msdb** 데이터베이스의 복제 구성 및 설정이 게시 데이터베이스와 일치하는지 확인해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-118">If the publication database is restored, make sure that the **master** and **msdb** databases are consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
 <span data-ttu-id="89fd8-119">정기적인 로그 백업을 수행할 경우 모든 복제 관련 변경 내용은 로그 백업에 캡처됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-119">If you perform regular log backups, any replication-related changes should be captured in the log backups.</span></span> <span data-ttu-id="89fd8-120">로그 백업을 수행하지 않는 경우 복제와 관련된 설정이 변경될 때마다 백업을 수행해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-120">If you do not perform log backups, a backup should be performed whenever a setting relevant to replication is changed.</span></span> <span data-ttu-id="89fd8-121">자세한 내용은 [Common Actions Requiring an Updated Backup](common-actions-requiring-an-updated-backup.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-121">For more information, see [Common Actions Requiring an Updated Backup](common-actions-requiring-an-updated-backup.md).</span></span>  
  
## <a name="backup-settings-for-transactional-replication"></a><span data-ttu-id="89fd8-122">트랜잭션 복제에 대한 백업 설정</span><span class="sxs-lookup"><span data-stu-id="89fd8-122">Backup Settings for Transactional Replication</span></span>  
 <span data-ttu-id="89fd8-123">트랜잭션 복제 과정에는 배포 데이터베이스 및 게시 데이터베이스에 설정할 수 있는 **sync with backup** 옵션이 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-123">Transactional replication includes using the **sync with backup** option, which can be set on the distribution database and the publication database:</span></span>  
  
-   <span data-ttu-id="89fd8-124">배포 데이터베이스에는 이 옵션을 항상 설정하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-124">We recommend that you always set this option on the distribution database.</span></span>  
  
     <span data-ttu-id="89fd8-125">배포 데이터베이스에 이 옵션을 설정하면 게시 데이터베이스 로그의 트랜잭션은 배포 데이터베이스에서 백업될 때까지 잘리지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-125">Setting this option on the distribution database ensures that transactions in the log of the publication database will not be truncated until they have been backed up at the distribution database.</span></span> <span data-ttu-id="89fd8-126">배포 데이터베이스는 마지막 백업으로 복원할 수 있으며 손실된 트랜잭션은 게시 데이터베이스에서 배포 데이터베이스로 배달됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-126">The distribution database can be restored to the last backup, and any missing transactions are delivered from the publication database to the distribution database.</span></span> <span data-ttu-id="89fd8-127">복제는 아무런 영향 없이 계속됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-127">Replication continues unaffected.</span></span>  
  
     <span data-ttu-id="89fd8-128">배포 데이터베이스에 이 옵션을 설정해도 복제 지연 시간에는 영향을 주지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-128">Setting this option on the distribution database does not affect replication latency.</span></span> <span data-ttu-id="89fd8-129">그러나 배포 데이터베이스의 해당 트랜잭션이 백업될 때까지 게시 데이터베이스의 로그 잘라내기가 지연됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-129">However, the option will delay the truncation of the log on the publication database until the corresponding transactions in the distribution database have been backed up.</span></span> <span data-ttu-id="89fd8-130">이로 인해 게시 데이터베이스에 더 큰 트랜잭션 로그가 만들어질 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-130">(This can create a larger transaction log in the publication database.)</span></span>  
  
-   <span data-ttu-id="89fd8-131">애플리케이션에서 추가 대기 시간을 허용할 수 있는 경우 게시 데이터베이스에 이 옵션을 설정하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-131">We recommend that you set this option on the publication database if your application can tolerate additional latency.</span></span>  
  
     <span data-ttu-id="89fd8-132">게시 데이터베이스에 이 옵션을 설정하면 트랜잭션은 게시 데이터베이스에서 백업될 때까지 배포 데이터베이스로 배달되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-132">Setting this option on the publication database ensures that transactions are not delivered to the distribution database until they are backed up at the publication database.</span></span> <span data-ttu-id="89fd8-133">그러면 복원된 게시 데이터베이스에 없는 트랜잭션이 배포 데이터베이스에 있을 수 없으므로 게시자에서 마지막 게시 데이터베이스 백업을 복원할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-133">The last publication database backup can then be restored at the Publisher without any chance of the distribution database having transactions that the restored publication database does not have.</span></span>  
  
     <span data-ttu-id="89fd8-134">트랜잭션이 게시자에서 백업될 때까지 배포 데이터베이스로 배달될 수 없으므로 지연 시간 및 처리량에 영향을 받습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-134">Latency and throughput are affected because transactions cannot be delivered to the distribution database until they have been backed up at the Publisher.</span></span> <span data-ttu-id="89fd8-135">예를 들어 트랜잭션 로그가 5분마다 백업되는 경우에는 트랜잭션이 게시자에서 커밋된 후 배포 데이터베이스와 구독자로 차례로 배달되기까지 5분의 추가 대기 시간이 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-135">For example, if the transaction log is backed up every five minutes, there is an additional five minutes of latency between when a transaction is committed at the Publisher and when the transaction is delivered to the distribution database, and subsequently the Subscriber.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="89fd8-136">**sync with backup** 옵션을 사용하면 게시 데이터베이스와 배포 데이터베이스 간의 일관성을 유지할 수 있지만 데이터가 손실될 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-136">The **sync with backup** option ensures consistency between the publication database and the distribution database, but the option does not guarantee against data loss.</span></span> <span data-ttu-id="89fd8-137">예를 들어 트랜잭션 로그가 손실되는 경우 마지막 트랜잭션 로그 백업 이후에 커밋된 트랜잭션은 게시 데이터베이스 또는 배포 데이터베이스에서 사용할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-137">For example, if the transaction log is lost, transactions that have been committed since the last transaction log backup will not be available in the publication database or the distribution database.</span></span> <span data-ttu-id="89fd8-138">이 동작은 복제되지 않는 데이터베이스에서도 같습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-138">This is the same behavior as a nonreplicated database.</span></span>  
  
 <span data-ttu-id="89fd8-139">**sync with backup 옵션을 설정하려면**</span><span class="sxs-lookup"><span data-stu-id="89fd8-139">**To set the sync with backup option**</span></span>  
  
-   <span data-ttu-id="89fd8-140">복제 [!INCLUDE[tsql](../../../includes/tsql-md.md)] 프로그래밍: [트랜잭션 복제에 대해 통합 백업 사용&#40;복제 Transact-SQL 프로그래밍&#41;](enable-coordinated-backups-for-transactional-replication.md)</span><span class="sxs-lookup"><span data-stu-id="89fd8-140">Replication [!INCLUDE[tsql](../../../includes/tsql-md.md)] programming: [Enable Coordinated Backups for Transactional Replication &#40;Replication Transact-SQL Programming&#41;](enable-coordinated-backups-for-transactional-replication.md)</span></span>  
  
## <a name="restoring-databases-involved-in-replication"></a><span data-ttu-id="89fd8-141">복제와 관련된 데이터베이스 복원</span><span class="sxs-lookup"><span data-stu-id="89fd8-141">Restoring Databases Involved in Replication</span></span>  
 <span data-ttu-id="89fd8-142">최근 백업을 사용할 수 있는 상태에서 적절한 단계를 수행하면 복제 토폴로지의 모든 데이터베이스를 복원할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-142">You can restore all databases in a replication topology if recent backups are available and the appropriate steps are followed.</span></span> <span data-ttu-id="89fd8-143">게시 데이터베이스의 복원 단계는 사용된 복제 유형 및 옵션에 따라 다르지만 다른 모든 데이터베이스의 복원 단계는 유형 및 옵션과 상관이 없습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-143">The restore steps for the publication database depend on the type of replication and options that are used; however, the restore steps for all other databases are independent of the type and options.</span></span>  
  
 <span data-ttu-id="89fd8-144">복제에서는 복제된 데이터베이스를 백업이 생성된 서버 및 데이터베이스로 복원할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-144">Replication supports restoring replicated databases to the same server and database from which the backup was created.</span></span> <span data-ttu-id="89fd8-145">복제된 데이터베이스의 백업을 다른 서버 또는 데이터베이스로 복원할 경우 복제 설정은 유지되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-145">If you restore a backup of a replicated database to another server or database, replication settings cannot be preserved.</span></span> <span data-ttu-id="89fd8-146">이 경우 백업 복원 후 모든 게시 및 구독을 다시 만들어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-146">In this case, you must re-create all publications and subscriptions after backups are restored.</span></span>  
  
### <a name="publisher"></a><span data-ttu-id="89fd8-147">게시자</span><span class="sxs-lookup"><span data-stu-id="89fd8-147">Publisher</span></span>  
 <span data-ttu-id="89fd8-148">다음과 같은 복제 유형에 대한 복원 단계가 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-148">There are restore steps provided for the following types of replication:</span></span>  
  
-   <span data-ttu-id="89fd8-149">스냅샷 복제</span><span class="sxs-lookup"><span data-stu-id="89fd8-149">Snapshot replication</span></span>  
  
-   <span data-ttu-id="89fd8-150">읽기 전용 트랜잭션 복제</span><span class="sxs-lookup"><span data-stu-id="89fd8-150">Read-only transactional replication</span></span>  
  
-   <span data-ttu-id="89fd8-151">구독 업데이트가 있는 트랜잭션 복제</span><span class="sxs-lookup"><span data-stu-id="89fd8-151">Transactional replication with updating subscriptions</span></span>  
  
-   <span data-ttu-id="89fd8-152">피어 투 피어 트랜잭션 복제</span><span class="sxs-lookup"><span data-stu-id="89fd8-152">Peer-to-peer transactional replication</span></span>  
  
 <span data-ttu-id="89fd8-153">이 4가지 복제에 대한 **msdb** 데이터베이스 및 **master** 데이터베이스(이 섹션에서 함께 설명됨)의 복원은 모두 동일합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-153">The restore of the **msdb** and **master** databases, which are also covered in this section, is the same for all four types.</span></span>  
  
#### <a name="publication-database-snapshot-replication"></a><span data-ttu-id="89fd8-154">게시 데이터베이스: Snapshot Replication</span><span class="sxs-lookup"><span data-stu-id="89fd8-154">Publication Database: Snapshot Replication</span></span>  
  
1.  <span data-ttu-id="89fd8-155">게시 데이터베이스의 최신 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-155">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="89fd8-156">2단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-156">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="89fd8-157">게시 데이터베이스 백업이 모든 게시 및 구독에 대한 최신 구성을 포함하고 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-157">Does the publication database backup contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="89fd8-158">그렇다면 복원이 완료된 것이며,</span><span class="sxs-lookup"><span data-stu-id="89fd8-158">If yes, the restore is completed.</span></span> <span data-ttu-id="89fd8-159">그렇지 않으면 3단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-159">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="89fd8-160">게시자, 배포자 및 구독자에서 복제 구성을 제거한 후 구성을 다시 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-160">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="89fd8-161">이 단계로 복원이 완료됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-161">Restore is completed.</span></span>  
  
     <span data-ttu-id="89fd8-162">복제를 제거하는 방법은 [sp_removedbreplication&#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-162">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
#### <a name="publication-database-read-only-transactional-replication"></a><span data-ttu-id="89fd8-163">게시 데이터베이스: 읽기 전용 트랜잭션 복제</span><span class="sxs-lookup"><span data-stu-id="89fd8-163">Publication Database: Read-Only Transactional Replication</span></span>  
  
1.  <span data-ttu-id="89fd8-164">게시 데이터베이스의 최신 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-164">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="89fd8-165">2단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-165">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="89fd8-166">실패하기 전에 게시 데이터베이스에 **sync with backup** 옵션을 설정했는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-166">Was the **sync with backup** setting enabled on the publication database before the failure?</span></span> <span data-ttu-id="89fd8-167">옵션을 설정했으면 3단계로 이동하고, 그렇지 않으면 5단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-167">If yes, go to step 3; if no, go to step 5.</span></span>  
  
     <span data-ttu-id="89fd8-168">옵션이 설정되어 있으면 `SELECT DATABASEPROPERTYEX('<PublicationDatabaseName>', 'IsSyncWithBackup')` 쿼리가 '1'을 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-168">If the setting is enabled, the query `SELECT DATABASEPROPERTYEX('<PublicationDatabaseName>', 'IsSyncWithBackup')` returns '1'.</span></span>  
  
3.  <span data-ttu-id="89fd8-169">복원된 백업이 완료되었으며 최신 상태인지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-169">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="89fd8-170">또한 모든 게시 및 구독에 대한 최신 구성을 포함하고 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-170">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="89fd8-171">그렇다면 복원이 완료된 것이며,</span><span class="sxs-lookup"><span data-stu-id="89fd8-171">If yes, the restore is completed.</span></span> <span data-ttu-id="89fd8-172">그렇지 않으면 4단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-172">If no, go to step 4.</span></span>  
  
4.  <span data-ttu-id="89fd8-173">복원된 게시 데이터베이스의 구성 정보가 최신 상태가 아닙니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-173">The configuration information in the restored publication database is not up-to-date.</span></span> <span data-ttu-id="89fd8-174">따라서 배포 데이터베이스의 처리 중인 모든 명령이 구독자에 배포되었는지 확인한 다음 복제 구성을 삭제하고 다시 만들어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-174">Therefore, you must make sure that the Subscribers have all outstanding commands in the distribution database, and then drop and re-create the replication configuration.</span></span>  
  
    1.  <span data-ttu-id="89fd8-175">모든 구독자가 배포 데이터베이스의 처리 중인 명령과 동기화될 때까지 배포 에이전트를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-175">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="89fd8-176">복제 모니터에서 **배포되지 않은 명령** 탭을 사용하거나 배포 데이터베이스에서 [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) 뷰를 쿼리하여 모든 명령이 구독자에 배달되었는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-176">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="89fd8-177">b 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-177">Go to step b.</span></span>  
  
         <span data-ttu-id="89fd8-178">배포 에이전트를 실행하는 방법은 [복제 에이전트 시작 및 중지&#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) 및 [복제 에이전트 실행 파일 개념](../concepts/replication-agent-executables-concepts.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-178">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
         <span data-ttu-id="89fd8-179">명령을 확인 하는 방법에 대 한 자세한 내용은 복제 [Transact-sql 프로그래밍 &#40;복제 Transact-sql 프로그래밍&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) 및 [복제 모니터를 사용 하 여 정보 보기 및 작업 수행](../monitor/view-information-and-perform-tasks-replication-monitor.md)을 참조 하십시오.</span><span class="sxs-lookup"><span data-stu-id="89fd8-179">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
    2.  <span data-ttu-id="89fd8-180">게시자, 배포자 및 구독자에서 복제 구성을 제거한 후 구성을 다시 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-180">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="89fd8-181">구독을 다시 만들 때 구독자에 이미 데이터가 있다고 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-181">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="89fd8-182">이로써 복원이 완료됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-182">The restore is completed.</span></span>  
  
         <span data-ttu-id="89fd8-183">복제를 제거하는 방법은 [sp_removedbreplication&#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-183">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="89fd8-184">구독자에 이미 데이터가 있다고 지정하는 방법은 [Initialize a Subscription Manually](../initialize-a-subscription-manually.md)를 참조하십시오.</span><span class="sxs-lookup"><span data-stu-id="89fd8-184">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
5.  <span data-ttu-id="89fd8-185">게시 데이터베이스에 **sync with backup** 옵션이 설정되지 않아서</span><span class="sxs-lookup"><span data-stu-id="89fd8-185">The **sync with backup** option was not set on the publication database.</span></span> <span data-ttu-id="89fd8-186">복원된 백업에 포함되지 않은 트랜잭션이 배포자 및 구독자에 배달되었을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-186">Therefore, transactions that were not included in the restored backup might have been delivered to the Distributor and Subscribers.</span></span> <span data-ttu-id="89fd8-187">배포 데이터베이스의 처리 중인 모든 명령이 구독자에 배달되었는지 확인한 다음 복원된 백업에 포함되지 않은 모든 트랜잭션을 게시 데이터베이스에 수동으로 적용해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-187">You must now make sure that Subscribers have all outstanding commands in the distribution database, and then manually apply to the publication database any transactions that are not included in the restored backup.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="89fd8-188">이 과정을 수행하면 게시된 테이블이 백업에서 복원된 다른 비게시 테이블보다 더 최신 시점으로 복원될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-188">Performing this process can cause published tables to be restored to a point in time that is more recent than the point in time of other nonpublished tables that are restored from the backup.</span></span>  
  
    1.  <span data-ttu-id="89fd8-189">모든 구독자가 배포 데이터베이스의 처리 중인 명령과 동기화될 때까지 배포 에이전트를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-189">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="89fd8-190">복제 모니터에서 **배포되지 않은 명령** 탭을 사용하거나 배포 데이터베이스에서 [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) 뷰를 쿼리하여 모든 명령이 구독자에 배달되었는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-190">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="89fd8-191">b 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-191">Go to step b.</span></span>  
  
         <span data-ttu-id="89fd8-192">배포 에이전트를 실행하는 방법은 [복제 에이전트 시작 및 중지&#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) 및 [복제 에이전트 실행 파일 개념](../concepts/replication-agent-executables-concepts.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-192">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
         <span data-ttu-id="89fd8-193">명령을 확인 하는 방법에 대 한 자세한 내용은 복제 [Transact-sql 프로그래밍 &#40;복제 Transact-sql 프로그래밍&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) 및 [복제 모니터를 사용 하 여 정보 보기 및 작업 수행](../monitor/view-information-and-perform-tasks-replication-monitor.md)을 참조 하십시오.</span><span class="sxs-lookup"><span data-stu-id="89fd8-193">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
    2.  <span data-ttu-id="89fd8-194">[tablediff 유틸리티](../../../tools/tablediff-utility.md) 또는 다른 도구를 사용하여 게시자를 구독자와 수동으로 동기화합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-194">Use the [tablediff utility](../../../tools/tablediff-utility.md) or another tool to manually synchronize the Publisher with the Subscriber.</span></span> <span data-ttu-id="89fd8-195">이렇게 하면 게시 데이터베이스 백업에 포함되지 않은 데이터를 구독 데이터베이스에서 복구할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-195">This enables you to recover data from the subscription database that was not contained in the publication database backup.</span></span> <span data-ttu-id="89fd8-196">c 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-196">Go to step c.</span></span>  
  
         <span data-ttu-id="89fd8-197">**tablediff** 유틸리티에 대한 자세한 내용은 [복제된 테이블의 차이점 비교&#40;복제 프로그래밍&#41;](compare-replicated-tables-for-differences-replication-programming.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-197">For more information about the **tablediff** utility, see [Compare Replicated Tables for Differences &#40;Replication Programming&#41;](compare-replicated-tables-for-differences-replication-programming.md).</span></span>  
  
    3.  <span data-ttu-id="89fd8-198">복원된 백업이 완료되었으며 최신 상태인지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-198">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="89fd8-199">또한 모든 게시 및 구독에 대한 최신 구성을 포함하고 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-199">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="89fd8-200">그렇다면 저장 프로시저 [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) 를 실행하여 게시자 메타데이터를 배포자 메타데이터와 다시 동기화합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-200">If yes, execute the [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) stored procedure to resynchronize the Publisher metadata with the Distributor metadata.</span></span> <span data-ttu-id="89fd8-201">이로써 복원이 완료됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-201">The restore is completed.</span></span> <span data-ttu-id="89fd8-202">그렇지 않으면 d 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-202">If no, go to step d.</span></span>  
  
    4.  <span data-ttu-id="89fd8-203">게시자, 배포자 및 구독자에서 복제 구성을 제거한 후 구성을 다시 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-203">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="89fd8-204">구독을 다시 만들 때 구독자에 이미 데이터가 있다고 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-204">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="89fd8-205">이로써 복원이 완료됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-205">The restore is completed.</span></span>  
  
         <span data-ttu-id="89fd8-206">복제를 제거하는 방법은 [sp_removedbreplication&#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-206">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="89fd8-207">구독자에 이미 데이터가 있다고 지정하는 방법은 [Initialize a Subscription Manually](../initialize-a-subscription-manually.md)를 참조하십시오.</span><span class="sxs-lookup"><span data-stu-id="89fd8-207">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="publication-database-transactional-replication-with-updating-subscriptions"></a><span data-ttu-id="89fd8-208">게시 데이터베이스: 업데이트 구독을 사용한 트랜잭션 복제</span><span class="sxs-lookup"><span data-stu-id="89fd8-208">Publication Database: Transactional Replication with Updating Subscriptions</span></span>  
  
1.  <span data-ttu-id="89fd8-209">게시 데이터베이스의 최신 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-209">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="89fd8-210">2단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-210">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="89fd8-211">모든 구독자가 배포 데이터베이스의 처리 중인 명령과 동기화될 때까지 배포 에이전트를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-211">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="89fd8-212">복제 모니터에서 **배포되지 않은 명령** 탭을 사용하거나 배포 데이터베이스에서 [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) 뷰를 쿼리하여 모든 명령이 구독자에 배달되었는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-212">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor, or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="89fd8-213">3단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-213">Go to step 3.</span></span>  
  
     <span data-ttu-id="89fd8-214">배포 에이전트를 실행하는 방법은 [복제 에이전트 시작 및 중지&#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) 및 [복제 에이전트 실행 파일 개념](../concepts/replication-agent-executables-concepts.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-214">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
     <span data-ttu-id="89fd8-215">명령을 확인 하는 방법에 대 한 자세한 내용은 복제 [Transact-sql 프로그래밍 &#40;복제 Transact-sql 프로그래밍&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) 및 [복제 모니터를 사용 하 여 정보 보기 및 작업 수행](../monitor/view-information-and-perform-tasks-replication-monitor.md)을 참조 하십시오.</span><span class="sxs-lookup"><span data-stu-id="89fd8-215">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
3.  <span data-ttu-id="89fd8-216">지연 업데이트 구독을 사용하는 경우 각 구독자에 연결하고 구독 데이터베이스에 있는 [MSreplication_queue&#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/msreplication-queue-transact-sql) 테이블의 모든 행을 삭제합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-216">If you are using queued updating subscriptions, connect to each Subscriber and delete all rows from the [MSreplication_queue &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/msreplication-queue-transact-sql) table in the subscription database.</span></span> <span data-ttu-id="89fd8-217">4단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-217">Go to step 4.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="89fd8-218">지연 업데이트 구독을 사용하고 있으며 테이블에 ID 열이 있는 경우 복원 후에 올바른 ID 범위가 지정되었는지 확인해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-218">If you are using queued updating subscriptions and any tables contain identity columns, you must make sure that the correct identity ranges are assigned after a restore.</span></span> <span data-ttu-id="89fd8-219">자세한 내용은 [ID 열 복제](../publish/replicate-identity-columns.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-219">For more information, see [Replicate Identity Columns](../publish/replicate-identity-columns.md).</span></span>  
  
4.  <span data-ttu-id="89fd8-220">배포 데이터베이스의 처리 중인 모든 명령이 구독자에 배달되었는지 확인한 다음 복원된 백업에 포함되지 않은 모든 트랜잭션을 게시 데이터베이스에 수동으로 적용해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-220">You must now make sure that Subscribers have all outstanding commands in the distribution database, and then manually apply to the publication database any transactions that are not included in the restored backup.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="89fd8-221">이 과정을 수행하면 게시된 테이블이 백업에서 복원된 다른 비게시 테이블보다 더 최신 시점으로 복원될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-221">Performing this process can cause published tables to be restored to a point in time that is more recent than the point in time of other nonpublished tables that are restored from the backup.</span></span>  
  
    1.  <span data-ttu-id="89fd8-222">모든 구독자가 배포 데이터베이스의 처리 중인 명령과 동기화될 때까지 배포 에이전트를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-222">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="89fd8-223">복제 모니터를 사용하거나 배포 데이터베이스에서 [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) 뷰를 쿼리하여 모든 명령이 구독자에 배달되었는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-223">Verify that all commands are delivered to Subscribers by using Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="89fd8-224">b 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-224">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="89fd8-225">[tablediff Utility](../../../tools/tablediff-utility.md) 또는 다른 도구를 사용하여 게시자를 구독자와 수동으로 동기화합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-225">Use the [tablediff Utility](../../../tools/tablediff-utility.md) or another tool to manually synchronize the Publisher with the Subscriber.</span></span> <span data-ttu-id="89fd8-226">이렇게 하면 게시 데이터베이스 백업에 포함되지 않은 데이터를 구독 데이터베이스에서 복구할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-226">This enables you to recover data from the subscription database that was not contained in the publication database backup.</span></span> <span data-ttu-id="89fd8-227">c 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-227">Go to step c.</span></span>  
  
         <span data-ttu-id="89fd8-228">**tablediff** 유틸리티에 대한 자세한 내용은 [복제된 테이블의 차이점 비교&#40;복제 프로그래밍&#41;](compare-replicated-tables-for-differences-replication-programming.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-228">For more information about the **tablediff** utility, see [Compare Replicated Tables for Differences &#40;Replication Programming&#41;](compare-replicated-tables-for-differences-replication-programming.md).</span></span>  
  
    3.  <span data-ttu-id="89fd8-229">복원된 백업이 완료되었으며 최신 상태인지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-229">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="89fd8-230">또한 모든 게시 및 구독에 대한 최신 구성을 포함하고 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-230">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="89fd8-231">그렇다면 저장 프로시저 [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) 를 실행하여 게시자 메타데이터를 배포자 메타데이터와 다시 동기화합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-231">If yes, execute the [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) stored procedure to resynchronize the Publisher metadata with the Distributor metadata.</span></span> <span data-ttu-id="89fd8-232">이로써 복원이 완료됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-232">The restore is completed.</span></span> <span data-ttu-id="89fd8-233">그렇지 않으면 d 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-233">If no, go to step d.</span></span>  
  
    4.  <span data-ttu-id="89fd8-234">게시자, 배포자 및 구독자에서 복제 구성을 제거한 후 구성을 다시 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-234">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="89fd8-235">구독을 다시 만들 때 구독자에 이미 데이터가 있다고 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-235">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="89fd8-236">이로써 복원이 완료됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-236">The restore is completed.</span></span>  
  
         <span data-ttu-id="89fd8-237">복제를 제거하는 방법은 [sp_removedbreplication&#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-237">For more information about how to remove replication, see and [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="89fd8-238">구독자에 이미 데이터가 있다고 지정하는 방법은 [Initialize a Subscription Manually](../initialize-a-subscription-manually.md)를 참조하십시오.</span><span class="sxs-lookup"><span data-stu-id="89fd8-238">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="publication-database-peer-to-peer-transactional-replication"></a><span data-ttu-id="89fd8-239">게시 데이터베이스: @loopback_detection</span><span class="sxs-lookup"><span data-stu-id="89fd8-239">Publication Database: Peer-to-Peer Transactional Replication</span></span>  
 <span data-ttu-id="89fd8-240">다음 단계에서 게시 데이터베이스 **A**, **B**및 **C** 는 피어 투 피어 트랜잭션 복제 토폴로지에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-240">In the following steps, publication databases **A**, **B**, and **C** are in a peer-to-peer transactional replication topology.</span></span> <span data-ttu-id="89fd8-241">**A** 및 **C** 데이터베이스는 온라인 상태이며 제대로 작동하고 있습니다. **B** 데이터베이스는 복원될 데이터베이스입니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-241">Databases **A** and **C** are online and functioning properly; database **B** is the database to be restored.</span></span> <span data-ttu-id="89fd8-242">여기에서 설명하는 절차, 특히 7, 10 및 11단계는 피어 투 피어 토폴로지에 노드를 추가하는 데 필요한 절차와 매우 비슷합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-242">The process described here, especially steps 7, 10, and 11, is very similar to the process required to add a node to a peer-to-peer topology.</span></span> <span data-ttu-id="89fd8-243">이러한 단계를 가장 간단하게 수행하려면 피어 투 피어 토폴로지 구성 마법사를 사용하면 되지만, 저장 프로시저를 사용할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-243">The most straightforward way to perform these steps is to use the Configure Peer-to-Peer Topology Wizard, but you can also use stored procedures.</span></span>  
  
1.  <span data-ttu-id="89fd8-244">배포 에이전트를 실행하여 **A** 및 **C** 데이터베이스의 구독을 동기화합니다. 2단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-244">Run the Distribution Agents to synchronize the subscriptions at databases **A** and **C**. Go to step 2.</span></span>  
  
     <span data-ttu-id="89fd8-245">배포 에이전트를 실행하는 방법은 [복제 에이전트 시작 및 중지&#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) 및 [복제 에이전트 실행 파일 개념](../concepts/replication-agent-executables-concepts.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-245">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
2.  <span data-ttu-id="89fd8-246">**B**에서 사용하는 배포 데이터베이스를 아직 사용할 수 있는 경우 배포 에이전트를 실행하여 **B** 데이터베이스와 **A** 데이터베이스 간의 구독과 B 데이터베이스와 **C** 데이터베이스 간의 구독을 동기화합니다. 3단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-246">If the distribution database that **B** uses is still available, run Distribution Agents to synchronize subscriptions between databases **B** and **A** and databases and B and **C**. Go to step 3.</span></span>  
  
3.  <span data-ttu-id="89fd8-247">**B**에 대한 배포 데이터베이스에서 [sp_removedistpublisherdbreplication](/sql/relational-databases/system-stored-procedures/sp-removedistpublisherdbreplication-transact-sql)을 실행하여 **B**에서 사용하는 배포 데이터베이스의 메타데이터를 제거합니다. 4단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-247">Remove metadata from the distribution database that **B** uses by executing [sp_removedistpublisherdbreplication](/sql/relational-databases/system-stored-procedures/sp-removedistpublisherdbreplication-transact-sql) at the distribution database for **B**. Go to step 4.</span></span>  
  
4.  <span data-ttu-id="89fd8-248">**A** 및 **C** 데이터베이스에서 **B** 데이터베이스의 게시에 대한 구독을 삭제합니다. 5단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-248">At databases **A** and **C**, drop the subscriptions to the publication at database **B**. Go to step 5.</span></span>  
  
     <span data-ttu-id="89fd8-249">구독 삭제 방법은 [Subscribe to Publications](../subscribe-to-publications.md)을 참조하십시오.</span><span class="sxs-lookup"><span data-stu-id="89fd8-249">For more information about how to drop subscriptions, see [Subscribe to Publications](../subscribe-to-publications.md).</span></span>  
  
5.  <span data-ttu-id="89fd8-250">**A** 데이터베이스의 로그 백업 또는 전체 백업을 수행합니다. 6단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-250">Perform a log backup or full backup of database **A**. Go to step 6.</span></span>  
  
6.  <span data-ttu-id="89fd8-251">**A** 데이터베이스의 백업을 **B** 데이터베이스에 복원합니다. 이제 **B** 데이터베이스에는 **A** 데이터베이스의 데이터는 있지만 복제 구성은 없습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-251">Restore the backup of database **A** at database **B**. Database **B** now has the data from database **A**, but not the replication configuration.</span></span> <span data-ttu-id="89fd8-252">백업을 다른 서버로 복원하면 복제가 제거되므로 이 경우 **B** 데이터베이스에서 복제가 제거된 것입니다. 7단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-252">When you restore a backup to another server, replication is removed; therefore, replication has been removed from database **B**. Go to step 7.</span></span>  
  
7.  <span data-ttu-id="89fd8-253">**B** 데이터베이스에 게시를 다시 만든 후 **A** 데이터베이스와 **B** 데이터베이스 간에 구독을 다시 만듭니다. **C** 데이터베이스와 관련된 구독은 이후 단계에서 처리합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-253">Re-create the publication at database **B**, and then re-create subscriptions between databases **A** and **B**. (Subscriptions that involve database **C** are handled at a later stage.).</span></span>  
  
    1.  <span data-ttu-id="89fd8-254">**B** 데이터베이스에 게시를 다시 만듭니다. b 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-254">Re-create the publication at database **B**. Go to step b.</span></span>  
  
    2.  <span data-ttu-id="89fd8-255">**B** 데이터베이스에서 **A**데이터베이스의 게시에 대 한 구독을 다시 만들고 해당 구독이 백업으로 초기화 되도록 지정 합니다. 즉, sp_addsubscription 매개 변수에 대해 **initialize with backup** 값을 지정 **@sync_type** 합니다 [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="89fd8-255">Re-create the subscription at database **B** to the publication at database **A**, specifying that the subscription should be initialized with a backup (a value of **initialize with backup** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="89fd8-256">c 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-256">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="89fd8-257">구독자에 이미 데이터가 있음을 지정 하 여 a 데이터베이스의 **a** 데이터베이스에서 **B**데이터베이스의 게시에 대 한 구독을 다시 만듭니다 (sp_addsubscription 매개 변수에 대 한 **복제 지원** 값 **@sync_type** ). [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)</span><span class="sxs-lookup"><span data-stu-id="89fd8-257">Re-create the subscription at database **A** to the publication at database **B**, specifying that the Subscriber already has the data (a value of **replication support only** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="89fd8-258">8단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-258">Go to step 8.</span></span>  
  
8.  <span data-ttu-id="89fd8-259">배포 에이전트를 실행하여 **A** 및 **B** 데이터베이스의 구독을 동기화합니다. 게시된 테이블에 ID 열이 있으면 9단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-259">Run the Distribution Agents to synchronize the subscriptions at databases **A** and **B**. If there are any identity columns in published tables, go to step 9.</span></span> <span data-ttu-id="89fd8-260">그렇지 않은 경우에는 10단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-260">If not, go to step 10.</span></span>  
  
9. <span data-ttu-id="89fd8-261">복원 후에 **A** 데이터베이스의 각 테이블에 할당한 ID 범위는 **B** 데이터베이스에서도 사용됩니다. 복원된 **B** 데이터베이스가 실패한 **B** 데이터베이스의 모든 변경 내용(**A** 데이터베이스와 **C** 데이터베이스로 전파됨)을 받았는지 확인한 다음 각 테이블의 ID 범위에 대한 초기값을 다시 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-261">After the restore, the identity range that you assigned for each table in database **A** would also be used in database **B**. Make sure that the restored database **B** has received all changes from the failed database **B** that were propagated to database **A** and database **C**; and then reseed the identity range for each table.</span></span>  
  
    1.  <span data-ttu-id="89fd8-262">**B** 데이터베이스에서 [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) 를 실행 하 고 출력 매개 변수를 검색 **@request_id** 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-262">Execute [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) at database **B** and retrieve the output parameter **@request_id**.</span></span> <span data-ttu-id="89fd8-263">b 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-263">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="89fd8-264">기본적으로 배포 에이전트는 연속적으로 실행되도록 설정되므로 토큰이 모든 노드로 자동 전송됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-264">By default, the Distribution Agent is set to run continuously; therefore, tokens should be sent to all nodes automatically.</span></span> <span data-ttu-id="89fd8-265">배포 에이전트가 연속 모드로 실행되지 않을 경우에는 에이전트를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-265">If the Distribution Agent is not running in continuous mode, run the agent.</span></span> <span data-ttu-id="89fd8-266">자세한 내용은 [복제 에이전트 실행 파일 개념](../concepts/replication-agent-executables-concepts.md) 또는 [복제 에이전트 시작 및 중지&#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-266">For more information, see [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md) or [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md).</span></span> <span data-ttu-id="89fd8-267">c 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-267">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="89fd8-268">B 단계에서 검색 한 값을 제공 하 여 [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql)를 실행 **@request_id** 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-268">Execute [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), providing the **@request_id** value retrieved in step b.</span></span> <span data-ttu-id="89fd8-269">모든 노드가 피어 요청을 받았음을 표시할 때까지 기다립니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-269">Wait until all nodes indicate they have received the peer request.</span></span> <span data-ttu-id="89fd8-270">d 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-270">Go to step d.</span></span>  
  
    4.  <span data-ttu-id="89fd8-271">[DBCC CHECKIDENT](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) 를 통해 **B** 데이터베이스에 있는 각 테이블의 ID 범위에 대한 초기값을 다시 설정하여 적절한 범위가 사용되도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-271">Use [DBCC CHECKIDENT](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) to reseed each table in database **B** to make sure that an appropriate range is used.</span></span> <span data-ttu-id="89fd8-272">10단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-272">Go to step 10.</span></span>  
  
     <span data-ttu-id="89fd8-273">ID 범위 관리 방법은 [ID 열 복제](../publish/replicate-identity-columns.md)의 "ID 범위 수동 관리를 위한 범위 할당" 섹션을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-273">For more information about how to manage identity ranges, see the "Assigning ranges for manual identity range management" section of [Replicate Identity Columns](../publish/replicate-identity-columns.md).</span></span>  
  
10. <span data-ttu-id="89fd8-274">이 시점에서 **B** 데이터베이스와 **C** 데이터베이스는 직접 연결되어 있지 않지만 **A** 데이터베이스를 통해 변경 내용을 받습니다. 토폴로지에 [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)]가 실행되는 노드가 들어 있으면 11단계로 이동하고, 그렇지 않으면 12단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-274">At this point, database **B** and database **C** are not directly connected, but they will receive changes through database **A**. If the topology contains any nodes that are running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], go to step 11; otherwise, go to step 12.</span></span>  
  
11. <span data-ttu-id="89fd8-275">시스템을 정지하고 **B** 및 **C** 데이터베이스 간에 구독을 다시 만듭니다. 시스템 정지 과정에서는 모든 노드에서 게시된 테이블에 대한 작업을 중지하고 각 노드가 다른 모든 노드의 변경 내용을 받았는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-275">Quiesce the system, and then re-create the subscription between databases **B** and **C**. Quiescing a system involves stopping activity on published tables at all nodes and making sure of that each node has received all changes from all other nodes.</span></span>  
  
    1.  <span data-ttu-id="89fd8-276">피어 투 피어 토폴로지의 게시된 테이블에 대한 모든 작업을 중지합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-276">Stop all activity on published tables in the peer-to-peer topology.</span></span> <span data-ttu-id="89fd8-277">b 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-277">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="89fd8-278">**B** 데이터베이스에서 [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) 를 실행 하 고 출력 매개 변수를 검색 **@request_id** 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-278">Execute [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) at database **B** and retrieve the output parameter **@request_id**.</span></span> <span data-ttu-id="89fd8-279">c 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-279">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="89fd8-280">기본적으로 배포 에이전트는 연속적으로 실행되도록 설정되므로 토큰이 모든 노드로 자동 전송됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-280">By default, the Distribution Agent is set to run continuously; therefore, tokens should be sent to all nodes automatically.</span></span> <span data-ttu-id="89fd8-281">배포 에이전트가 연속 모드로 실행되지 않을 경우에는 에이전트를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-281">If the Distribution Agent is not running in continuous mode, run the agent.</span></span> <span data-ttu-id="89fd8-282">d 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-282">Go to step d.</span></span>  
  
    4.  <span data-ttu-id="89fd8-283">B 단계에서 검색 한 값을 제공 하 여 [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql)를 실행 **@request_id** 합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-283">Execute [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), providing the **@request_id** value retrieved in step b.</span></span> <span data-ttu-id="89fd8-284">모든 노드가 피어 요청을 받았음을 표시할 때까지 기다립니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-284">Wait until all nodes indicate they have received the peer request.</span></span> <span data-ttu-id="89fd8-285">e 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-285">Go to step e.</span></span>  
  
    5.  <span data-ttu-id="89fd8-286">구독자에 이미 데이터가 있음을 지정하여 **B** 데이터베이스에서 **C**데이터베이스의 게시에 대한 구독을 다시 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-286">Re-create the subscription at database **B** to the publication at database **C**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="89fd8-287">b 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-287">Go to step b.</span></span>  
  
    6.  <span data-ttu-id="89fd8-288">구독자에게 이미 데이터가 있음을 지정하여 **C** 데이터베이스에서 **B**데이터베이스의 게시에 대한 구독을 다시 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-288">Re-create the subscription at database **C** to the publication at database **B**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="89fd8-289">13단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-289">Go to step 13.</span></span>  
  
12. <span data-ttu-id="89fd8-290">**B** 데이터베이스와 **C**데이터베이스 간에 구독을 다시 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-290">Re-create the subscription between databases **B** and **C**:</span></span>  
  
    1.  <span data-ttu-id="89fd8-291">**B**데이터베이스에서 [MSpeer_lsns](/sql/relational-databases/system-tables/mspeer-lsns-transact-sql) 테이블을 쿼리하여 **B** 데이터베이스에서 **C**데이터베이스로부터 받은 최신 트랜잭션의 LSN(로그 시퀀스 번호)을 검색합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-291">At database **B**, query the [MSpeer_lsns](/sql/relational-databases/system-tables/mspeer-lsns-transact-sql) table to retrieve the log sequence number (LSN) of the most recent transaction that database **B** has received from database **C**.</span></span>  
  
    2.  <span data-ttu-id="89fd8-292">**B** 데이터베이스에서 **C**데이터베이스의 게시에 대 한 구독을 다시 만들고 LSN을 기반으로 구독이 초기화 되도록 지정 합니다. 즉, sp_addsubscription 매개 변수에 대해 **initialize from lsn** 값을 지정 **@sync_type** [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-292">Re-create the subscription at database **B** to the publication at database **C**, specifying that the subscription should be initialized based on LSN (a value of **initialize from lsn** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="89fd8-293">b 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-293">Go to step b.</span></span>  
  
    3.  <span data-ttu-id="89fd8-294">구독자에게 이미 데이터가 있음을 지정하여 **C** 데이터베이스에서 **B**데이터베이스의 게시에 대한 구독을 다시 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-294">Re-create the subscription at database **C** to the publication at database **B**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="89fd8-295">13단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-295">Go to step 13.</span></span>  
  
13. <span data-ttu-id="89fd8-296">배포 에이전트를 실행하여 **B** 및 **C** 데이터베이스의 구독을 동기화합니다. 이로써 복원이 완료됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-296">Run the Distribution Agents to synchronize the subscriptions at databases **B** and **C**. The restore is completed.</span></span>  
  
#### <a name="msdb-database-publisher"></a><span data-ttu-id="89fd8-297">msdb 데이터베이스(게시자)</span><span class="sxs-lookup"><span data-stu-id="89fd8-297">msdb Database (Publisher)</span></span>  
  
1.  <span data-ttu-id="89fd8-298">**msdb** 데이터베이스의 최신 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-298">Restore the latest backup of the **msdb** database.</span></span>  
  
2.  <span data-ttu-id="89fd8-299">복원된 백업이 완료되었으며 최신 상태인지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-299">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="89fd8-300">또한 모든 게시 및 구독에 대한 최신 구성을 포함하고 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-300">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="89fd8-301">그렇다면 복구가 완료된 것이며</span><span class="sxs-lookup"><span data-stu-id="89fd8-301">If yes, recovery is completed.</span></span> <span data-ttu-id="89fd8-302">그렇지 않으면 3단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-302">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="89fd8-303">복제 스크립트에서 구독 정리 작업을 다시 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-303">Re-create the subscription cleanup job from your replication scripts.</span></span> <span data-ttu-id="89fd8-304">복구가 완료되었습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-304">Recovery is completed.</span></span>  
  
#### <a name="master-database-publisher"></a><span data-ttu-id="89fd8-305">master 데이터베이스(게시자)</span><span class="sxs-lookup"><span data-stu-id="89fd8-305">master Database (Publisher)</span></span>  
  
1.  <span data-ttu-id="89fd8-306">**master** 데이터베이스의 최신 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-306">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="89fd8-307">해당 데이터베이스의 복제 구성 및 설정이 게시 데이터베이스의 복제 구성 및 설정과 일치하는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-307">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
### <a name="databases-at-the-distributor"></a><span data-ttu-id="89fd8-308">배포자의 데이터베이스</span><span class="sxs-lookup"><span data-stu-id="89fd8-308">Databases at the Distributor</span></span>  
  
#### <a name="distribution-database"></a><span data-ttu-id="89fd8-309">배포 데이터베이스</span><span class="sxs-lookup"><span data-stu-id="89fd8-309">Distribution Database</span></span>  
  
1.  <span data-ttu-id="89fd8-310">배포 데이터베이스의 최신 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-310">Restore the latest backup of the distribution database.</span></span>  
  
2.  <span data-ttu-id="89fd8-311">실패하기 전에 배포 데이터베이스에 **sync with backup** 옵션을 설정했는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-311">Was the **sync with backup** setting enabled on the distribution database before the failure?</span></span> <span data-ttu-id="89fd8-312">그렇다면 3단계로 이동하고, 그렇지 않으면 4단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-312">If yes, go to step 3; if no, go to step 4.</span></span>  
  
     <span data-ttu-id="89fd8-313">옵션이 설정되어 있으면 `SELECT DATABASEPROPERTYEX('<DistributionDatabaseName>', 'IsSyncWithBackup')` 쿼리가 '1'을 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-313">If the setting is enabled, the query `SELECT DATABASEPROPERTYEX('<DistributionDatabaseName>', 'IsSyncWithBackup')` returns '1'.</span></span>  
  
3.  <span data-ttu-id="89fd8-314">복원된 백업이 완료되었으며 최신 상태인지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-314">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="89fd8-315">또한 모든 게시 및 구독에 대한 최신 구성을 포함하고 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-315">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="89fd8-316">그렇다면 복구가 완료된 것이며</span><span class="sxs-lookup"><span data-stu-id="89fd8-316">If yes, recovery is completed.</span></span> <span data-ttu-id="89fd8-317">그렇지 않으면 4단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-317">If no, go to step 4.</span></span>  
  
4.  <span data-ttu-id="89fd8-318">복원된 배포 데이터베이스의 구성 정보가 최신 상태가 아니거나 배포 데이터베이스에 **sync with backup** 옵션이 설정되지 않았습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-318">Either the configuration information in the restored distribution database is not up-to-date, or the **sync with backup** option was not set on the distribution database.</span></span> <span data-ttu-id="89fd8-319">복원 후 게시자에서 커밋되었지만 구독자로 배달되지 않은 트랜잭션이 배포 데이터베이스에는 없을 수도 있습니다. 복제를 삭제하고 다시 만든 다음 유효성 검사를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-319">(After the restore, the distribution database might be missing transactions that were committed at the Publisher but have not yet been delivered to Subscribers.) Drop and re-create replication, and then run validation.</span></span>  
  
    1.  <span data-ttu-id="89fd8-320">게시자, 배포자 및 구독자에서 복제 구성을 제거한 후 구성을 다시 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-320">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="89fd8-321">구독을 다시 만들 때 구독자에 이미 데이터가 있다고 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-321">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="89fd8-322">b 단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-322">Go to step b.</span></span>  
  
         <span data-ttu-id="89fd8-323">복제를 제거하는 방법은 [sp_removedbreplication&#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-323">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="89fd8-324">구독자에 이미 데이터가 있다고 지정하는 방법은 [Initialize a Subscription Manually](../initialize-a-subscription-manually.md)를 참조하십시오.</span><span class="sxs-lookup"><span data-stu-id="89fd8-324">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
    2.  <span data-ttu-id="89fd8-325">모든 게시의 유효성을 검사하도록 표시합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-325">Mark all publications for validation.</span></span> <span data-ttu-id="89fd8-326">유효성 검사에 실패한 모든 구독을 다시 초기화합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-326">Reinitialize any subscriptions that fail validation.</span></span> <span data-ttu-id="89fd8-327">복구가 완료되었습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-327">Recovery is completed.</span></span>  
  
         <span data-ttu-id="89fd8-328">유효성 검사에 대한 자세한 내용은 [Validate Replicated Data](../validate-data-at-the-subscriber.md)를 참조하십시오.</span><span class="sxs-lookup"><span data-stu-id="89fd8-328">For more information about validation, see [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span></span> <span data-ttu-id="89fd8-329">다시 초기화에 대한 자세한 내용은 [구독 다시 초기화](../reinitialize-subscriptions.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-329">For more information about reinitialization, see [Reinitialize Subscriptions](../reinitialize-subscriptions.md).</span></span>  
  
#### <a name="msdb-database-distributor"></a><span data-ttu-id="89fd8-330">msdb 데이터베이스(배포자)</span><span class="sxs-lookup"><span data-stu-id="89fd8-330">msdb Database (Distributor)</span></span>  
  
1.  <span data-ttu-id="89fd8-331">**msdb** 데이터베이스의 최신 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-331">Restore the latest backup of the **msdb** database.</span></span>  
  
2.  <span data-ttu-id="89fd8-332">복원된 백업이 완료되었으며 최신 상태인지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-332">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="89fd8-333">또한 모든 게시 및 구독에 대한 최신 구성을 포함하고 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-333">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="89fd8-334">그렇다면 복구가 완료된 것이며</span><span class="sxs-lookup"><span data-stu-id="89fd8-334">If yes, recovery is completed.</span></span> <span data-ttu-id="89fd8-335">그렇지 않으면 3단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-335">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="89fd8-336">게시자, 배포자 및 구독자에서 복제 구성을 제거한 후 구성을 다시 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-336">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="89fd8-337">구독을 다시 만들 때 구독자에 이미 데이터가 있다고 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-337">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="89fd8-338">4단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-338">Go to step 4.</span></span>  
  
     <span data-ttu-id="89fd8-339">복제를 제거하는 방법은 [sp_removedbreplication&#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-339">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
     <span data-ttu-id="89fd8-340">구독자에 이미 데이터가 있다고 지정하는 방법은 [Initialize a Subscription Manually](../initialize-a-subscription-manually.md)를 참조하십시오.</span><span class="sxs-lookup"><span data-stu-id="89fd8-340">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
4.  <span data-ttu-id="89fd8-341">모든 게시의 유효성을 검사하도록 표시합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-341">Mark all publications for validation.</span></span> <span data-ttu-id="89fd8-342">유효성 검사에 실패한 모든 구독을 다시 초기화합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-342">Reinitialize any subscriptions that fail validation.</span></span> <span data-ttu-id="89fd8-343">복구가 완료되었습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-343">Recovery is completed.</span></span>  
  
     <span data-ttu-id="89fd8-344">유효성 검사에 대한 자세한 내용은 [Validate Replicated Data](../validate-data-at-the-subscriber.md)를 참조하십시오.</span><span class="sxs-lookup"><span data-stu-id="89fd8-344">For more information about validation, see [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span></span> <span data-ttu-id="89fd8-345">다시 초기화에 대한 자세한 내용은 [구독 다시 초기화](../reinitialize-subscriptions.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-345">For more information about reinitialization, see [Reinitialize Subscriptions](../reinitialize-subscriptions.md).</span></span>  
  
#### <a name="master-database-distributor"></a><span data-ttu-id="89fd8-346">master 데이터베이스(배포자)</span><span class="sxs-lookup"><span data-stu-id="89fd8-346">master Database (Distributor)</span></span>  
  
1.  <span data-ttu-id="89fd8-347">**master** 데이터베이스의 최신 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-347">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="89fd8-348">해당 데이터베이스의 복제 구성 및 설정이 게시 데이터베이스의 복제 구성 및 설정과 일치하는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-348">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
### <a name="databases-at-the-subscriber"></a><span data-ttu-id="89fd8-349">구독자의 데이터베이스</span><span class="sxs-lookup"><span data-stu-id="89fd8-349">Databases at the Subscriber</span></span>  
  
#### <a name="subscription-database"></a><span data-ttu-id="89fd8-350">구독 데이터베이스</span><span class="sxs-lookup"><span data-stu-id="89fd8-350">Subscription Database</span></span>  
  
1.  <span data-ttu-id="89fd8-351">최신 구독 데이터베이스 백업이 배포 데이터베이스의 최소 배포 보존 기간 설정보다 최신인지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-351">Is the latest subscription database backup more recent than the minimum distribution retention setting on the distribution database?</span></span> <span data-ttu-id="89fd8-352">이를 통해 배포자에 구독자를 최신 상태로 만들기 위해 필요한 명령이 모두 있는지 여부를 확인합니다. 그렇다면 2단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-352">(This determines whether the Distributor still has all the commands that are required to bring the Subscriber up-to-date.) If yes, go to step 2.</span></span> <span data-ttu-id="89fd8-353">그렇지 않으면 구독을 다시 초기화합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-353">If no, reinitialize the subscription.</span></span> <span data-ttu-id="89fd8-354">복구가 완료되었습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-354">Recovery is completed.</span></span>  
  
     <span data-ttu-id="89fd8-355">최대 배포 보존 기간 설정을 확인하려면 [sp_helpdistributiondb](/sql/relational-databases/system-stored-procedures/sp-helpdistributiondb-transact-sql) 를 실행하고 **max_distretention** 열의 값을 검색합니다. 이 값은 시간 단위로 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-355">To determine the maximum distribution retention setting, execute [sp_helpdistributiondb](/sql/relational-databases/system-stored-procedures/sp-helpdistributiondb-transact-sql) and retrieve the value from the **max_distretention** column (this value is in hours).</span></span>  
  
     <span data-ttu-id="89fd8-356">구독을 다시 초기화하는 방법은 [Reinitialize a Subscription](../reinitialize-a-subscription.md)를 참조하십시오.</span><span class="sxs-lookup"><span data-stu-id="89fd8-356">For more information about how to reinitialize a subscription, see [Reinitialize a Subscription](../reinitialize-a-subscription.md).</span></span>  
  
2.  <span data-ttu-id="89fd8-357">최신 구독 데이터베이스 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-357">Restore the latest subscription database backup.</span></span> <span data-ttu-id="89fd8-358">3단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-358">Go to step 3.</span></span>  
  
3.  <span data-ttu-id="89fd8-359">구독 데이터베이스에 밀어넣기 구독만 있는 경우 4단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-359">If the subscription database contains only push subscriptions, go to step 4.</span></span> <span data-ttu-id="89fd8-360">구독 데이터베이스에 끌어오기 구독이 있는 경우에는 구독 정보가 최신 정보인지,</span><span class="sxs-lookup"><span data-stu-id="89fd8-360">If the subscription database contains any pull subscriptions, ask the following questions: Is the subscription information current?</span></span> <span data-ttu-id="89fd8-361">이 데이터베이스에 오류 발생 시 설정된 테이블과 옵션이 모두 포함되어 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-361">Does the database include all tables and options that were set at the time of failure.</span></span> <span data-ttu-id="89fd8-362">그렇다면 4단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-362">If yes, go to step 4.</span></span> <span data-ttu-id="89fd8-363">그렇지 않으면 구독을 다시 초기화합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-363">If no, reinitialize the subscription.</span></span> <span data-ttu-id="89fd8-364">복구가 완료되었습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-364">Recovery is completed.</span></span>  
  
4.  <span data-ttu-id="89fd8-365">구독자를 동기화하려면 배포 에이전트를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-365">To synchronize the Subscriber, run the Distribution Agent.</span></span> <span data-ttu-id="89fd8-366">복구가 완료되었습니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-366">Recovery is completed.</span></span>  
  
     <span data-ttu-id="89fd8-367">배포 에이전트를 실행하는 방법은 [복제 에이전트 시작 및 중지&#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) 및 [복제 에이전트 실행 파일 개념](../concepts/replication-agent-executables-concepts.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="89fd8-367">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
#### <a name="msdb-database-subscriber"></a><span data-ttu-id="89fd8-368">msdb 데이터베이스(구독자)</span><span class="sxs-lookup"><span data-stu-id="89fd8-368">msdb Database (Subscriber)</span></span>  
  
1.  <span data-ttu-id="89fd8-369">**msdb** 데이터베이스의 최신 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-369">Restore the latest backup of the **msdb** database.</span></span> <span data-ttu-id="89fd8-370">이 구독자에서 끌어오기 구독이 사용되는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-370">Are pull subscriptions used at this Subscriber?</span></span> <span data-ttu-id="89fd8-371">그렇지 않으면 복원이 완료된 것입니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-371">If no, the restore is completed.</span></span> <span data-ttu-id="89fd8-372">그렇다면 2단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-372">If yes, go to step 2.</span></span>  
  
2.  <span data-ttu-id="89fd8-373">복원된 백업이 완료되었으며 최신 상태인지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-373">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="89fd8-374">또한 모든 게시 및 구독에 대한 최신 구성을 포함하고 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-374">Does it contain the latest configuration for all pull subscriptions?</span></span> <span data-ttu-id="89fd8-375">그렇다면 복구가 완료된 것이며</span><span class="sxs-lookup"><span data-stu-id="89fd8-375">If yes, recovery is completed.</span></span> <span data-ttu-id="89fd8-376">그렇지 않으면 3단계로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-376">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="89fd8-377">끌어오기 구독을 삭제하고 다시 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-377">Drop and re-create the pull subscriptions.</span></span> <span data-ttu-id="89fd8-378">구독을 다시 만들 때 구독자에 이미 데이터가 있다고 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-378">When you re-create the subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="89fd8-379">이로써 복원이 완료됩니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-379">The restore is completed.</span></span>  
  
     <span data-ttu-id="89fd8-380">구독 삭제 방법은 [Subscribe to Publications](../subscribe-to-publications.md)을 참조하십시오.</span><span class="sxs-lookup"><span data-stu-id="89fd8-380">For more information about how to drop subscriptions, see [Subscribe to Publications](../subscribe-to-publications.md).</span></span>  
  
     <span data-ttu-id="89fd8-381">구독자에 이미 데이터가 있다고 지정하는 방법은 [Initialize a Subscription Manually](../initialize-a-subscription-manually.md)를 참조하십시오.</span><span class="sxs-lookup"><span data-stu-id="89fd8-381">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="master-database-subscriber"></a><span data-ttu-id="89fd8-382">master 데이터베이스(구독자)</span><span class="sxs-lookup"><span data-stu-id="89fd8-382">master Database (Subscriber)</span></span>  
  
1.  <span data-ttu-id="89fd8-383">**master** 데이터베이스의 최신 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-383">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="89fd8-384">해당 데이터베이스의 복제 구성 및 설정이 게시 데이터베이스의 복제 구성 및 설정과 일치하는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="89fd8-384">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="89fd8-385">참고 항목</span><span class="sxs-lookup"><span data-stu-id="89fd8-385">See Also</span></span>  
 <span data-ttu-id="89fd8-386">[SQL Server 데이터베이스 백업 및 복원](../../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span><span class="sxs-lookup"><span data-stu-id="89fd8-386">[Back Up and Restore of SQL Server Databases](../../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span></span>  
 <span data-ttu-id="89fd8-387">[복제된 데이터베이스 백업 및 복원](back-up-and-restore-replicated-databases.md) </span><span class="sxs-lookup"><span data-stu-id="89fd8-387">[Back Up and Restore Replicated Databases](back-up-and-restore-replicated-databases.md) </span></span>  
 <span data-ttu-id="89fd8-388">[배포 구성](../configure-distribution.md) </span><span class="sxs-lookup"><span data-stu-id="89fd8-388">[Configure Distribution](../configure-distribution.md) </span></span>  
 <span data-ttu-id="89fd8-389">[데이터 및 데이터베이스 개체 게시](../publish/publish-data-and-database-objects.md) </span><span class="sxs-lookup"><span data-stu-id="89fd8-389">[Publish Data and Database Objects](../publish/publish-data-and-database-objects.md) </span></span>  
 <span data-ttu-id="89fd8-390">[Subscribe to Publications](../subscribe-to-publications.md) </span><span class="sxs-lookup"><span data-stu-id="89fd8-390">[Subscribe to Publications](../subscribe-to-publications.md) </span></span>  
 <span data-ttu-id="89fd8-391">[구독 초기화](../initialize-a-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="89fd8-391">[Initialize a Subscription](../initialize-a-subscription.md) </span></span>  
 [<span data-ttu-id="89fd8-392">데이터 동기화</span><span class="sxs-lookup"><span data-stu-id="89fd8-392">Synchronize Data</span></span>](../synchronize-data.md)  
  
  
