---
title: 가용성 그룹의 강제 수동 장애 조치(Failover) 수행(SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/14/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
f1_keywords:
- sql12.swb.availabilitygroup.forcefailover.f1
helpviewer_keywords:
- Availability Groups [SQL Server], failover
- failover [SQL Server], AlwaysOn Availability Groups
ms.assetid: 222288fe-ffc0-4567-b624-5d91485d70f0
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: f36908102a09eb1ef1f7a485898da715deb4253b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87649694"
---
# <a name="perform-a-forced-manual-failover-of-an-availability-group-sql-server"></a><span data-ttu-id="b11f3-102">가용성 그룹의 강제 수동 장애 조치(Failover) 수행(SQL Server)</span><span class="sxs-lookup"><span data-stu-id="b11f3-102">Perform a Forced Manual Failover of an Availability Group (SQL Server)</span></span>
  <span data-ttu-id="b11f3-103">이 항목에서는 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]에서 [!INCLUDE[tsql](../../../includes/tsql-md.md)], [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)]또는 PowerShell을 사용하여 AlwaysOn 가용성 그룹에서 강제 장애 조치(failover)(데이터 손실 가능)를 수행하는 방법에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-103">This topic describes how to perform a forced failover (with possible data loss) on an AlwaysOn availability group by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)], or PowerShell in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="b11f3-104">강제 장애 조치(failover)는 [예정된 수동 장애 조치(failover)](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md) 가 가능하지 않을 때 재해 복구용으로만 사용하기 위한 수동 장애 조치(failover)의 한 형태입니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-104">A forced failover is a form of manual failover that is intended strictly for disaster recovery, when a [planned manual failover](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md) is not possible.</span></span> <span data-ttu-id="b11f3-105">동기화되지 않은 보조 복제본으로 강제 장애 조치(failover)를 수행하면 데이터 손실이 발생할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-105">If you force failover to an unsynchronized secondary replica, some data loss is possible.</span></span> <span data-ttu-id="b11f3-106">따라서 서비스를 즉시 가용성 그룹으로 복원해야 하고 데이터 손실 위험을 감수할 수 있는 경우에만 강제 장애 조치(failover)를 수행하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-106">Therefore, we strongly recommend that you force failover only if you must restore service to the availability group immediately and you are willing to risk losing data.</span></span>  
  
 <span data-ttu-id="b11f3-107">강제 장애 조치(failover) 후 가용성 그룹이 장애 조치된 장애 조치failover) 대상은 새로운 주 복제본이 됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-107">After a forced failover, the failover target to which the availability group was failed over becomes the new primary replica.</span></span> <span data-ttu-id="b11f3-108">남은 보조 복제본에 있는 보조 데이터베이스는 일시 중지되기 때문에 수동으로 다시 시작해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-108">The secondary databases in the remaining secondary replicas are suspended and must be manually resumed.</span></span> <span data-ttu-id="b11f3-109">이전의 주 복제본을 사용할 수 있게 되면 이 복제본은 보조 역할로 전환됩니다. 따라서 이전의 주 데이터베이스는 보조 데이터베이스가 되고 SUSPENDED 상태로 전환됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-109">When the former primary replica becomes available, it transitions to the secondary role, causing the former primary databases to become secondary databases and transition into the SUSPENDED state.</span></span> <span data-ttu-id="b11f3-110">지정된 보조 데이터베이스를 다시 시작하기 전에 해당 데이터베이스에서 손실된 데이터를 복구할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-110">Before you resume a given secondary database, you might be able to recover lost data from it.</span></span> <span data-ttu-id="b11f3-111">그러나 보조 데이터베이스 중 하나라도 일시 중지되어 있는 동안에는 지정된 주 데이터베이스에서 트랜잭션 로그 잘림이 지연됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-111">However, notice that transaction log truncation is delayed on a given primary database while any of its secondary databases is suspended.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="b11f3-112">주 데이터베이스를 사용한 데이터 동기화는 보조 데이터베이스가 재개될 때까지 발생하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-112">Data synchronization with the primary database will not occur until the secondary database is resumed.</span></span> <span data-ttu-id="b11f3-113">보조 데이터베이스를 재개하는 방법에 대한 정보는 이 문서의 뒷 부분에 나오는 [후속 작업: 강제 장애 조치(failover) 후 필수 작업](#FollowUp)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-113">For information about resuming a secondary database, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp) later in this article.</span></span>  
  
 <span data-ttu-id="b11f3-114">강제 장애 조치(failover)는 다음과 같은 응급 상황에 수행해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-114">Performing a forced failover is necessary in the following emergency situations:</span></span>  
  
-   <span data-ttu-id="b11f3-115">WSFC 클러스터에서*강제 쿼럼*을 수행한 후에는 각 가용성 그룹에 대해 강제 장애 조치(failover)(데이터 손실 가능)를 수행해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-115">After forcing quorum on the WSFC cluster (*forced quorum*), you need to force failover each availability group (with possible data loss).</span></span> <span data-ttu-id="b11f3-116">강제 장애 조치(failover)가 필요한 이유는 WSFC 클러스터 값의 실제 상태가 손실되었을 수 있기 때문입니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-116">Forcing failover is required because the real state of the WSFC cluster values might have been lost.</span></span> <span data-ttu-id="b11f3-117">그러나 강제 쿼럼을 수행하기 전에 주 복제본이었던 복제본을 호스팅하는 시스템 인스턴스에서 강제 장애 조치(failover)를 수행할 수 있거나 강제 쿼럼을 수행하기 전에 동기화된 보조 복제본으로 강제 장애 조치(failover)를 수행할 수 있으면 데이터 손실을 방지할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-117">However, you can avoid data loss, if are able to force failover on the server instance that was hosting the replica that was the primary replica before you forced quorum or to a secondary replica that was synchronized before you forced quorum.</span></span> <span data-ttu-id="b11f3-118">자세한 내용은 이 항목의 뒷부분에 나오는 [강제 쿼럼 후 데이터 손실을 방지할 수 있는 잠재적인 방법](#WaysToAvoidDataLoss)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-118">For more information, see [Potential Ways to Avoid Data Loss After Quorum is Forced](#WaysToAvoidDataLoss), later in this topic.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="b11f3-119">강제적인 방법이 아니라 자연스러운 방법으로 쿼럼을 다시 얻으면 가용성 복제본이 일반적인 방법으로 복구됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-119">If quorum is regained by natural means instead of being forced, the availability replicas will go through normal recovery.</span></span> <span data-ttu-id="b11f3-120">쿼럼을 다시 얻은 후에도 여전히 주 복제본을 사용할 수 없는 경우 동기화된 보조 복제본으로 예정된 수동 장애 조치(failover)를 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-120">If the primary replica is still unavailable after quorum is regained, you can perform a planned manual failover to a synchronized secondary replica.</span></span>  
  
     <span data-ttu-id="b11f3-121">강제 쿼럼에 대한 자세한 내용은 [강제 쿼럼을 통해 WSFC 재해 복구&#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md)의 PowerShell을 사용하여 Always On 가용성 그룹에서 강제 장애 조치(failover)(데이터 손실 가능)를 수행하는 방법을 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-121">For information about forcing quorum, see [WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span></span> <span data-ttu-id="b11f3-122">강제 쿼럼 후에 강제 장애 조치(failover)가 필요한 이유에 대한 자세한 내용은 [장애 조치(Failover) 및 장애 조치(Failover) 모드&#40;AlwaysOn 가용성 그룹&#41;](failover-and-failover-modes-always-on-availability-groups.md)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-122">For information about why forcing failover is required after forcing quorum, see [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
-   <span data-ttu-id="b11f3-123">WSFC 클러스터에 정상 상태의 쿼럼이 있어도 주 복제본을 사용할 수 없는 경우 역할이 SECONDARY 또는 RESOLVING 상태인 복제본으로 강제 장애 조치(failover)(데이터 손실 가능)를 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-123">If the primary replica becomes unavailable when the WSFC cluster has a healthy quorum, you can force failover (with possible data loss), to any replica whose role is in the SECONDARY or RESOLVING state.</span></span> <span data-ttu-id="b11f3-124">가능하면 주 복제본이 손실될 당시 동기화된 동기-커밋 보조 복제본으로 장애 조치(failover)를 수행하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-124">If possible, force failover to a synchronous-commit secondary replica that was synchronized when the primary replica was lost.</span></span>  
  
    > [!TIP]  
    >  <span data-ttu-id="b11f3-125">WSFC 클러스터에 정상 상태의 쿼럼이 있을 때 동기화된 보조 복제본에서 강제 장애 조치(failover) 명령을 실행하면 해당 복제본이 실제로 예정된 수동 장애 조치(failover)를 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-125">When the WSFC cluster has a healthy quorum, if you issue a force failover command on a synchronized secondary replica, the replica actually performs a planned manual failover.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b11f3-126">강제 장애 조치(failover)를 위한 사전 요구 사항 및 권장 사항에 대한 자세한 내용과 강제 장애 조치(failover)를 사용하여 치명적인 오류에서 복구하는 예제 시나리오는 이 항목의 뒷부분에 나오는 [예제 시나리오: 강제 장애 조치(failover)를 사용하여 치명적인 오류 복구](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md#ExampleRecoveryFromCatastrophy)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-126">For more information about the prerequisites and recommendations for forcing failover and for an example scenario that uses a forced failover to recover from a catastrophic failure, see [Example Scenario: Using a Forced Failover to Recover from a Catastrophic Failure](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md#ExampleRecoveryFromCatastrophy), later in this topic.</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="b11f3-127">시작하기 전에</span><span class="sxs-lookup"><span data-stu-id="b11f3-127">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="b11f3-128">제한 사항</span><span class="sxs-lookup"><span data-stu-id="b11f3-128">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="b11f3-129">장애 조치(failover)를 수행할 수 없는 유일한 시간은 WSFC(Windows Server 장애 조치(Failover) 클러스터링) 클러스터에 쿼럼이 부족할 때입니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-129">The only time that you cannot perform a forced failover is when Windows Server Failover Clustering (WSFC) cluster lacks quorum.</span></span>  
  
-   <span data-ttu-id="b11f3-130">가용성 그룹의 강제 장애 조치(failover) 중 데이터가 손실될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-130">Data loss is possible during the forced failover of an availability group.</span></span> <span data-ttu-id="b11f3-131">또한 강제 장애 조치(failover)를 시작할 때 주 복제본이 실행 중인 경우 클라이언트는 여전히 이전의 주 데이터베이스에 연결되어 있을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-131">In addition, if the primary replica is running when you initiate a forced failover, clients might still be connected to former primary databases.</span></span> <span data-ttu-id="b11f3-132">따라서 주 복제본이 더 이상 실행되지 않는 경우와 가용성 그룹의 데이터베이스에 액세스를 복원하기 위해 데이터 손실 위험을 감수할 수 있는 경우에만 강제 장애 조치(failover)를 수행하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-132">Therefore, we strongly recommend that you force failover only if the primary replica is no longer running and if you are willing to risk losing data in order to restore access to databases in the availability group.</span></span>  
  
-   <span data-ttu-id="b11f3-133">보조 데이터베이스가 REVERTING 또는 INITIALIZING 상태일 때는 강제 장애 조치(failover)를 수행해도 해당 데이터베이스가 주 데이터베이스로 시작되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-133">When a secondary database in the REVERTING or INITIALIZING state, forcing failover would cause the database to fail to start as a primary database.</span></span> <span data-ttu-id="b11f3-134">데이터베이스가 INTIAILIZGING 상태에 있었다면 데이터베이스 백업에서 누락된 로그 레코드를 적용하거나 처음부터 데이터베이스를 전체 복원해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-134">If the database was in the INTIAILIZGING state the you will need to apply the missing log records from a database backup or fully restore the database from scratch.</span></span> <span data-ttu-id="b11f3-135">데이터베이스가 REVERTING 상태에 있었다면 데이터베이스를 백업에서 전체 복원해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-135">If the database was in the REVERTING state you will need to fully restore the database from backups.</span></span>  
  
-   <span data-ttu-id="b11f3-136">장애 조치(failover) 명령은 장애 조치(failover) 대상에서 해당 명령을 수락하는 즉시 반환하지만</span><span class="sxs-lookup"><span data-stu-id="b11f3-136">A failover command returns as soon as the failover target has accepted the command.</span></span> <span data-ttu-id="b11f3-137">데이터베이스 복구는 가용성 그룹의 장애 조치가 끝난 후 비동기로 수행됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-137">However, database recovery occurs asynchronously after the availability group has finished failing over.</span></span>  
  
-   <span data-ttu-id="b11f3-138">장애 조치 시 가용성 그룹 내에서 데이터베이스 간 일관성은 유지되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-138">Cross-database consistency across databases within the availability group is not maintained on failover.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="b11f3-139">데이터베이스 간 트랜잭션 또는 분산 트랜잭션은 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]에서 지원되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-139">Cross-database transactions and distributed transactions are not supported by [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="b11f3-140">자세한 내용은 [데이터베이스 미러링 또는 AlwaysOn 가용성 그룹에 대해 지원되지 않는 데이터베이스 간 트랜잭션&#40;SQL Server&#41;](transactions-always-on-availability-and-database-mirroring.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-140">For more information, see [Cross-Database Transactions Not Supported For Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](transactions-always-on-availability-and-database-mirroring.md).</span></span>  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> <span data-ttu-id="b11f3-141">필수 조건</span><span class="sxs-lookup"><span data-stu-id="b11f3-141">Prerequisites</span></span>  
  
-   <span data-ttu-id="b11f3-142">WSFC 클러스터에 쿼럼이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-142">The WSFC cluster has quorum.</span></span> <span data-ttu-id="b11f3-143">클러스터에 쿼럼이 없는 경우 [강제 쿼럼을 통해 WSFC 재해 복구&#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md)의 PowerShell을 사용하여 Always On 가용성 그룹에서 강제 장애 조치(failover)(데이터 손실 가능)를 수행하는 방법을 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-143">If the cluster lacks quorum, see [WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span></span>  
  
-   <span data-ttu-id="b11f3-144">역할이 SECONDARY 또는 RESOLVING 상태인 복제본을 호스팅하는 서버 인스턴스에 연결할 수 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-144">You must be able to connect to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state.</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="b11f3-145">권장 사항</span><span class="sxs-lookup"><span data-stu-id="b11f3-145">Recommendations</span></span>  
  
-   <span data-ttu-id="b11f3-146">주 복제본이 여전히 실행되는 동안에는 강제 장애 조치(failover)를 수행하지 마세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-146">Do not force failover while the primary replica is still running.</span></span>  
  
-   <span data-ttu-id="b11f3-147">가능하면 보조 데이터베이스가 NOT SYNCHRONIZED, SYNCHRONIZED 또는 SYNCHRONIZING 상태인 장애 조치(failover) 대상으로만 강제 장애 조치(failover)를 수행하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-147">If possible, force failover only to a failover target whose secondary databases are either in the NOT SYNCHRONIZED, SYNCHRONIZED, or SYNCHRONIZING state.</span></span> <span data-ttu-id="b11f3-148">보조 데이터베이스가 INTIAILIZGING 또는 REVERTING 상태일 경우 강제 장애 조치(failover)의 영향에 대한 자세한 내용은 이 항목의 앞 부분에서 [제한 사항](#Restrictions)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-148">For information about the implications of forcing failover when a secondary database is in the INTIAILIZGING or REVERTING state, see [Limitations and Restrictions](#Restrictions), earlier in this topic.</span></span>  
  
-   <span data-ttu-id="b11f3-149">일반적으로 서로 다른 비동기 커밋 보조 복제본에서 주 데이터베이스를 기준으로 지정된 보조 데이터베이스의 대기 시간이 비슷해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-149">Typically, the latency of a given secondary database, relative to the primary database, should be similar on different asynchronous-commit secondary replicas.</span></span> <span data-ttu-id="b11f3-150">그러나 강제 장애 조치(failover)를 수행하는 경우 데이터 손실이 중요한 문제가 될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-150">However, when forcing failover, data loss can be a significant concern.</span></span> <span data-ttu-id="b11f3-151">따라서 서로 다른 보조 복제본에서 데이터베이스 복사본의 상대적 대기 시간을 결정하는 데 시간이 걸린다는 사실을 고려해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-151">Therefore, consider taking time to determine the relative latency of the copies of the databases on different secondary replicas.</span></span> <span data-ttu-id="b11f3-152">지정된 보조 데이터베이스의 복사본 중 최소 대기 시간을 갖는 복사본을 확인하려면 해당 로그 끝 LSN을 비교합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-152">To determine which copy of a given secondary database has the least latency, compare their end-of-log LSNs.</span></span> <span data-ttu-id="b11f3-153">로그 끝 LSN이 클수록 대기 시간이 짧습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-153">A higher the end-of-log LSN indicates less latency.</span></span>  
  
    > [!TIP]  
    >  <span data-ttu-id="b11f3-154">로그 LSN 끝을 비교하려면 각 온라인 보조 복제본에 연결한 다음 각 로컬 보조 데이터베이스의 [end_of_log_lsn](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) 값에 대해 **sys.dm_hadr_database_replica_states** 를 쿼리합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-154">To compare end-of-log LSNs, connect to each online secondary replica, in turn, and query [sys.dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) for the **end_of_log_lsn** value of each local secondary database.</span></span> <span data-ttu-id="b11f3-155">그런 다음 각 데이터베이스의 여러 다른 복사본의 로그 끝 LSN을 비교합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-155">Then, compare the end-of-log LSNs of the different copies of each database.</span></span> <span data-ttu-id="b11f3-156">각 보조 복제본마다 각 데이터베이스의 가장 큰 LSN이 다를 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-156">Note that different databases might have their highest LSNs on different secondary replicas.</span></span> <span data-ttu-id="b11f3-157">이 경우 가장 적절한 장애 조치(failover) 대상은 서로 다른 데이터베이스의 데이터에 두는 상대적 중요도에 따라 달라집니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-157">In this case, the most appropriate failover target depends on the relative importance that you place on the data in the different databases.</span></span> <span data-ttu-id="b11f3-158">즉, 이러한 데이터베이스 중 데이터 손실을 가장 최소화하려는 데이터베이스를 고려합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-158">That is, for which of these databases would you most want to minimize possible data loss?</span></span>  
  
-   <span data-ttu-id="b11f3-159">클라이언트가 원래 주 복제본에 연결할 수 있는 경우 강제 장애 조치(failover)를 수행하면 분리 장애(split-brain) 동작이 발생할 위험이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-159">If clients are able to connect to the original primary, a forced failover incurs some risk of split brain behavior.</span></span> <span data-ttu-id="b11f3-160">강제 장애 조치(failover)를 수행하기 전에 클라이언트가 원래 주 복제본에 액세스하지 않도록 하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-160">Before you force failover, we strongly recommend that you prevent clients from accessing the original primary replica.</span></span> <span data-ttu-id="b11f3-161">그렇지 않으면 강제로 장애 조치한 후 원래 주 데이터베이스와 현재 주 데이터베이스가 서로 독립적으로 업데이트될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-161">Otherwise, after failover is forced, the original primary databases and the current primary databases could be updated independently of the other.</span></span>  
  
###  <a name="potential-ways-to-avoid-data-loss-after-quorum-is-forced"></a><a name="WaysToAvoidDataLoss"></a> <span data-ttu-id="b11f3-162">강제 쿼럼 후 데이터 손실을 방지할 수 있는 잠재적인 방법</span><span class="sxs-lookup"><span data-stu-id="b11f3-162">Potential Ways to Avoid Data Loss After Quorum is Forced</span></span>  
 <span data-ttu-id="b11f3-163">쿼럼이 손실된 후 오류 조건에 따라 다음과 같이 데이터 손실을 방지할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-163">Under some failure conditions after quorum is lost, you can avoid prevent data loss, as follows:</span></span>  
  
-   <span data-ttu-id="b11f3-164">**원래 주 복제본이 온라인 상태가 된 경우**</span><span class="sxs-lookup"><span data-stu-id="b11f3-164">**If the original primary replica comes online**</span></span>  
  
     <span data-ttu-id="b11f3-165">쿼럼이 손실된 경우 WSFC 쿼럼 강제 적용으로 가용성 그룹의 주 복제본을 호스팅하는 클러스터 노드를 복원하면 이 가용성 그룹에 대한 데이터 손실을 방지할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-165">If quorum is lost and forcing WSFC quorum restores the cluster node that hosts the primary replica of an availability group, you can prevent data loss for this availability group.</span></span> <span data-ttu-id="b11f3-166">주 복제본에 연결하고 강제 장애 조치(failover)(FAILOVER_ALLOW_DATA_LOSS)를 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-166">Connect to the primary replica and perform a forced failover (FAILOVER_ALLOW_DATA_LOSS).</span></span> <span data-ttu-id="b11f3-167">이렇게 하면 주 복제본이 다시 온라인 상태가 됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-167">This brings the primary replica back online.</span></span> <span data-ttu-id="b11f3-168">원래 주 복제본으로 강제 장애 조치(failover)를 수행하므로 데이터가 손실되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-168">Because you perform the forced failover to the original primary replica, there is no data loss.</span></span>  
  
-   <span data-ttu-id="b11f3-169">**동기화된 동기-커밋 보조 복제본이 온라인 상태가 된 경우**</span><span class="sxs-lookup"><span data-stu-id="b11f3-169">**If a synchronized synchronous-commit secondary replica comes online**</span></span>  
  
     <span data-ttu-id="b11f3-170">쿼럼이 손실된 경우 WSFC 쿼럼 강제 적용으로 가용성 그룹의 동기화된 보조 복제본을 호스팅하는 클러스터 노드를 복원하면 이 가용성 그룹에 대한 데이터 손실을 방지할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-170">If quorum is lost and forcing WSFC quorum restores a cluster node that hosts a synchronized secondary replica for an availability group, you should be able to prevent data loss for this availability group.</span></span> <span data-ttu-id="b11f3-171">쿼럼 손실 당시 복원된 노드가 실행 중이었다면 **sys.dm_hadr_database_replica_cluster_states** 동적 관리 뷰의 [is_failover_ready](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-cluster-states-transact-sql) 열을 쿼리하여 지정된 데이터베이스에서 데이터 손실이 발생할 수 있었는지 여부를 확인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-171">If the restored node was up at the time that quorum was lost, you can determine whether data loss could occur on a given database by querying the **is_failover_ready** column of the [sys.dm_hadr_database_replica_cluster_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-cluster-states-transact-sql) dynamic management view.</span></span> <span data-ttu-id="b11f3-172">예를 들어 `sql108w2k8r22`라는 서버 인스턴스가 있다고 가정할 경우 다음 쿼리를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-172">For example, for a server instance named `sql108w2k8r22`, issue the following query:</span></span>  
  
    ```  
    SELECT * FROM sys.dm_hadr_database_replica_cluster_states  
       WHERE replica_id=(SELECT replica_id FROM sys.availability_replicas   
          WHERE replica_server_name ='sql108w2k8r22')  
    ```  
  
    > [!CAUTION]  
    >  <span data-ttu-id="b11f3-173">쿼럼 손실 당시 복원된 노드가 실행되고 있지 않았다면 주 복제본이 오프라인으로 전환될 당시의 실제 클러스터 상태가 **is_failover_ready** 에 반영되지 않을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-173">If the restored node was not up at the time quorum was lost, **is_failover_ready** may not reflect the cluster's actual state at the time the primary replica went offline.</span></span> <span data-ttu-id="b11f3-174">따라서 **is_failover_ready** 값은 실패 당시 호스트 노드가 실행 중이었던 경우에만 유효합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-174">Therefore, the **is_failover_ready** value is only good if the host node at the time of the failure.</span></span> <span data-ttu-id="b11f3-175">자세한 내용은 [장애 조치(Failover) 및 장애 조치(Failover) 모드&#40;AlwaysOn 가용성 그룹&#41;](failover-and-failover-modes-always-on-availability-groups.md)에서 "강제 쿼럼 후에 강제 장애 조치(failover)가 필요한 이유"를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-175">For more information, see "Why Forced Failover is Required After Forcing Quorum" in [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
     <span data-ttu-id="b11f3-176">**is_failover_ready** 가 1이면 데이터베이스가 클러스터에서 동기화된 상태로 표시되고 장애 조치(failover)를 수행할 준비가 됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-176">If **is_failover_ready** = 1, the database is marked as synchronized in the cluster and is ready for a failover.</span></span> <span data-ttu-id="b11f3-177">지정된 보조 복제본의 모든 데이터베이스에 대해 **is_failover_ready** 가 1이면 이 데이터 복제본에서 데이터 손실 없이 강제 장애 조치(failover)(FORCE_FAILOVER_ALLOW_DATA_LOSS)를 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-177">If **is_failover_ready** = 1 on every database on a given secondary replica, you can perform a forced failover (FORCE_FAILOVER_ALLOW_DATA_LOSS) without data loss on this secondary replica.</span></span> <span data-ttu-id="b11f3-178">그러면 동기화된 보조 복제본이 주 역할에서 온라인 상태가 됩니다. 즉, 모든 데이터가 그대로 있는 상태에서 새로운 주 복제본이 됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-178">The synchronized secondary replica comes online in the primary role, that is, as the new primary replica, with all the data intact.</span></span>  
  
     <span data-ttu-id="b11f3-179">**is_failover_ready** 가 0이면 데이터베이스가 클러스터에서 동기화된 상태로 표시되지 않고 계획된 수동 장애 조치(failover)를 수행할 준비가 되지 *않습니다* .</span><span class="sxs-lookup"><span data-stu-id="b11f3-179">If **is_failover_ready** = 0, the database is not marked as synchronized in the cluster and is *not* ready for a planned manual failover.</span></span> <span data-ttu-id="b11f3-180">호스트 보조 복제본으로 강제 장애 조치(failover)를 수행하면 이 데이터베이스에서 데이터가 손실됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-180">If you force failover to the host secondary replica, data will be lost on this database.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="b11f3-181">보조 복제본으로 강제 장애 조치(failover)를 수행할 때 손실되는 데이터의 양은 주 복제본과 장애 조치 대상(failover) 간의 시간차에 의해 결정됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-181">When you force failover to a secondary replica, the amount of data loss will depend on how far the failover target is lagging behind the primary replica.</span></span> <span data-ttu-id="b11f3-182">그러나 WSFC 클러스터에 쿼럼이 부족하거나 쿼럼이 강제로 적용된 경우에는 잠재적 데이터 손실 양을 평가할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-182">Unfortunately, when the WSFC cluster lacks quorum or quorum has been forced, you cannot assess the amount of potential data loss.</span></span> <span data-ttu-id="b11f3-183">그러나 WSFC 클러스터가 정상 상태의 쿼럼을 다시 얻으면 잠재적 데이터 손실 추적을 시작할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-183">Note, however, that once the WSFC cluster regains a healthy quorum, you could begin to track potential data loss.</span></span> <span data-ttu-id="b11f3-184">자세한 내용은 [장애 조치(Failover) 및 장애 조치(Failover) 모드&#40;AlwaysOn 가용성 그룹&#41;](failover-and-failover-modes-always-on-availability-groups.md)에서 "잠재적인 데이터 손실 추적"을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-184">For more information, see "Tracking Potential Data Loss" in [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="b11f3-185">보안</span><span class="sxs-lookup"><span data-stu-id="b11f3-185">Security</span></span>  
  
####  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="b11f3-186">권한</span><span class="sxs-lookup"><span data-stu-id="b11f3-186">Permissions</span></span>  
 <span data-ttu-id="b11f3-187">가용성 그룹에 대한 ALTER AVAILABILITY GROUP 권한, CONTROL AVAILABILITY GROUP 권한, ALTER ANY AVAILABILITY GROUP 권한 또는 CONTROL SERVER 권한이 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-187">Requires ALTER AVAILABILITY GROUP permission on the availability group, CONTROL AVAILABILITY GROUP permission, ALTER ANY AVAILABILITY GROUP permission, or CONTROL SERVER permission.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="b11f3-188">SQL Server Management Studio 사용</span><span class="sxs-lookup"><span data-stu-id="b11f3-188">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="b11f3-189">**강제 장애 조치(failover)를 수행하려면(데이터가 손실될 수 있음)**</span><span class="sxs-lookup"><span data-stu-id="b11f3-189">**To force failover (with possible data loss)**</span></span>  
  
1.  <span data-ttu-id="b11f3-190">개체 탐색기에서, 장애 조치해야 할 가용성 그룹에서 역할이 SECONDARY 또는 RESOLVING인 복제본을 호스팅하는 서버 인스턴스에 연결하고 서버 트리를 확장합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-190">In Object Explorer, connect to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state in the availability group that needs to be failed over, and expand the server tree.</span></span>  
  
2.  <span data-ttu-id="b11f3-191">**AlwaysOn 고가용성** 및 **가용성 그룹** 노드를 확장합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-191">Expand the **AlwaysOn High Availability** node and the **Availability Groups** node.</span></span>  
  
3.  <span data-ttu-id="b11f3-192">장애 조치할 가용성 그룹을 마우스 오른쪽 단추로 클릭하고 **장애 조치(Failover)** 명령을 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-192">Right-click the availability group to be failed over, and select the **Failover** command.</span></span>  
  
4.  <span data-ttu-id="b11f3-193">그러면 가용성 그룹 장애 조치(failover) 마법사가 시작됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-193">This launches the Failover Availability Group Wizard.</span></span> <span data-ttu-id="b11f3-194">자세한 내용은 [가용성 그룹 장애 조치(failover) 마법사 사용&#40;SQL Server Management Studio&#41;](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-194">For more information, see [Use the Fail Over Availability Group Wizard &#40;SQL Server Management Studio&#41;](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md).</span></span>  
  
5.  <span data-ttu-id="b11f3-195">가용성 그룹을 강제로 장애 조치한 후 필요한 후속 단계를 완료합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-195">After forcing an availability group to fail over, complete the necessary follow-up steps.</span></span> <span data-ttu-id="b11f3-196">자세한 내용은 이 항목 뒷부분에 있는 [후속 작업: 강제 장애 조치(failover) 후 필수 작업](#FollowUp)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-196">For more information, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp), later in this topic.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="b11f3-197">Transact-SQL 사용</span><span class="sxs-lookup"><span data-stu-id="b11f3-197">Using Transact-SQL</span></span>  
 <span data-ttu-id="b11f3-198">**강제 장애 조치(failover)를 수행하려면(데이터가 손실될 수 있음)**</span><span class="sxs-lookup"><span data-stu-id="b11f3-198">**To force failover (with possible data loss)**</span></span>  
  
1.  <span data-ttu-id="b11f3-199">장애 조치해야 할 가용성 그룹에서 역할이 SECONDARY 또는 RESOLVING 상태인 복제본을 호스팅하는 서버 인스턴스에 연결합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-199">Connect to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state in the availability group that needs to be failed over.</span></span>  
  
2.  <span data-ttu-id="b11f3-200">다음과 같은 [ALTER AVAILABILITY GROUP](/sql/t-sql/statements/alter-availability-group-transact-sql) 문을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-200">Use the [ALTER AVAILABILITY GROUP](/sql/t-sql/statements/alter-availability-group-transact-sql) statement, as follows:</span></span>  
  
     <span data-ttu-id="b11f3-201">ALTER AVAILABILITY GROUP *group_name* FORCE_FAILOVER_ALLOW_DATA_LOSS</span><span class="sxs-lookup"><span data-stu-id="b11f3-201">ALTER AVAILABILITY GROUP *group_name* FORCE_FAILOVER_ALLOW_DATA_LOSS</span></span>  
  
     <span data-ttu-id="b11f3-202">여기서 *group_name* 은 가용성 그룹의 이름입니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-202">where *group_name* is the name of the availability group.</span></span>  
  
     <span data-ttu-id="b11f3-203">다음 예에서는 `AccountsAG` 가용성 그룹을 로컬 보조 복제본으로 강제로 장애 조치(failover)합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-203">The following example forces the `AccountsAG` availability group to fail over to the local secondary replica.</span></span>  
  
    ```sql
    ALTER AVAILABILITY GROUP AccountsAG FORCE_FAILOVER_ALLOW_DATA_LOSS;  
    ```  
  
3.  <span data-ttu-id="b11f3-204">가용성 그룹을 강제로 장애 조치한 후 필요한 후속 단계를 완료합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-204">After forcing an availability group to fail over, complete the necessary follow-up steps.</span></span> <span data-ttu-id="b11f3-205">자세한 내용은 이 항목 뒷부분에 있는 [후속 작업: 강제 장애 조치(failover) 후 필수 작업](#FollowUp)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-205">For more information, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp), later in this topic.</span></span>  
  
##  <a name="using-powershell"></a><a name="PowerShellProcedure"></a> <span data-ttu-id="b11f3-206">PowerShell 사용</span><span class="sxs-lookup"><span data-stu-id="b11f3-206">Using PowerShell</span></span>  
 <span data-ttu-id="b11f3-207">**강제 장애 조치(failover)를 수행하려면(데이터가 손실될 수 있음)**</span><span class="sxs-lookup"><span data-stu-id="b11f3-207">**To force failover (with possible data loss)**</span></span>  
  
1.  <span data-ttu-id="b11f3-208">`cd`장애 조치 (failover) 해야 하는 가용성 그룹의 보조 또는 해결 상태에 역할이 있는 복제본을 호스팅하는 서버 인스턴스로 디렉터리를 변경 합니다 ().</span><span class="sxs-lookup"><span data-stu-id="b11f3-208">Change directory (`cd`) to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state in the availability group that needs to be failed over.</span></span>  
  
2.  <span data-ttu-id="b11f3-209">다음 형식 중 하나로 `Switch-SqlAvailabilityGroup` Cmdlet을 `AllowDataLoss` 매개 변수와 함께 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-209">Use the `Switch-SqlAvailabilityGroup` cmdlet with the `AllowDataLoss` parameter in one of the following forms:</span></span>  
  
    -   `-AllowDataLoss`  
  
         <span data-ttu-id="b11f3-210">기본적으로 `-AllowDataLoss` 매개 변수를 사용하면 `Switch-SqlAvailabilityGroup`에서 강제 장에 조치를 수행하면 커밋되지 않은 트랜잭션이 손실될 수 있음을 알리고 확인을 요청하는 메시지가 나타납니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-210">By default `-AllowDataLoss` parameter causes `Switch-SqlAvailabilityGroup` to prompt you to remind you that forcing failover might result in the loss of uncommitted transactions and to request confirmation.</span></span> <span data-ttu-id="b11f3-211">계속하려면 `Y`를 입력하고, 작업을 취소하려면 `N`을 입력합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-211">To continue, enter `Y`; to cancel the operation, enter `N`.</span></span>  
  
         <span data-ttu-id="b11f3-212">다음 예제에서는 `MyAg` 이라는 서버 인스턴스의 보조 복제본으로 가용성 그룹 `SecondaryServer\InstanceName`의 강제 장애 조치(failover)(데이터가 손실될 수 있음)를 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-212">The following example performs a forced failover (with possible data loss) of the availability group `MyAg` to the secondary replica on the server instance named `SecondaryServer\InstanceName`.</span></span> <span data-ttu-id="b11f3-213">이 작업을 확인하라는 메시지가 나타납니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-213">You will be prompted to confirm this operation.</span></span>  
  
        ```powershell
        Switch-SqlAvailabilityGroup -Path SQLSERVER:\Sql\SecondaryServer\InstanceName\AvailabilityGroups\MyAg -AllowDataLoss  
        ```  
  
    -   <span data-ttu-id="b11f3-214">**-AllowDataLoss-Force**</span><span class="sxs-lookup"><span data-stu-id="b11f3-214">**-AllowDataLoss-Force**</span></span>  
  
         <span data-ttu-id="b11f3-215">확인하지 않고 강제 장애 조치(failover)를 시작하려면 `-AllowDataLoss` 및 `-Force` 매개 변수를 모두 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-215">To initiate a forced failover without confirmation, specify both the `-AllowDataLoss` and `-Force` parameters.</span></span> <span data-ttu-id="b11f3-216">이 작업은 명령을 스크립트에 포함시키고 사용자 상호 작용 없이 명령을 실행하려는 경우에 유용합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-216">This is useful if you want to include the command in a script and run it without user interaction.</span></span>  <span data-ttu-id="b11f3-217">그러나 강제 장애 조치(failover)를 수행하면 가용성 그룹에 참여하는 데이터베이스에서 데이터가 손실될 수 있으므로 `-Force` 옵션은 주의해서 사용해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-217">However, use the `-Force` option with caution, because a forced failover might result in the loss of data from databases participating the availability group.</span></span>  
  
         <span data-ttu-id="b11f3-218">다음 예제에서는 `MyAg` 이라는 서버 인스턴스로 가용성 그룹 `SecondaryServer\InstanceName`의 강제 장애 조치(failover)(데이터가 손실될 수 있음)를 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-218">The following example performs a forced failover (with possible data loss) of the availability group `MyAg` to the server instance named `SecondaryServer\InstanceName`.</span></span> <span data-ttu-id="b11f3-219">`-Force` 옵션을 사용하면 이 작업의 확인 메시지가 표시되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-219">The `-Force` option suppresses confirmation of this operation.</span></span>  
  
        ```powershell
        Switch-SqlAvailabilityGroup -Path SQLSERVER:\Sql\SecondaryServer\InstanceName\AvailabilityGroups\MyAg -AllowDataLoss -Force  
        ```  
  
    > [!NOTE]  
    >  <span data-ttu-id="b11f3-220">cmdlet의 구문을 보려면 `Get-Help` PowerShell 환경에서 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] cmdlet을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-220">To view the syntax of a cmdlet, use the `Get-Help` cmdlet in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] PowerShell environment.</span></span> <span data-ttu-id="b11f3-221">자세한 내용은 [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-221">For more information, see [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span></span>  
  
3.  <span data-ttu-id="b11f3-222">가용성 그룹을 강제로 장애 조치한 후 필요한 후속 단계를 완료합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-222">After forcing an availability group to fail over, complete the necessary follow-up steps.</span></span> <span data-ttu-id="b11f3-223">자세한 내용은 이 항목 뒷부분에 있는 [후속 작업: 강제 장애 조치(failover) 후 필수 작업](#FollowUp)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-223">For more information, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp), later in this topic.</span></span>  
  
 <span data-ttu-id="b11f3-224">**SQL Server PowerShell 공급자를 설정하고 사용하려면**</span><span class="sxs-lookup"><span data-stu-id="b11f3-224">**To set up and use the SQL Server PowerShell provider**</span></span>  
  
-   [<span data-ttu-id="b11f3-225">SQL Server PowerShell 공급자</span><span class="sxs-lookup"><span data-stu-id="b11f3-225">SQL Server PowerShell Provider</span></span>](../../../powershell/sql-server-powershell-provider.md)  
  
##  <a name="follow-up-essential-tasks-after-a-forced-failover"></a><a name="FollowUp"></a> <span data-ttu-id="b11f3-226">후속 작업: 강제 장애 조치(failover) 후 필수 작업</span><span class="sxs-lookup"><span data-stu-id="b11f3-226">Follow Up: Essential Tasks After a Forced Failover</span></span>  
  
1.  <span data-ttu-id="b11f3-227">강제 장애 조치 후 장애 조치한 보조 복제본은 새로운 주 복제본이 됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-227">After a forced failover, the secondary replica to which you failed over becomes the new primary replica.</span></span> <span data-ttu-id="b11f3-228">그러나 해당 가용성 복제본이 클라이언트에 액세스할 수 있도록 하려면 다음과 같이 WSFC 쿼럼을 다시 구성하거나 가용성 그룹의 가용성 모드 구성을 조정해야 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-228">However, to make that availability replica accessible to clients, you might need to reconfigure the WSFC quorum or adjust the availability-mode configuration of the availability group, as follows:</span></span>  
  
    -   <span data-ttu-id="b11f3-229">**[!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)] 외부에서 장애 조치(failover)한 경우:**  새로운 가용성 그룹 구성을 반영하도록 WSFC 노드의 쿼럼 투표를 조정합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-229">**If you failed over outside of the [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]:**  Adjust the quorum votes of the WSFC nodes to reflect your new availability group configuration.</span></span> <span data-ttu-id="b11f3-230">대상 보조 복제본을 호스팅하는 WSFC 노드에 WSFC 쿼럼 투표가 없는 경우 WSFC 쿼럼을 강제 적용해야 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-230">If the WSFC node that hosts the target secondary replica does not have a WSFC quorum vote, you might need to force WSFC quorum.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="b11f3-231">[!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)] 는 자동 장애 조치(failover)를 사용하는 동기-커밋 모드에 대해 2개의 가용성 복제본(이전의 주 복제본 포함)이 구성된 경우에만 존재합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-231">An [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)] exists only if two availability replicas (including the previous primary replica) are configured for synchronous-commit mode with automatic failover.</span></span>  
  
         <span data-ttu-id="b11f3-232">**쿼럼 투표를 조정하려면**</span><span class="sxs-lookup"><span data-stu-id="b11f3-232">**To adjust quorum votes**</span></span>  
  
        -   [<span data-ttu-id="b11f3-233">클러스터 쿼럼 NodeWeight 설정 보기</span><span class="sxs-lookup"><span data-stu-id="b11f3-233">View Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/view-cluster-quorum-nodeweight-settings.md)  
  
        -   [<span data-ttu-id="b11f3-234">클러스터 쿼럼 NodeWeight 설정 구성</span><span class="sxs-lookup"><span data-stu-id="b11f3-234">Configure Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/configure-cluster-quorum-nodeweight-settings.md)  
  
        -   [<span data-ttu-id="b11f3-235">쿼럼 없이 WSFC 클러스터 강제 시작</span><span class="sxs-lookup"><span data-stu-id="b11f3-235">Force a WSFC Cluster to Start Without a Quorum</span></span>](../../../sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum.md)  
  
    -   <span data-ttu-id="b11f3-236">**[!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)] 외부에서 장애 조치(failover)한 경우:** 원하는 동기-커밋 및 자동 장애 조치(failover) 구성을 반영하도록 새로운 주 복제본과 나머지 보조 복제본에서 가용성 모드와 장애 조치(failover) 모드를 조정하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-236">**If you failed over outside of the [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)]:** We recommend that you consider adjusting the availability mode and failover mode on the new primary replica and on remaining secondary replicas to reflect your desired synchronous-commit and automatic failover configuration.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="b11f3-237">[!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)] 은 현재 주 복제본이 동기-커밋 모드용으로 구성되어 있는 경우에만 존재합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-237">A [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)] exists only if the current primary replica is configured for synchronous-commit mode.</span></span>  
  
         <span data-ttu-id="b11f3-238">**가용성 모드와 장애 조치(failover) 모드를 변경하려면**</span><span class="sxs-lookup"><span data-stu-id="b11f3-238">**To change the availability mode and failover mode**</span></span>  
  
        -   [<span data-ttu-id="b11f3-239">가용성 복제본의 가용성 모드 변경&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-239">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)  
  
        -   [<span data-ttu-id="b11f3-240">가용성 복제본의 장애 조치(failover) 모드 변경&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-240">Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-failover-mode-of-an-availability-replica-sql-server.md)  
  
2.  <span data-ttu-id="b11f3-241">강제 장애 조치(failover) 후 모든 보조 데이터베이스가 일시 중지됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-241">After a forced failover, all secondary databases are suspended.</span></span> <span data-ttu-id="b11f3-242">여기에는 이전 주 복제본이 다시 온라인 상태가 되고 이제 보조 복제본임을 확인한 후의 이전 주 데이터베이스가 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-242">This includes the former primary databases, after the former primary replica comes back online and discovers that it is now a secondary replica.</span></span> <span data-ttu-id="b11f3-243">각 보조 복제본에서 일시 중지된 각 데이터베이스를 개별적으로 수동 재개해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-243">You must manually resume each suspended database individually on each secondary replica.</span></span>  
  
     <span data-ttu-id="b11f3-244">재개된 보조 데이터베이스는 해당 주 데이터베이스와 데이터 동기화를 시작합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-244">When a secondary database is resumed, it initiates data synchronization with the corresponding primary database.</span></span> <span data-ttu-id="b11f3-245">장애 조치 후 주 데이터베이스에 데이터 손실을 염려 하는 경우에 동기-커밋 보조 데이터베이스 중 하나에서 일시 중지 된 데이터베이스에서 데이터베이스 스냅샷을 만들 하려고 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-245">The secondary database rolls back any log records that were never committed on the new primary database.Therefore, if you are concerned about possible data loss on the post-failover primary databases, you should attempt to create a database snapshot on the suspended databases on one of the synchronous-commit secondary databases.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="b11f3-246">보조 데이터베이스 중 하나라도 일시 중지되어 있는 동안에는 주 데이터베이스에서 트랜잭션 로그 잘림이 지연됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-246">Transaction log truncation is delayed on a primary database while any of its secondary databases is suspended.</span></span> <span data-ttu-id="b11f3-247">또한 일시 중지된 상태로 남아 있는 로컬 데이터베이스가 있으면 동기 커밋 보조 복제본의 동기화 상태가 정상으로 전환될 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-247">Also the synchronization health of a synchronous-commit secondary replica cannot transition to HEALTHY as long as any local database remains suspended.</span></span>  
  
     <span data-ttu-id="b11f3-248">**데이터베이스 스냅샷을 만들려면**</span><span class="sxs-lookup"><span data-stu-id="b11f3-248">**To create a database snapshot**</span></span>  
  
    -   [<span data-ttu-id="b11f3-249">데이터베이스 스냅샷 만들기&#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-249">Create a Database Snapshot &#40;Transact-SQL&#41;</span></span>](../../../relational-databases/databases/create-a-database-snapshot-transact-sql.md)  
  
     <span data-ttu-id="b11f3-250">**가용성 데이터베이스를 재개하려면**</span><span class="sxs-lookup"><span data-stu-id="b11f3-250">**To resume an availability database**</span></span>  
  
    -   [<span data-ttu-id="b11f3-251">가용성 데이터베이스 재개&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-251">Resume an Availability Database &#40;SQL Server&#41;</span></span>](resume-an-availability-database-sql-server.md)  
  
    > [!CAUTION]  
    >  <span data-ttu-id="b11f3-252">모든 보조 데이터베이스를 재개한 후 그룹을 다시 장애 조치하기 전에 다음 장애 조치(failover) 대상의 모든 보조 데이터베이스가 SYNCHRONIZING 상태로 전환될 때까지 기다립니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-252">After resuming all the secondary databases, before attempting to fail over the group again, wait for every secondary database on the next failover target to enter the SYNCHRONIZING state.</span></span> <span data-ttu-id="b11f3-253">데이터베이스가 아직 SYNCHRONIZING 상태가 아닌 경우 해당 데이터베이스는 주 데이터베이스로 온라인 상태가 될 수 없으며 데이터베이스에 대한 데이터 동기화를 다시 설정하려면 트랜잭션 로그를 복원하거나 전체 데이터베이스 백업을 복원하거나 다시 이전의 주 복제본으로 장애 조치해야 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-253">If any database is not yet SYNCHRONIZING, that database will be prevented from coming online as a primary database, and re-establishing data synchronization for the database might require restoring transaction logs, restoring a full database backup, or failing over back to the previous primary replica.</span></span>  
  
3.  <span data-ttu-id="b11f3-254">실패한 가용성 복제본이 가용성 복제본으로 돌아가지 않거나 너무 늦게 돌아가서 새로운 주 데이터베이스에서 트랜잭션 로그 잘림을 지연시킬 수 없는 경우 가용성 그룹에서 오류 상태의 복제본을 제거하여 로그 파일에 사용할 디스크 공간이 부족하지 않도록 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-254">If an availability replica that failed will not be returning to the availability replica or will return too late for you to delay transaction log truncation on the new primary database, consider removing the failed replica from the availability group to avoid running out of disk space for your log files.</span></span>  
  
     <span data-ttu-id="b11f3-255">**보조 복제본을 제거하려면**</span><span class="sxs-lookup"><span data-stu-id="b11f3-255">**To remove a secondary replica**</span></span>  
  
    -   [<span data-ttu-id="b11f3-256">가용성 그룹에서 보조 복제본 제거&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-256">Remove a Secondary Replica from an Availability Group &#40;SQL Server&#41;</span></span>](remove-a-secondary-replica-from-an-availability-group-sql-server.md)  
  
4.  <span data-ttu-id="b11f3-257">하나 이상의 추가 강제 장애 조치(Failover)가 포함된 강제 장애 조치를 수행하는 경우 각 추가 강제 장애 조치 후 로그 백업을 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-257">If you follow a forced failover with one or more additional forced failovers, perform a log backup after each additional forced failover in the series.</span></span> <span data-ttu-id="b11f3-258">그 이유에 대한 자세한 내용은 [장애 조치(Failover) 및 장애 조치(Failover) 모드&#40;AlwaysOn 가용성 그룹&#41;](failover-and-failover-modes-always-on-availability-groups.md) "강제 수동 장애 조치(Failover)(데이터가 손실될 수 있음)" 섹션에 있는 "강제 장애 조치(Failover)의 위험"을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="b11f3-258">For information about the reason for this, see "Risks of Forcing Failover" in the "Forced Manual Failover (with Possible Data Loss)" section of [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
     <span data-ttu-id="b11f3-259">**로그 백업을 수행하려면**</span><span class="sxs-lookup"><span data-stu-id="b11f3-259">**To perform a log backup**</span></span>  
  
    -   [<span data-ttu-id="b11f3-260">트랜잭션 로그 백업&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-260">Back Up a Transaction Log &#40;SQL Server&#41;</span></span>](../../../relational-databases/backup-restore/back-up-a-transaction-log-sql-server.md)  
  
##  <a name="example-scenario-using-a-forced-failover-to-recover-from-a-catastrophic-failure"></a><a name="ExampleRecoveryFromCatastrophy"></a> <span data-ttu-id="b11f3-261">시나리오 예: 강제 장애 조치(Failover)를 사용하여 치명적인 오류 복구</span><span class="sxs-lookup"><span data-stu-id="b11f3-261">Example Scenario: Using a Forced Failover to Recover from a Catastrophic Failure</span></span>  
 <span data-ttu-id="b11f3-262">주 복제본이 실패하고 사용할 수 있는 동기화된 보조 복제본이 없는 경우 가용성 그룹을 강제 장애 조치(failover)하는 것이 적절한 대처 방법이 될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-262">If the primary replica fails and no synchronized secondary replica is available, forcing the availability group to fail over might be an appropriate response.</span></span> <span data-ttu-id="b11f3-263">강제 장애 조치(failover)의 적합성은 다음 사항에 따라 결정됩니다. (1) SLA(서비스 수준 계약)에서 허용하는 기간보다 오랫동안 주 복제본이 오프라인 상태가 될 것으로 예상되는지 여부 (2) 주 데이터베이스를 빨리 사용 가능하게 하기 위해 잠재적인 데이터 손실 위험을 감수할지 여부.</span><span class="sxs-lookup"><span data-stu-id="b11f3-263">The appropriateness of forcing a failover depends on: (1) whether you expect the primary replica to be offline for longer than your service level agreement (SLA) tolerates, and (2) whether you are willing to risk potential data loss in order to make primary databases available quickly.</span></span> <span data-ttu-id="b11f3-264">가용성 그룹을 강제 장애 조치(failover)해야 한다고 판단되는 경우 실제 강제 장애 조치(failover)는 여러 단계 프로세스 중 한 단계일 뿐입니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-264">If you decide that an availability group requires a forced failover, the actual forced failover is but one step of a multi-step process.</span></span>  
  
 <span data-ttu-id="b11f3-265">이 항목에서는 강제 장애 조치(failover)를 사용하여 치명적인 오류를 복구하는 데 필요한 단계를 보여 주기 위해 가능한 재해 복구 시나리오를 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-265">To illustrate the steps that are required to use a forced failover to recover from a catastrophic failure, this topic presents one possible disaster recovery scenario.</span></span> <span data-ttu-id="b11f3-266">예제 시나리오에서는 원래 토폴로지가 주 복제본을 비롯한 세 개의 동기 커밋 가용성 복제본을 호스팅하는 기본 데이터 센터와 두 개의 동기 커밋 보조 복제본을 호스팅하는 원격 데이터 센터로 구성된 가용성 그룹을 고려합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-266">The example scenario considers an availability group whose original topology consists of a main data center that hosts three synchronous-commit availability replicas, including the primary replica, and a remote data center that hosts two asynchronous-commit secondary replicas.</span></span> <span data-ttu-id="b11f3-267">다음 그림에서는 이 예제 가용성 그룹의 원래 토폴로지를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-267">The following figure illustrates the original topology of this example availability group.</span></span> <span data-ttu-id="b11f3-268">가용성 그룹은 기본 데이터 센터에 세 개의 노드(**노드 01**, **노드 02**및 **노드 03**)가 있고 원격 데이터 센터에 두 개의 노드(**노드 04** 및 **노드 05**)가 있는 다중 서브넷 WSFC 클러스터에 의해 호스트됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-268">The availability group is hosted by a multi-subnet WSFC cluster with three nodes in the main data center (**Node 01**, **Node 02**, and **Node 03**) and two nodes in a remote data center (**Node 04** and **Node 05**).</span></span>  
  
 <span data-ttu-id="b11f3-269">![가용성 그룹의 원래 토폴로지](../../media/aoag-failurerecovery-origtopology.gif "가용성 그룹의 원래 토폴로지")</span><span class="sxs-lookup"><span data-stu-id="b11f3-269">![Original topology of availability group](../../media/aoag-failurerecovery-origtopology.gif "Original topology of availability group")</span></span>  
  
 <span data-ttu-id="b11f3-270">기본 데이터 센터가 예기치 않게 종료됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-270">The main data center shuts down unexpectedly.</span></span> <span data-ttu-id="b11f3-271">기본 데이터 센터의 세 가용성 복제본이 오프라인 상태가 되고 해당 데이터베이스를 사용할 수 없게 됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-271">Its three availability replicas to go offline, and their databases become unavailable.</span></span> <span data-ttu-id="b11f3-272">다음 그림에서는 이 장애가 가용성 그룹의 토폴로지에 주는 영향을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-272">The following figure illustrates the impact of this failure on the topology of the availability group.</span></span>  
  
 <span data-ttu-id="b11f3-273">![기본 데이터 센터의 오류 후 토폴로지](../../media/aoag-failurerecovery-catastrophy.gif "기본 데이터 센터의 오류 후 토폴로지")</span><span class="sxs-lookup"><span data-stu-id="b11f3-273">![Topology after failure of main data center](../../media/aoag-failurerecovery-catastrophy.gif "Topology after failure of main data center")</span></span>  
  
 <span data-ttu-id="b11f3-274">DBA(데이터베이스 관리자)는 가용성 그룹을 원격 비동기 커밋 보조 복제본 중 하나로 강제 장애 조치(failover)하는 것이 가능한 최고의 대처 방법이라고 결정합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-274">The database administrator (DBA) determines that the best possible response is to force failover of the availability group to one of the remote, asynchronous-commit secondary replicas.</span></span> <span data-ttu-id="b11f3-275">이 예제에서는 가용성 그룹을 원격 복제본으로 강제 장애 조치(failover)하고 가용성 그룹을 원래 토폴로지로 돌려 놓는 경우와 관련된 일반적인 단계를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-275">This example illustrates the typical steps involved when you force failover of the availability group to a remote replica and, eventually, return the availability group to its original topology.</span></span>  
  
  
###  <a name="responding-to-the-catastrophic-failure-of-the-main-data-center"></a><a name="FailureResponse"></a> <span data-ttu-id="b11f3-276">Responding to the Catastrophic Failure of the Main Data Center</span><span class="sxs-lookup"><span data-stu-id="b11f3-276">Responding to the Catastrophic Failure of the Main Data Center</span></span>  
 <span data-ttu-id="b11f3-277">다음 그림에서는 기본 데이터 센터에서의 치명적 오류에 대한 응답으로 원격 데이터 센터에서 수행되는 일련의 동작을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-277">The following figure illustrates the series of actions performed at the remote data center in response a catastrophic failure at the main data center.</span></span>  
  
 <span data-ttu-id="b11f3-278">![기본 데이터 센터의 오류에 응답하는 단계](../../media/aoag-failurerecovery-actions-part1.gif "기본 데이터 센터의 오류에 응답하는 단계")</span><span class="sxs-lookup"><span data-stu-id="b11f3-278">![Steps for responding to failure of main data cente](../../media/aoag-failurerecovery-actions-part1.gif "Steps for responding to failure of main data cente")</span></span>  
  
 <span data-ttu-id="b11f3-279">이 그림의 단계는 다음 단계를 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-279">The steps in this figure indicate the following steps:</span></span>  
  
|<span data-ttu-id="b11f3-280">단계</span><span class="sxs-lookup"><span data-stu-id="b11f3-280">Step</span></span>|<span data-ttu-id="b11f3-281">작업</span><span class="sxs-lookup"><span data-stu-id="b11f3-281">Action</span></span>|<span data-ttu-id="b11f3-282">링크</span><span class="sxs-lookup"><span data-stu-id="b11f3-282">Links</span></span>|  
|----------|------------|-----------|  
|<span data-ttu-id="b11f3-283">**1.**</span><span class="sxs-lookup"><span data-stu-id="b11f3-283">**1.**</span></span>|<span data-ttu-id="b11f3-284">DBA 또는 네트워크 관리자는 WSFC 클러스터가 정상 쿼럼인지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-284">The DBA or network administrator ensures that the WSFC cluster has a healthy quorum.</span></span> <span data-ttu-id="b11f3-285">이 예제에서는 쿼럼을 강제 실행해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-285">In this example, quorum needs to be forced.</span></span>|[<span data-ttu-id="b11f3-286">WSFC 쿼럼 모드 및 투표 구성&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-286">WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;</span></span>](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md)<br /><br /> [<span data-ttu-id="b11f3-287">강제 쿼럼을 통해 WSFC 재해 복구&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-287">WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;</span></span>](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md)|  
|<span data-ttu-id="b11f3-288">**2.**</span><span class="sxs-lookup"><span data-stu-id="b11f3-288">**2.**</span></span>|<span data-ttu-id="b11f3-289">DBA는 **노드 04**에서 최소 대기 시간을 사용하여 서버 인스턴스에 연결하고 강제 수동 장애 조치(failover)를 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-289">The DBA connects to the server instance with the least latency (on **Node 04**) and performs a forced manual failover.</span></span> <span data-ttu-id="b11f3-290">강제 장애 조치(failover)는 이 보조 복제본을 주 역할로 전환하고 나머지 보조 복제본( **노드 05**)에서 보조 데이터베이스를 일시 중지합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-290">The forced failover transitions this secondary replica to the primary role and suspends the secondary databases on the remaining secondary replica (on **Node 05**).</span></span>|<span data-ttu-id="b11f3-291">[sys.dm_hadr_database_replica_states&#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) ( **sys.dm_hadr_database_replica_states** 열을 쿼리합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-291">[sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) (Query the **end_of_log_lsn** column.</span></span> <span data-ttu-id="b11f3-292">자세한 내용은 이 항목의 앞부분에 나오는 [권장 사항](#Recommendations)을 참조하세요.)</span><span class="sxs-lookup"><span data-stu-id="b11f3-292">For more information, see [Recommendations](#Recommendations), earlier in this topic.)</span></span>|  
|<span data-ttu-id="b11f3-293">**3.**</span><span class="sxs-lookup"><span data-stu-id="b11f3-293">**3.**</span></span>|<span data-ttu-id="b11f3-294">DBA는 수동으로 나머지 보조 복제본에서 보조 데이터베이스를 재개합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-294">The DBA manually resumes each of the secondary databases on the remaining secondary replica.</span></span>|[<span data-ttu-id="b11f3-295">가용성 데이터베이스 재개&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-295">Resume an Availability Database &#40;SQL Server&#41;</span></span>](resume-an-availability-database-sql-server.md)|  
  
###  <a name="returning-the-availability-group-to-its-original-topology"></a><a name="ReturnToOrigTopology"></a> <span data-ttu-id="b11f3-296">가용성 그룹을 원래 토폴로지로 복귀</span><span class="sxs-lookup"><span data-stu-id="b11f3-296">Returning the Availability Group to its Original Topology</span></span>  
 <span data-ttu-id="b11f3-297">다음 그림에서는 기본 데이터 센터가 다시 온라인 상태가 되고 WSFC 노드가 WSFC 클러스터와의 통신을 다시 설정한 후 가용성 그룹을 원래 토폴로지로 돌려 놓는 일련의 동작을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-297">The following figure illustrates the series of actions that return the availability group to its original topology after the main data center comes back online and the WSFC nodes re-establish communication with the WSFC cluster.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="b11f3-298">WSFC 클러스터 쿼럼을 강제 적용하는 경우 오프라인 노드가 다시 시작될 때 다음 조건에 모두 부합하면 오프라인 노드가 새 쿼럼을 형성할 수 있습니다. (a) 강제 쿼럼 집합의 노드 간에 네트워크 연결이 없는 경우 (b) 다시 시작되는 노드가 대부분 클러스터 노드인 경우.</span><span class="sxs-lookup"><span data-stu-id="b11f3-298">If the WSFC cluster quorum has been forced, as the offline nodes restart they could form a new quorum if the following conditions both exist: (a) there is no network connectivity between any of the nodes in the forced-quorum set, and (b) the restarting nodes are the majority of the cluster nodes.</span></span> <span data-ttu-id="b11f3-299">이 경우 가용성 그룹에 두 개의 독립적인 주 복제본(각 데이터 센터에 하나씩)이 있는 "분리 장애(split-brain)"가 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-299">This would result in a "split brain" condition in which the availability group would possess two independent primary replicas, one at each data center.</span></span> <span data-ttu-id="b11f3-300">쿼럼을 강제 실행하여 소수 쿼럼 집합을 만들기 전에 [강제 쿼럼을 통해 WSFC 재해 복구&#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md)의 PowerShell을 사용하여 Always On 가용성 그룹에서 강제 장애 조치(failover)(데이터 손실 가능)를 수행하는 방법을 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-300">Before forcing quorum to create a minority quorum set, see [WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span></span>  
  
 <span data-ttu-id="b11f3-301">![그룹을 원래 토폴로지로 복귀하는 단계](../../media/aoag-failurerecovery-actions-part2.gif "그룹을 원래 토폴로지로 복귀하는 단계")</span><span class="sxs-lookup"><span data-stu-id="b11f3-301">![Steps to return the group to its original topology](../../media/aoag-failurerecovery-actions-part2.gif "Steps to return the group to its original topology")</span></span>  
  
 <span data-ttu-id="b11f3-302">이 그림의 단계는 다음 단계를 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-302">The steps in this figure indicate the following steps:</span></span>  
  
||<span data-ttu-id="b11f3-303">단계</span><span class="sxs-lookup"><span data-stu-id="b11f3-303">Step</span></span>|<span data-ttu-id="b11f3-304">링크</span><span class="sxs-lookup"><span data-stu-id="b11f3-304">Links</span></span>|  
|-|----------|-----------|  
|<span data-ttu-id="b11f3-305">**1.**</span><span class="sxs-lookup"><span data-stu-id="b11f3-305">**1.**</span></span>|<span data-ttu-id="b11f3-306">기본 데이터 센터의 노드가 다시 온라인 상태가 되고 WSFC 클러스터와의 통신을 다시 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-306">The nodes in the main data center come back online and re-establish communication with the WSFC cluster.</span></span> <span data-ttu-id="b11f3-307">해당 가용성 복제본이 일시 중지된 데이터베이스가 있는 보조 복제본으로 온라인 상태가 되고 DBA가 곧 이 데이터베이스를 각각 수동으로 재개해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-307">Their availability replicas come online as secondary replicas with suspended databases, and the DBA will need to manually resume each of these databases soon.</span></span>|[<span data-ttu-id="b11f3-308">가용성 데이터베이스 재개&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-308">Resume an Availability Database &#40;SQL Server&#41;</span></span>](resume-an-availability-database-sql-server.md)<br /><br /> <span data-ttu-id="b11f3-309">팁: 사후 장애 조치(failover) 주 데이터베이스에서 데이터가 손실될 가능성이 있는 경우에는 동기 커밋 보조 데이터베이스 중 하나에서 일시 중지된 데이터베이스에 대한 데이터베이스 스냅샷을 만들어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-309">Tip: If you are concerned about possible data loss on the post-failover primary databases, you should attempt to create a database snapshot on the suspended databases on one the synchronous-commit secondary database.</span></span> <span data-ttu-id="b11f3-310">보조 데이터베이스 중 하나라도 일시 중지되어 있는 동안에는 주 데이터베이스에서 트랜잭션 로그 잘림이 지연됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-310">Keep in mind that the transaction log truncation is delayed on a primary database while any of its secondary databases is suspended.</span></span> <span data-ttu-id="b11f3-311">또한 일시 중지된 상태로 남아 있는 로컬 데이터베이스가 있으면 동기 커밋 보조 복제본의 동기화 상태가 정상으로 전환될 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-311">Also the synchronization health of the synchronous-commit secondary replica cannot transition to HEALTHY as long as any local database remains suspended.</span></span>|  
|<span data-ttu-id="b11f3-312">**2.**</span><span class="sxs-lookup"><span data-stu-id="b11f3-312">**2.**</span></span>|<span data-ttu-id="b11f3-313">데이터베이스를 재개하면 DBA가 새 주 복제본을 동기 커밋 모드로 일시적으로 변경합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-313">Once the databases are resumed, the DBA changes the new primary replica to synchronous-commit mode temporarily.</span></span> <span data-ttu-id="b11f3-314">여기에는 다음 두 단계가 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-314">This involves two steps:</span></span><br /><br /> <span data-ttu-id="b11f3-315">1) 오프라인 가용성 복제본 하나를 비동기 커밋 모드로 변경합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-315">1) Change one offline availability replica to asynchronous-commit mode.</span></span> <br /><span data-ttu-id="b11f3-316">2) 새 주 복제본을 동기 커밋 가용성 모드로 변경합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-316">2) Change the new primary replica to synchronous-commit mode.</span></span><br /><span data-ttu-id="b11f3-317">참고: 이 단계에서는 재개된 동기 커밋 보조 데이터베이스를 동기화된 상태로 만들 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-317">Note: This step enables resumed synchronous-commit secondary databases to become SYNCHRONIZED.</span></span>|[<span data-ttu-id="b11f3-318">가용성 복제본의 가용성 모드 변경&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-318">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)|  
|<span data-ttu-id="b11f3-319">**3.**</span><span class="sxs-lookup"><span data-stu-id="b11f3-319">**3.**</span></span>|<span data-ttu-id="b11f3-320">**노드 03** (원래 주 복제본)에서 동기 커밋 보조 복제본이 정상 동기화 상태가 되면 DBA는 해당 복제본에 대해 계획된 수동 장애 조치(failover)를 수행하여 다시 주 복제본이 되도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-320">Once the synchronous-commit secondary replica on **Node 03** (the original primary replica) enters the HEALTHY synchronization state, the DBA performs a planned manual failover to that replica, to make it the primary replica again.</span></span> <span data-ttu-id="b11f3-321">**노드 04** 의 복제본은 보조 복제본으로 돌아갑니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-321">The replica on **Node 04** returns to being a secondary replica.</span></span>|[<span data-ttu-id="b11f3-322">sys.dm_hadr_database_replica_states&#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-322">sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql)<br /><br /> [<span data-ttu-id="b11f3-323">AlwaysOn 정책을 사용 하 여 가용성 그룹 &#40;SQL Server 상태를 확인&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-323">Use AlwaysOn Policies to View the Health of an Availability Group &#40;SQL Server&#41;</span></span>](use-always-on-policies-to-view-the-health-of-an-availability-group-sql-server.md)<br /><br /> [<span data-ttu-id="b11f3-324">가용성 그룹의 계획된 수동 장애 조치(Failover) 수행&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-324">Perform a Planned Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md)|  
|<span data-ttu-id="b11f3-325">**4.**</span><span class="sxs-lookup"><span data-stu-id="b11f3-325">**4.**</span></span>|<span data-ttu-id="b11f3-326">DBA는 새 주 복제본에 연결하고 다음 작업을 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-326">The DBA connects to the new primary replica and:</span></span><br /><br /> <span data-ttu-id="b11f3-327">1) 원격 센터의 이전 주 복제본을 다시 비동기 커밋 모드로 변경합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-327">1) Changes the former primary replica (in the remote center) back to asynchronous-commit mode.</span></span><br /><span data-ttu-id="b11f3-328">2) 기본 데이터 센터의 비동기 커밋 보조 복제본을 다시 동기 커밋 모드로 변경합니다.</span><span class="sxs-lookup"><span data-stu-id="b11f3-328">2) Changes the asynchronous-commit secondary replica in the main data center back to synchronous-commit mode.</span></span>|[<span data-ttu-id="b11f3-329">가용성 복제본의 가용성 모드 변경&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-329">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)|  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="b11f3-330">관련 작업</span><span class="sxs-lookup"><span data-stu-id="b11f3-330">Related Tasks</span></span>  
 <span data-ttu-id="b11f3-331">**쿼럼 투표를 조정하려면**</span><span class="sxs-lookup"><span data-stu-id="b11f3-331">**To adjust quorum votes**</span></span>  
  
-   [<span data-ttu-id="b11f3-332">클러스터 쿼럼 NodeWeight 설정 보기</span><span class="sxs-lookup"><span data-stu-id="b11f3-332">View Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/view-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="b11f3-333">클러스터 쿼럼 NodeWeight 설정 구성</span><span class="sxs-lookup"><span data-stu-id="b11f3-333">Configure Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/configure-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="b11f3-334">쿼럼 없이 WSFC 클러스터 강제 시작</span><span class="sxs-lookup"><span data-stu-id="b11f3-334">Force a WSFC Cluster to Start Without a Quorum</span></span>](../../../sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum.md)  
  
 <span data-ttu-id="b11f3-335">**계획된 수동 장애 조치(failover):**</span><span class="sxs-lookup"><span data-stu-id="b11f3-335">**Planned manual failover:**</span></span>  
  
-   [<span data-ttu-id="b11f3-336">가용성 그룹의 계획된 수동 장애 조치(Failover) 수행&#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-336">Perform a Planned Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md)  
  
-   [<span data-ttu-id="b11f3-337">가용성 그룹 장애 조치(Failover) 마법사 사용&#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-337">Use the Fail Over Availability Group Wizard &#40;SQL Server Management Studio&#41;</span></span>](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md)  
  
 <span data-ttu-id="b11f3-338">**문제를 해결하려면**</span><span class="sxs-lookup"><span data-stu-id="b11f3-338">**To troubleshoot:**</span></span>  
  
-   [<span data-ttu-id="b11f3-339">AlwaysOn 가용성 그룹 구성 &#40;SQL Server에 대 한 문제 해결&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-339">Troubleshoot AlwaysOn Availability Groups Configuration &#40;SQL Server&#41;</span></span>](troubleshoot-always-on-availability-groups-configuration-sql-server.md) 
  
-   [<span data-ttu-id="b11f3-340">실패 한 파일 추가 작업 문제 해결 AlwaysOn 가용성 그룹 &#40;&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-340">Troubleshoot a Failed Add-File Operation &#40;AlwaysOn Availability Groups&#41;</span></span>](troubleshoot-a-failed-add-file-operation-always-on-availability-groups.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="b11f3-341">관련 내용</span><span class="sxs-lookup"><span data-stu-id="b11f3-341">Related Content</span></span>  
  
-   <span data-ttu-id="b11f3-342">**블로그:**</span><span class="sxs-lookup"><span data-stu-id="b11f3-342">**Blogs:**</span></span>  
  
     [<span data-ttu-id="b11f3-343">SQL Server AlwaysOn 팀 블로그: 공식 SQL Server AlwaysOn 팀 블로그</span><span class="sxs-lookup"><span data-stu-id="b11f3-343">SQL Server AlwaysOn Team Blogs: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
     [<span data-ttu-id="b11f3-344">CSS SQL Server 엔지니어 블로그</span><span class="sxs-lookup"><span data-stu-id="b11f3-344">CSS SQL Server Engineers Blogs</span></span>](https://blogs.msdn.com/b/psssql/)  
  
-   <span data-ttu-id="b11f3-345">**백서:**</span><span class="sxs-lookup"><span data-stu-id="b11f3-345">**Whitepapers:**</span></span>  
  
     [<span data-ttu-id="b11f3-346">고가용성 및 재해 복구를 위한 Microsoft SQL Server AlwaysOn 솔루션 가이드</span><span class="sxs-lookup"><span data-stu-id="b11f3-346">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
     [<span data-ttu-id="b11f3-347">SQL Server 2012에 대한 Microsoft 백서</span><span class="sxs-lookup"><span data-stu-id="b11f3-347">Microsoft White Papers for SQL Server 2012</span></span>](https://msdn.microsoft.com/library/hh403491.aspx)  
  
     [<span data-ttu-id="b11f3-348">SQL Server 고객 자문 팀 백서</span><span class="sxs-lookup"><span data-stu-id="b11f3-348">SQL Server Customer Advisory Team Whitepapers</span></span>](http://sqlcat.com/)  
  
## <a name="see-also"></a><span data-ttu-id="b11f3-349">참고 항목</span><span class="sxs-lookup"><span data-stu-id="b11f3-349">See Also</span></span>  
 <span data-ttu-id="b11f3-350">[AlwaysOn 가용성 그룹 &#40;SQL Server 개요&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="b11f3-350">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="b11f3-351">[가용성 모드 &#40;AlwaysOn 가용성 그룹&#41;](availability-modes-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="b11f3-351">[Availability Modes &#40;AlwaysOn Availability Groups&#41;](availability-modes-always-on-availability-groups.md) </span></span>  
 <span data-ttu-id="b11f3-352">[장애 조치 (failover) 및 장애 조치 (failover) 모드 &#40;AlwaysOn 가용성 그룹&#41;](failover-and-failover-modes-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="b11f3-352">[Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md) </span></span>  
 <span data-ttu-id="b11f3-353">[가용성 복제본에 대한 클라이언트 연결 액세스 정보&#40;SQL Server&#41;](about-client-connection-access-to-availability-replicas-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="b11f3-353">[About Client Connection Access to Availability Replicas &#40;SQL Server&#41;](about-client-connection-access-to-availability-replicas-sql-server.md) </span></span>  
 <span data-ttu-id="b11f3-354">[가용성 그룹 모니터링&#40;SQL Server&#41;](monitoring-of-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="b11f3-354">[Monitoring of Availability Groups &#40;SQL Server&#41;](monitoring-of-availability-groups-sql-server.md) </span></span>  
 [<span data-ttu-id="b11f3-355">SQL Server의 WSFC&#40;Windows Server 장애 조치(failover) 클러스터링&#41;</span><span class="sxs-lookup"><span data-stu-id="b11f3-355">Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server</span></span>](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md)  
  
  
