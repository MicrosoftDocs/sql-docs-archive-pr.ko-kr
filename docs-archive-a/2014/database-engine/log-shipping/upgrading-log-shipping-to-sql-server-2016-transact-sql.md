---
title: SQL Server 2014으로 로그 전달 업그레이드 (Transact-sql) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- log shipping [SQL Server], upgrading
ms.assetid: b1289cc3-f5be-40bb-8801-0e3eed40336e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 80330d03853c984cfd26100b02918eb218705085
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87661294"
---
# <a name="upgrade-log-shipping-to-sql-server-2014-transact-sql"></a><span data-ttu-id="308ba-102">SQL Server 2014로 로그 전달 업그레이드(Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="308ba-102">Upgrade Log Shipping to SQL Server 2014 (Transact-SQL)</span></span>
  <span data-ttu-id="308ba-103">[!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)]또는 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] 에서 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]로 업그레이드할 때 로그 전달 구성을 유지할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-103">It is possible to preserve log shipping configurations when upgrading from [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)], or [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="308ba-104">이 항목에서는 로그 전달 구성을 업그레이드하기 위한 다양한 시나리오와 최선의 구현 방법에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-104">This topic describes alternative scenarios and best practices for upgrading a log shipping configuration.</span></span>

> [!NOTE]
>  <span data-ttu-id="308ba-105">[백업 압축](../../relational-databases/backup-restore/backup-compression-sql-server.md)은 [!INCLUDE[ssEnterpriseEd10](../../includes/ssenterpriseed10-md.md)]에서 도입되었습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-105">[Backup compression](../../relational-databases/backup-restore/backup-compression-sql-server.md) was introduced in [!INCLUDE[ssEnterpriseEd10](../../includes/ssenterpriseed10-md.md)].</span></span> <span data-ttu-id="308ba-106">업그레이드된 로그 전달 구성은 **백업 압축 기본값** 서버 수준 구성 옵션을 사용하여 백업 압축을 트랜잭션 로그 백업 파일에 사용할지 여부를 제어합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-106">An upgraded log shipping configuration uses the **backup compression default** server-level configuration option to control whether backup compression is used for the transaction log backup files.</span></span> <span data-ttu-id="308ba-107">로그 백업에 대한 백업 압축 동작은 각 로그 전달 구성에 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-107">The backup compression behavior of log backups can be specified for each log shipping configuration.</span></span> <span data-ttu-id="308ba-108">자세한 내용은 [로그 전달 구성&#40;SQL Server&#41;](configure-log-shipping-sql-server.md)에서 도입되었습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-108">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>


##  <a name="protect-your-data-before-the-upgrade"></a><a name="ProtectData"></a> <span data-ttu-id="308ba-109">업그레이드하기 전에 데이터 보호</span><span class="sxs-lookup"><span data-stu-id="308ba-109">Protect Your Data Before the Upgrade</span></span>
 <span data-ttu-id="308ba-110">가능하면 로그 전달 업그레이드 전에 데이터를 보호하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-110">As a best practice, we recommend that you protect your data before a log shipping upgrade.</span></span>

 <span data-ttu-id="308ba-111">**데이터를 보호하려면**</span><span class="sxs-lookup"><span data-stu-id="308ba-111">**To protect your data**</span></span>

1.  <span data-ttu-id="308ba-112">모든 주 데이터베이스에 대해 전체 데이터베이스 백업을 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-112">Perform a full database backup on every primary database.</span></span>

     <span data-ttu-id="308ba-113">자세한 내용은 [전체 데이터베이스 백업 만들기&#40;SQL Server&#41;](../../relational-databases/backup-restore/create-a-full-database-backup-sql-server.md)에서 차등 데이터베이스 백업을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-113">For more information, see [Create a Full Database Backup &#40;SQL Server&#41;](../../relational-databases/backup-restore/create-a-full-database-backup-sql-server.md).</span></span>

2.  <span data-ttu-id="308ba-114">모든 주 데이터베이스에서 [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) 명령을 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-114">Run the [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) command on every primary database.</span></span>

##  <a name="upgrading-the-monitor-server-instance"></a><a name="UpgradeMonitor"></a><span data-ttu-id="308ba-115">모니터 서버 인스턴스 업그레이드</span><span class="sxs-lookup"><span data-stu-id="308ba-115">Upgrading the Monitor Server Instance</span></span>
 <span data-ttu-id="308ba-116">모니터 서버 인스턴스(있는 경우)는 언제든지 업그레이드할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-116">The monitor server instance, if any, can be upgraded at any time.</span></span>

 <span data-ttu-id="308ba-117">모니터 서버가 업그레이드되는 동안 로그 전달 구성은 계속 작동하지만 해당 상태는 모니터 테이블에 기록되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-117">While the monitor server is being upgraded, the log shipping configuration continues to work, but its status is not recorded in the tables on the monitor.</span></span> <span data-ttu-id="308ba-118">따라서 모니터 서버가 업그레이드되는 동안에는 구성된 경고가 트리거되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-118">Any alerts that have been configured will not be triggered while the monitor server is being upgraded.</span></span> <span data-ttu-id="308ba-119">업그레이드 후에는 [sp_refresh_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-refresh-log-shipping-monitor-transact-sql) 시스템 저장 프로시저를 실행하여 모니터 테이블의 정보를 업데이트할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-119">After the upgrade, you can update the information in the monitor tables by executing the [sp_refresh_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-refresh-log-shipping-monitor-transact-sql) system stored procedure.</span></span>

##  <a name="upgrading-log-shipping-configurations-with-a-single-secondary-server"></a><a name="UpgradeSingleSecondary"></a><span data-ttu-id="308ba-120">단일 보조 서버를 사용 하 여 로그 전달 구성 업그레이드</span><span class="sxs-lookup"><span data-stu-id="308ba-120">Upgrading Log Shipping Configurations with a Single Secondary Server</span></span>
 <span data-ttu-id="308ba-121">이 섹션에서 설명하는 업그레이드 프로세스는 구성이 주 서버와 하나의 보조 서버로 구성되었다고 가정합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-121">The upgrade process described in this section assumes a configuration consisting of the primary server and only one secondary server.</span></span> <span data-ttu-id="308ba-122">다음 그림에서는 주 서버 인스턴스 A와 단일 보조 서버 인스턴스 B로 구성된 이러한 구성을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-122">This configuration is represented in the following illustration, which shows a primary server instance, A, and a single secondary server instance, B.</span></span>

 <span data-ttu-id="308ba-123">![보조 서버 1대, 모니터 서버 없음](../media/ls-2-wayconfig-nomonitor.gif "보조 서버 1대, 모니터 서버 없음")</span><span class="sxs-lookup"><span data-stu-id="308ba-123">![One secondary server and no monitor server](../media/ls-2-wayconfig-nomonitor.gif "One secondary server and no monitor server")</span></span>

 <span data-ttu-id="308ba-124">여러 보조 서버를 업그레이드하는 방법은 이 항목의 뒷부분에 나오는 [여러 보조 서버 인스턴스 업그레이드](#MultipleSecondaries)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="308ba-124">For information about upgrading multiple secondary servers, see [Upgrading Multiple Secondary Server Instances](#MultipleSecondaries), later in this topic.</span></span>
 

###  <a name="upgrading-the-secondary-server-instance"></a><a name="UpgradeSecondary"></a><span data-ttu-id="308ba-125">보조 서버 인스턴스 업그레이드</span><span class="sxs-lookup"><span data-stu-id="308ba-125">Upgrading the Secondary Server Instance</span></span>
 <span data-ttu-id="308ba-126">업그레이드 프로세스에는 주 서버 인스턴스를 업그레이드하기 전에 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] 이상의 로그 전달 구성의 보조 서버 인스턴스를 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 로 업그레이드하는 과정이 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-126">The upgrade process involves upgrading the secondary server instances of a [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or higher log shipping configuration to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] before upgrading the primary server instance.</span></span> <span data-ttu-id="308ba-127">업그레이드할 때는 항상 보조 서버 인스턴스를 먼저 업그레이드해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-127">Always upgrade the secondary server instance first.</span></span> <span data-ttu-id="308ba-128">주 서버를 보조 서버보다 먼저 업그레이드하면 새 버전의 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] 에서 만든 백업을 이전 버전의 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]에서 복원할 수 없기 때문에 로그 전달이 실패합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-128">If the primary server were upgraded before a secondary server, log shipping would fail because a backup created on a newer version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] cannot be restored on an older version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>

 <span data-ttu-id="308ba-129">업그레이드된 보조 서버가 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] 이상의 주 서버에서 로그 백업을 계속 복원하기 때문에 전체 업그레이드 프로세스 동안 로그 전달은 계속됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-129">Log shipping continues throughout the upgrade process because the upgraded secondary servers continue to restore the log backups from the [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or higher primary server.</span></span> <span data-ttu-id="308ba-130">보조 서버 인스턴스를 업그레이드하는 프로세스는 부분적으로 로그 전달 구성이 여러 보조 서버를 처리하는지 여부의 영향을 받습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-130">The process for upgrading the secondary server instances depends partly on whether the log shipping configuration possesses multiple secondary servers.</span></span> <span data-ttu-id="308ba-131">자세한 내용은 이 항목의 뒷부분에 나오는 [여러 보조 서버 인스턴스 업그레이드](#MultipleSecondaries)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="308ba-131">For more information, see [Upgrading Multiple Secondary Server Instances](#MultipleSecondaries), later in this topic.</span></span>

 <span data-ttu-id="308ba-132">보조 서버 인스턴스가 업그레이드되는 동안에는 복원되지 않은 트랜잭션 로그 백업이 누적되도록 로그 전달 복사 및 복원 작업이 실행되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-132">While the secondary server instance is being upgraded, the log shipping copy and restore jobs do not run, so unrestored transaction log backups will accumulate.</span></span> <span data-ttu-id="308ba-133">누적되는 양은 주 서버의 예약된 백업 빈도에 따라 달라집니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-133">The amount of accumulation depends on the frequency of scheduled backup on the primary server.</span></span> <span data-ttu-id="308ba-134">또한 별도의 모니터 서버가 구성된 경우 지정된 간격보다 오랫동안 복원이 수행되지 않았음을 나타내는 경고가 발생할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-134">Also, if a separate monitor server has been configured, alerts might be raised indicating restores have not been performed for longer than the configured interval.</span></span>

 <span data-ttu-id="308ba-135">보조 서버가 업그레이드된 후에는 로그 전달 에이전트 작업이 다시 시작되어 주 서버 인스턴스인 서버 A의 로그 백업을 계속 복사하고 복원합니다. 보조 서버에서 보조 데이터베이스를 최신 상태로 만드는 데 필요한 시간은 보조 서버를 업그레이드하는 데 걸리는 시간과 주 서버에서 수행되는 백업 빈도에 따라 달라집니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-135">Once the secondary server has been upgraded, the log shipping agents jobs resume and continue to copy and restore log backups from the primary server instance, server A. The amount of time required for the secondary server to bring the secondary database up to date varies, depending on the time taken to upgrade the secondary server and the frequency of the backups on the primary server.</span></span>

> [!NOTE]
>  <span data-ttu-id="308ba-136">서버 업그레이드 도중 보조 데이터베이스는 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 데이터베이스로 업그레이드되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-136">During the server upgrade, the secondary database is not upgraded to a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] database.</span></span> <span data-ttu-id="308ba-137">보조 데이터베이스는 온라인 상태가 될 경우에만 업그레이드됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-137">It will get upgraded only if it is brought online.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="308ba-138">업그레이드가 필요한 데이터베이스에는 RESTORE WITH STANDBY 옵션이 지원되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-138">The RESTORE WITH STANDBY option is not supported for a database that requires upgrading.</span></span> <span data-ttu-id="308ba-139">RESTORE WITH STANDBY를 사용하여 업그레이드된 보조 데이터베이스를 구성한 경우에는 업그레이드 후에 트랜잭션 로그를 더 이상 복원할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-139">If an upgraded secondary database has been configured by using RESTORE WITH STANDBY, transaction logs can no longer be restored after upgrade.</span></span> <span data-ttu-id="308ba-140">해당 보조 데이터베이스에서 로그 전달을 재개하려면 해당 대기 서버에서 로그 전달을 다시 설정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-140">To resume log shipping on that secondary database, you will need to set up log shipping again on that standby server.</span></span> <span data-ttu-id="308ba-141">STANDBY 옵션에 대 한 자세한 내용은 [RESTORE Arguments &#40;transact-sql&#41;](/sql/t-sql/statements/restore-statements-arguments-transact-sql)를 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="308ba-141">For more information about the STANDBY option, see [RESTORE Arguments &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-arguments-transact-sql).</span></span>

###  <a name="upgrading-the-primary-server-instance"></a><a name="UpgradePrimary"></a> <span data-ttu-id="308ba-142">주 서버 인스턴스 업그레이드</span><span class="sxs-lookup"><span data-stu-id="308ba-142">Upgrading the Primary Server Instance</span></span>
 <span data-ttu-id="308ba-143">업그레이드를 계획할 때는 데이터베이스를 사용할 수 없는 시간을 고려하는 것이 중요합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-143">When planning an upgrade, a significant consideration is the amount of time that your database will be unavailable.</span></span> <span data-ttu-id="308ba-144">가장 간단한 업그레이드 시나리오를 사용할 경우 주 서버를 업그레이드하는 동안 데이터베이스가 사용할 수 없게 됩니다(시나리오 1).</span><span class="sxs-lookup"><span data-stu-id="308ba-144">The simplest upgrade scenario involves the database being unavailable while you upgrade the primary server (scenario 1, below).</span></span>

 <span data-ttu-id="308ba-145">업그레이드 프로세스가 복잡해지더라도 원래 주 서버를 업그레이드하기 전에 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] 이상의 주 서버를 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 보조 서버로 장애 조치(Failover)하여 데이터베이스 가용성을 최대화할 수 있습니다(아래의 시나리오 2).</span><span class="sxs-lookup"><span data-stu-id="308ba-145">At the cost of a more complicated upgrade process, you can maximize your database availability by failing over the [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or higher primary server to a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] secondary server before upgrading the original primary server (scenario 2, below).</span></span> <span data-ttu-id="308ba-146">장애 조치 시나리오에는 두 가지 변형이 있는데,</span><span class="sxs-lookup"><span data-stu-id="308ba-146">There are two variants of the failover scenario.</span></span> <span data-ttu-id="308ba-147">하나는 원래 주 서버로 다시 전환하고 원래 로그 전달 구성을 유지하는 것이고</span><span class="sxs-lookup"><span data-stu-id="308ba-147">You can switch back to the original primary server and keep the original log shipping configuration.</span></span> <span data-ttu-id="308ba-148">다른 하나는 원래 주 서버를 업그레이드하기 전에 원래 로그 전달 구성을 제거하고 나중에 새 주 서버를 사용하여 새 구성을 만드는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-148">Alternatively, you can remove the original log shipping configuration before upgrading the original primary server and later create a new configuration using the new primary server.</span></span> <span data-ttu-id="308ba-149">이 섹션에서는 이러한 시나리오에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-149">This section describes both these scenarios.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="308ba-150">주 서버 인스턴스를 업그레이드하기 전에 보조 서버 인스턴스를 업그레이드해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-150">Be sure to upgrade the secondary server instance before upgrading the primary server instance.</span></span> <span data-ttu-id="308ba-151">자세한 내용은 이 항목의 앞부분에 나오는 [보조 서버 인스턴스 업그레이드](#UpgradeSecondary)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="308ba-151">For more information, see [Upgrading the Secondary Server Instance](#UpgradeSecondary), earlier in this topic.</span></span>


####  <a name="scenario-1-upgrade-primary-server-instance-without-failover"></a><a name="Scenario1"></a><span data-ttu-id="308ba-152">시나리오 1: 장애 조치를 사용 하지 않고 주 서버 인스턴스 업그레이드</span><span class="sxs-lookup"><span data-stu-id="308ba-152">Scenario 1: Upgrade Primary Server Instance Without Failover</span></span>
 <span data-ttu-id="308ba-153">이 시나리오는 간단한 반면에 장애 조치를 사용할 때보다 작동 중단 시간이 깁니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-153">This is the simpler scenario, but it causes more downtime than using failover.</span></span> <span data-ttu-id="308ba-154">즉, 주 서버 인스턴스를 손쉽게 업그레이드할 수 있는 반면에 이 업그레이드 동안 데이터베이스를 사용할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-154">The primary server instance is simply upgraded and the database is unavailable during this upgrade.</span></span>

 <span data-ttu-id="308ba-155">서버가 업그레이드된 후에는 데이터베이스가 자동으로 업그레이드가 가능한 온라인 상태로 다시 설정됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-155">Once the server is upgraded, the database is automatically brought back online, which causes it to be upgraded.</span></span> <span data-ttu-id="308ba-156">데이터베이스가 업그레이드되면 로그 전달 작업이 다시 시작됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-156">After the database is upgraded, the log shipping jobs resume.</span></span>

#### <a name="scenario-2-upgrade-primary-server-instance-with-failover"></a><span data-ttu-id="308ba-157">시나리오 2: 장애 조치를 사용하여 주 서버 인스턴스 업그레이드</span><span class="sxs-lookup"><span data-stu-id="308ba-157">Scenario 2: Upgrade Primary Server Instance with Failover</span></span>
 <span data-ttu-id="308ba-158">이 시나리오는 가용성을 최대화하고 작동 중단 시간을 최소화합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-158">This scenario maximizes availability and minimizes downtime.</span></span> <span data-ttu-id="308ba-159">즉, 보조 서버 인스턴스로의 제어된 장애 조치가 사용되기 때문에 원래 주 서버 인스턴스가 업그레이드되는 동안 데이터베이스가 사용 가능한 상태로 유지됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-159">It utilizes a controlled failover to the secondary server instance, which keeps the database available while the original primary server instance is upgraded.</span></span> <span data-ttu-id="308ba-160">작동 중단 시간은 주 서버 인스턴스를 업그레이드하는 데 필요한 시간이 아니라 장애 조치하는 데 필요한 상대적으로 짧은 시간으로 제한됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-160">Downtime is limited to the relatively short time required to fail over, rather than the time required to upgrade the primary server instance.</span></span>

 <span data-ttu-id="308ba-161">장애 조치를 사용하여 주 서버 인스턴스를 업그레이드하는 프로세스에는 보조 서버로 제어된 장애 조치를 수행하고, 원래 주 서버 인스턴스를 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]로 업그레이드하고, [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] 주 서버 인스턴스에 로그 전달을 설정하는 세 가지 일반적인 절차가 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-161">Upgrading the primary server instance with failover involves three general procedures: performing a controlled failover to the secondary server, upgrading the original primary server instance to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], and setting up log shipping on a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] primary server instance.</span></span> <span data-ttu-id="308ba-162">이 섹션에서는 이러한 절차에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-162">These procedures are described in this section.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="308ba-163">보조 서버 인스턴스를 새 주 서버 인스턴스로 사용하려면 로그 전달 구성을 제거해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-163">If you plan to have the secondary server instance as the new primary server instance, you need to remove the log shipping configuration.</span></span> <span data-ttu-id="308ba-164">로그 전달은 원래 주 서버 인스턴스가 업그레이드된 후에 새 주 서버에서 새 보조 서버로 다시 구성해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-164">Log shipping will need to be reconfigured from the new primary to the new secondary, after the original primary server instance has been upgraded.</span></span> <span data-ttu-id="308ba-165">자세한 내용은 [로그 전달 &#40;제거 SQL Server&#41;](remove-log-shipping-sql-server.md)를 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="308ba-165">For more information, see [Remove Log Shipping &#40;SQL Server&#41;](remove-log-shipping-sql-server.md).</span></span>


#####  <a name="procedure-1-perform-a-controlled-failover-to-the-secondary-server"></a><a name="Procedure1"></a><span data-ttu-id="308ba-166">절차 1: 보조 서버로 제어 된 장애 조치 (Failover) 수행</span><span class="sxs-lookup"><span data-stu-id="308ba-166">Procedure 1: Perform a Controlled Failover to the Secondary Server</span></span>
 <span data-ttu-id="308ba-167">보조 서버로 제어된 장애 조치를 수행하려면 다음과 같이 하세요.</span><span class="sxs-lookup"><span data-stu-id="308ba-167">Controlled failover to the secondary server:</span></span>

1.  <span data-ttu-id="308ba-168">WITH NORECOVERY를 지정 하 여 주 데이터베이스에 대 한 트랜잭션 로그의 [비상 로그 백업을](../../relational-databases/backup-restore/tail-log-backups-sql-server.md) 수동으로 수행 합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-168">Manually perform a [tail-log backup](../../relational-databases/backup-restore/tail-log-backups-sql-server.md) of the transaction log on the primary database specifying WITH NORECOVERY.</span></span> <span data-ttu-id="308ba-169">이 로그 백업은 아직 백업되지 않은 모든 로그 레코드를 캡처하고 데이터베이스를 오프라인 상태로 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-169">This log backup captures any log records that have not been backed up yet and takes the database offline.</span></span> <span data-ttu-id="308ba-170">데이터베이스가 오프라인 상태일 때는 로그 전달 백업 작업이 실패합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-170">Note that while the database is offline, the log shipping backup job will fail.</span></span>

     <span data-ttu-id="308ba-171">다음 예에서는 주 서버에 있는 `AdventureWorks` 데이터베이스의 비상 로그 백업을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-171">The following example creates a tail log backup of the `AdventureWorks` database on the primary server.</span></span> <span data-ttu-id="308ba-172">백업 파일의 이름은 `Failover_AW_20080315.trn`입니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-172">The backup file is named `Failover_AW_20080315.trn`:</span></span>

    ```
    BACKUP LOG AdventureWorks 
      TO DISK = N'\\FileServer\LogShipping\AdventureWorks\Failover_AW_20080315.trn' 
       WITH NORECOVERY;
    GO
    ```

     <span data-ttu-id="308ba-173">고유한 파일 명명 규칙을 사용하여 수동으로 만든 백업 파일과 로그 전달 백업 작업을 통해 만들어진 백업 파일을 구분하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-173">We recommend that you use a distinct file naming convention to differentiate the manually-created backup file from the backup files created by the log shipping backup job.</span></span>

2.  <span data-ttu-id="308ba-174">보조 서버에서 다음을 수행합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-174">On the secondary server:</span></span>

    1.  <span data-ttu-id="308ba-175">로그 전달 백업 작업을 통해 자동으로 수행된 모든 백업이 적용되었는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-175">Ensure that all backups taken automatically by the log shipping backup jobs have been applied.</span></span> <span data-ttu-id="308ba-176">적용 된 백업 작업을 확인 하려면 모니터 서버 또는 주 서버와 보조 서버에서 [sp_help_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-transact-sql) 시스템 저장 프로시저를 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-176">To check which backup jobs have been applied, use the [sp_help_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-transact-sql) system stored procedure on the monitor server or on the primary and secondary servers.</span></span> <span data-ttu-id="308ba-177">동일한 파일이 **last_backup_file**, **last_copied_file**및 **last_restored_file** 열에 나열 되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-177">The same file should be listed in the **last_backup_file**, **last_copied_file**, and **last_restored_file** columns.</span></span> <span data-ttu-id="308ba-178">백업 파일 중 하나라도 복사되지 않거나 복원되지 않은 경우 수동으로 로그 전달 구성에 대한 에이전트 복사 및 복원 작업을 호출합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-178">If any of the backup files have not been copied and restored, manually invoke the agent copy and restore jobs for the log shipping configuration.</span></span>

         <span data-ttu-id="308ba-179">작업을 시작하는 방법은 [Start a Job](../../ssms/agent/start-a-job.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="308ba-179">For information about starting a job, see [Start a Job](../../ssms/agent/start-a-job.md).</span></span>

    2.  <span data-ttu-id="308ba-180">1단계에서 만든 최종 로그 백업 파일을 파일 공유에서 보조 서버의 로그 전달에 사용되는 로컬 위치로 복사합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-180">Copy your the final log backup file that you created in step 1 from the file share to the local location that is used by log shipping on the secondary server.</span></span>

    3.  <span data-ttu-id="308ba-181">데이터베이스를 온라인 상태로 만드는 WITH RECOVERY를 지정하여 최종 로그 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-181">Restore the final log backup specifying WITH RECOVERY to bring the database online.</span></span> <span data-ttu-id="308ba-182">온라인 상태로 만드는 과정에서 데이터베이스는 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]로 업그레이드됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-182">As part of being brought online, the database will upgraded to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>

         <span data-ttu-id="308ba-183">다음 예에서는 보조 서버에 있는 `AdventureWorks` 데이터베이스의 비상 로그 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-183">The following example restores the tail log backup of the `AdventureWorks` database on the secondary database.</span></span> <span data-ttu-id="308ba-184">이 예에서는 데이터베이스를 온라인 상태로 만드는 WITH RECOVERY 옵션을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-184">The example uses the WITH RECOVERY option, which brings the database online:</span></span>

        ```
        RESTORE LOG AdventureWorks 
          FROM DISK = N'c:\logshipping\Failover_AW_20080315.trn' 
           WITH RECOVERY;
        GO
        ```

        > [!NOTE]
        >  <span data-ttu-id="308ba-185">둘 이상의 보조 서버가 있는 구성의 경우 추가로 고려해야 할 사항이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-185">For a configuration that contains more than one secondary server, there are additional considerations.</span></span> <span data-ttu-id="308ba-186">자세한 내용은 이 항목의 뒷부분에 나오는 [여러 보조 서버 인스턴스 업그레이드](#MultipleSecondaries)를 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="308ba-186">For more information, see [Upgrading Multiple Secondary Server Instances](#MultipleSecondaries), later in this topic.</span></span>

    4.  <span data-ttu-id="308ba-187">클라이언트를 원래 주 서버(서버 A)에서 온라인 보조 서버(서버 B)로 리디렉션하여 데이터베이스를 장애 조치합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-187">Fail over the database by redirecting clients from the original primary server (server A) to the online secondary server (server B).</span></span>

    5.  <span data-ttu-id="308ba-188">데이터베이스가 온라인 상태일 때 보조 데이터베이스의 트랜잭션 로그가 채워지지 않도록 주의합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-188">Take care that the transaction log of the secondary database does not fill while the database is online.</span></span> <span data-ttu-id="308ba-189">트랜잭션 로그가 채워지지 않도록 하려면 트랜잭션 로그를 백업해야 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-189">To prevent the transaction log from filling, you might need to back it up.</span></span> <span data-ttu-id="308ba-190">이 경우 다른 서버 인스턴스에서 복원할 수 있도록 공유 위치인 *백업 공유*에 백업하는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-190">If so, we recommend that you back it up to a shared location, a *backup share*, to make the backups available for restoring on the other server instance.</span></span>

#####  <a name="procedure-2-upgrade-the-original-primary-server-instance-to-sscurrent"></a><a name="Procedure2"></a><span data-ttu-id="308ba-191">절차 2: 원래 주 서버 인스턴스를로 업그레이드[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span><span class="sxs-lookup"><span data-stu-id="308ba-191">Procedure 2: Upgrade the Original Primary Server Instance to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span></span>
 <span data-ttu-id="308ba-192">원래 주 서버 인스턴스를 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]로 업그레이드한 후에도 데이터베이스는 계속 오프라인 상태로 동일한 형식을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-192">After you upgrade the original primary server instance to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], the database will still be offline and in the format.</span></span>

#####  <a name="procedure-3-set-up-log-shipping-on-sscurrent"></a><a name="Procedure3"></a><span data-ttu-id="308ba-193">절차 3:에서 로그 전달 설정[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span><span class="sxs-lookup"><span data-stu-id="308ba-193">Procedure 3: Set Up Log Shipping on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span></span>
 <span data-ttu-id="308ba-194">업그레이드 프로세스의 나머지 부분은 다음과 같이 로그 전달이 계속 구성되어 있는지 여부에 따라 달라집니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-194">The rest of the upgrade process depends on whether log shipping is still configured, as follows:</span></span>

-   <span data-ttu-id="308ba-195">[!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]이상의 로그 전달 구성을 유지한 경우 원래 주 서버 인스턴스로 다시 전환합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-195">If you have kept the [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]or higher log shipping configuration, switch back to the original primary server instance.</span></span> <span data-ttu-id="308ba-196">자세한 내용은 이 섹션의 뒷부분에 나오는 [원래 주 서버 인스턴스로 다시 전환하려면](#SwitchToOrigPrimary)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="308ba-196">For more information, see [To Switch Back to the Original Primary Server Instance](#SwitchToOrigPrimary), later in this section.</span></span>

-   <span data-ttu-id="308ba-197">장애 조치를 수행하기 전에 로그 전달 구성을 제거한 경우 원래 보조 서버 인스턴스가 새 주 서버 인스턴스가 되는 새 로그 전달 구성을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-197">If you removed the log shipping configuration before failing over, create a new log shipping configuration in which the original secondary server instance is the new primary server instance.</span></span> <span data-ttu-id="308ba-198">자세한 내용은 이 섹션의 뒷부분에 나오는 [이전 보조 서버 인스턴스를 새 주 서버 인스턴스로 사용하려면](#KeepOldSecondaryAsNewPrimary)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="308ba-198">For more information, see [To Keep the Old Secondary Server Instance As the New Primary Server Instance](#KeepOldSecondaryAsNewPrimary), later in this section.</span></span>

######  <a name="to-switch-back-to-the-original-primary-server-instance"></a><a name="SwitchToOrigPrimary"></a><span data-ttu-id="308ba-199">원래 주 서버 인스턴스로 다시 전환 하려면</span><span class="sxs-lookup"><span data-stu-id="308ba-199">To Switch Back to the Original Primary Server Instance</span></span>

1.  <span data-ttu-id="308ba-200">임시 주 서버(서버 B)에서 WITH NORECOVERY를 사용하여 비상 로그를 백업하여 비상 로그 백업을 만들고 데이터베이스를 오프라인 상태로 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-200">On the interim primary server (server B), back up the tail of the log using WITH NORECOVERY to create a tail-log backup and take the database offline.</span></span> <span data-ttu-id="308ba-201">비상 로그 백업의 이름은 `Switchback_AW_20080315.trn`입니다. 예를 들면 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-201">The tail log backup is named `Switchback_AW_20080315.trn`.For example:</span></span>

    ```
    BACKUP LOG AdventureWorks 
      TO DISK = N'\\FileServer\LogShipping\AdventureWorks\Switchback_AW_20080315.trn' 
       WITH NORECOVERY;
    GO
    ```

2.  <span data-ttu-id="308ba-202">임시 주 데이터베이스에서 1단계에서 만든 비상 백업이 아니라 트랜잭션 로그 백업이 수행된 경우 WITH NORECOVERY를 사용하여 이러한 로그 백업을 원래 주 서버(서버 A)의 오프라인 데이터베이스로 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-202">If any transaction log backups were taken on the interim primary database, other than the tail backup that you created in step 1, restore those log backups using WITH NORECOVERY to the offline database on the original primary server (server A).</span></span> <span data-ttu-id="308ba-203">데이터베이스는 첫 번째 로그 백업이 복원될 때 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]로 업그레이드됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-203">The database is upgraded to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] format when the first log backup is restored.</span></span>

3.  <span data-ttu-id="308ba-204">데이터베이스를 온라인 상태로 전환하는 WITH RECOVERY를 사용하여 원래 주 데이터베이스(서버 A)의 비상 로그 백업 `Switchback_AW_20080315.trn`을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-204">Restore the tail-log backup, `Switchback_AW_20080315.trn`, on the original primary database (on server A) using WITH RECOVERY to bring the database online.</span></span>

4.  <span data-ttu-id="308ba-205">클라이언트를 원래 주 서버에서 온라인 보조 서버로 리디렉션하여 원래 주 데이터베이스(서버 A)로 다시 장애 조치합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-205">Fail over back to the original primary database (on server A) by redirecting clients to the online secondary server from the original primary server.</span></span>

 <span data-ttu-id="308ba-206">데이터베이스가 온라인 상태가 되면 원래 로그 전달 구성이 다시 시작됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-206">After the database comes online, the original log shipping configuration will resume.</span></span>

######  <a name="to-keep-the-old-secondary-server-instance-as-the-new-primary-server-instance"></a><a name="KeepOldSecondaryAsNewPrimary"></a><span data-ttu-id="308ba-207">이전 보조 서버 인스턴스를 새 주 서버 인스턴스로 유지 하려면</span><span class="sxs-lookup"><span data-stu-id="308ba-207">To Keep the Old Secondary Server Instance As the New Primary Server Instance</span></span>
 <span data-ttu-id="308ba-208">다음과 같이 이전 보조 서버 인스턴스 B를 주 서버로 사용하고 이전 주 서버 인스턴스 A를 새 보조 서버로 사용하는 새 로그 전달 구성을 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-208">Establish a new log shipping configuration using the old secondary server instance, B, as the primary server and the old primary server instance, A, as the new secondary server, as follows:</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="308ba-209">데이터베이스를 오프라인 상태로 만드는 수동 트랜잭션 로그 백업을 수행하기 전에 원래 주 서버에서 이전 로그 전달 구성을 제거해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-209">The old log shipping configuration should have been removed from the original primary server at the start of the process before taking the manual transaction log backup that took the database offline.</span></span>

1.  <span data-ttu-id="308ba-210">새 보조 서버(서버 A)에서 데이터베이스의 전체 백업 및 복원이 수행되는 것을 방지하려면 새 주 데이터베이스의 로그 백업을 새 보조 데이터베이스에 적용합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-210">To avoid performing a complete backup and restore of the database on the new secondary server (server A), apply the log backups from the new primary database to the new secondary database.</span></span> <span data-ttu-id="308ba-211">위의 구성 예에서는 이 과정에 서버 B에서 수행된 로그 백업을 서버 A의 데이터베이스로 복원하는 작업이 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-211">In the example configuration, this involves restoring the log backups taken on server B to the database on server A.</span></span>

2.  <span data-ttu-id="308ba-212">새 주 데이터베이스(서버 B)의 로그를 백업합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-212">Back up the log from the new primary database (on server B).</span></span>

3.  <span data-ttu-id="308ba-213">WITH NORECOVERY를 사용하여 새 보조 서버 인스턴스(서버 A)에 로그 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-213">Restore the log backups to the new secondary server instance (server A) using WITH NORECOVERY.</span></span> <span data-ttu-id="308ba-214">데이터베이스는 첫 번째 복원 작업이 수행될 때 [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]로 업데이트됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-214">The first restore operation updates the database to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>

4.  <span data-ttu-id="308ba-215">이전 보조 서버(서버 B)가 주 서버 인스턴스로 사용되는 로그 전달을 구성합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-215">Configure log shipping with the former secondary server (server B) as the primary server instance.</span></span>

    > [!IMPORTANT]
    >  <span data-ttu-id="308ba-216">[!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]를 사용하는 경우 보조 데이터베이스가 이미 초기화되어 있다고 지정하세요.</span><span class="sxs-lookup"><span data-stu-id="308ba-216">If you use [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], specify that the secondary database is already initialized.</span></span>

     <span data-ttu-id="308ba-217">자세한 내용은 [로그 전달 구성&#40;SQL Server&#41;](configure-log-shipping-sql-server.md)에서 도입되었습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-217">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>

5.  <span data-ttu-id="308ba-218">클라이언트를 원래 주 서버(서버 A)에서 온라인 보조 서버(서버 B)로 리디렉션하여 데이터베이스를 장애 조치합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-218">Fail over the database by redirecting clients from the original primary server (server A) to the online secondary server (server B).</span></span>

    > [!IMPORTANT]
    >  <span data-ttu-id="308ba-219">새 주 데이터베이스로 장애 조치할 때는 해당 메타데이터가 원래 주 데이터베이스의 메타데이터와 일치하는지 확인해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-219">When you failover to a new primary database, you should ensure that its metadata is consistent with the metadata of the original primary database.</span></span> <span data-ttu-id="308ba-220">자세한 내용은 [다른 서버 인스턴스에서 데이터베이스를 사용할 수 있도록 할 때 메타데이터 관리&#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md)을 참조하세요.</span><span class="sxs-lookup"><span data-stu-id="308ba-220">For more information, see [Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).</span></span>

##  <a name="upgrading-multiple-secondary-server-instances"></a><a name="MultipleSecondaries"></a><span data-ttu-id="308ba-221">여러 보조 서버 인스턴스 업그레이드</span><span class="sxs-lookup"><span data-stu-id="308ba-221">Upgrading Multiple Secondary Server Instances</span></span>
 <span data-ttu-id="308ba-222">다음 그림에서는 주 서버 인스턴스 A와 두 개의 보조 서버 인스턴스 B와 C로 구성된 이러한 구성을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-222">This configuration is represented in the following illustration, which shows a primary server instance, A, and two secondary server instances, B and C.</span></span>

 <span data-ttu-id="308ba-223">![보조 서버 2대, 모니터 서버 없음](../media/ls-3-wayconfig-nomonitor.gif "보조 서버 2대, 모니터 서버 없음")</span><span class="sxs-lookup"><span data-stu-id="308ba-223">![Two secondary servers and no monitor server](../media/ls-3-wayconfig-nomonitor.gif "Two secondary servers and no monitor server")</span></span>

 <span data-ttu-id="308ba-224">이 섹션에서는 장애 조치(failover)를 사용한 다음 원래 주 서버로 다시 전환하여 업그레이드하는 방법에 대해 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-224">This section discusses how to upgrade using a failover and then switching back to the original primary server.</span></span> <span data-ttu-id="308ba-225">보조 서버 인스턴스가 여러 개 있으면 장애 조치를 사용하여 주 인스턴스를 업그레이드하는 프로세스가 훨씬 더 복잡해집니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-225">When upgrading the primary instance with failover the process is more complex when there are multiple secondary server instances.</span></span> <span data-ttu-id="308ba-226">다음 절차에서는 보조 서버가 모두 업그레이드된 후에 주 서버가 업그레이드된 보조 데이터베이스 중 하나로 장애 조치됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-226">In the following procedure, after all the secondary servers are upgraded, the primary server is failed over to one of the upgraded secondary databases.</span></span> <span data-ttu-id="308ba-227">원래 주 서버가 업그레이드되면 로그 전달은 다시 원래 주 서버로 장애 조치됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-227">The original primary server is upgraded, and log shipping is failed over back to it.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="308ba-228">항상 주 서버를 업그레이드하기 전에 모든 보조 서버 인스턴스를 업그레이드하세요.</span><span class="sxs-lookup"><span data-stu-id="308ba-228">Always upgrade all the secondary server instances before you upgrade the primary server.</span></span>

 <span data-ttu-id="308ba-229">**장애 조치를 사용한 다음 원래 주 서버로 다시 전환하여 업그레이드하려면**</span><span class="sxs-lookup"><span data-stu-id="308ba-229">**To upgrade using a failover and then switching back to original primary server**</span></span>

1.  <span data-ttu-id="308ba-230">모든 보조 서버 인스턴스(서버 B 및 서버 C)를 업그레이드합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-230">Upgrade all the secondary server instances (server B and server C).</span></span>

2.  <span data-ttu-id="308ba-231">주 데이터베이스(서버 A)의 트랜잭션 비상 로그를 가져오고 데이터베이스를 오프라인 상태로 만든 다음 WITH NORECOVERY를 사용하여 트랜잭션 로그를 백업합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-231">Obtain the tail of the transaction log of the primary database (on server A), and take the database offline, by backing up the transaction log using WITH NORECOVERY.</span></span>

3.  <span data-ttu-id="308ba-232">장애 조치하려는 보조 서버(서버 B)에서 보조 데이터베이스를 온라인 상태로 만들고 WITH RECOVERY를 사용하여 로그 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-232">On the secondary server to which you plan to fail over (server B), bring the secondary database online, by restoring the log backup using WITH RECOVERY.</span></span>

4.  <span data-ttu-id="308ba-233">다른 한 보조 서버(서버 C)에서 보조 데이터베이스를 오프라인 상태로 그대로 두고 WITH RECOVERY를 사용하여 로그 백업을 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-233">On every other secondary server (server C), leave the secondary database offline by restoring the log backup using WITH NORECOVERY.</span></span>

    > [!NOTE]
    >  <span data-ttu-id="308ba-234">보조 서버에서 로그 전달 복사 및 복원 작업이 실행되지만 백업 공유에 새 로그 백업 파일이 저장되지 않기 때문에 이러한 작업이 실행되어도 아무런 효과가 없습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-234">The log shipping copy and restore jobs will run on the secondary servers, but the jobs will do nothing because new log-backup files will not be placed on the backup share.</span></span>

5.  <span data-ttu-id="308ba-235">클라이언트를 원래 주 서버(서버 A)에서 온라인 보조 서버(서버 B)로 리디렉션하여 데이터베이스를 장애 조치합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-235">Fail over the database by redirecting clients from the original primary server (server A) to the online secondary server (server B).</span></span> <span data-ttu-id="308ba-236">그러면 온라인 데이터베이스가 임시 주 서버가 되어 원래 주 서버(서버 A)가 오프라인 상태일 때 계속 사용 가능한 상태로 유지됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-236">The online database becomes an interim primary server, keeping the database available while the original primary server is offline (server A).</span></span>

6.  <span data-ttu-id="308ba-237">원래 주 서버(서버 A)를 업그레이드합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-237">Upgrade the original primary server (server A).</span></span>

7.  <span data-ttu-id="308ba-238">장애 조치 (failover) 한 데이터베이스-중간 주 데이터베이스 (서버 B)에서 WITH NORECOVERY를 사용 하 여 트랜잭션 로그를 수동으로 백업 합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-238">On the database to which you failed over-the interim primary database (on server B), manually back up the transaction log using WITH NORECOVERY.</span></span> <span data-ttu-id="308ba-239">그러면 데이터베이스가 오프라인 상태가 됩니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-239">This takes the database offline.</span></span>

8.  <span data-ttu-id="308ba-240">임시 주 데이터베이스(서버 B)에서 만든 모든 트랜잭션 로그 백업을 WITH NORECOVERY를 사용하여 다른 보조 데이터베이스(서버 C)로 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-240">Restore all transaction log backups that you created on the interim primary database (on server B) to every other secondary database (on server C) using WITH NORECOVERY.</span></span> <span data-ttu-id="308ba-241">이렇게 하면 각 보조 데이터베이스에서 전체 데이터베이스 복원을 수행하지 않고도 업그레이드 후에 원래 주 데이터베이스에서 로그 전달을 계속할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-241">This allows log shipping to continue from the original primary database after its upgrade, without requiring a full database restore on each secondary database.</span></span>

9. <span data-ttu-id="308ba-242">WITH RECOVERY를 사용하여 임시 주 서버(서버 B)에서 원래 주 데이터베이스(서버 A)로 트랜잭션 로그를 복원합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-242">Restore the transaction log from the interim primary server (server B) to the original primary database (on server A) using WITH RECOVERY.</span></span>

##  <a name="redeploying-log-shipping"></a><a name="Redeploying"></a><span data-ttu-id="308ba-243">로그 전달 다시 배포</span><span class="sxs-lookup"><span data-stu-id="308ba-243">Redeploying Log Shipping</span></span>
 <span data-ttu-id="308ba-244">위의 절차 중 하나를 사용하여 로그 전달 구성을 마이그레이션하지 않으려는 경우 주 데이터베이스의 전체 백업 및 복원으로 보조 데이터베이스를 다시 초기화하여 로그 전달을 처음부터 다시 배포할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-244">If you do not want to migrate your log shipping configuration using one of the procedures shown above, you can redeploy log shipping from scratch by reinitializing your secondary database with a full backup and restore of the primary database.</span></span> <span data-ttu-id="308ba-245">데이터베이스 크기가 작거나 업그레이드 절차를 수행하는 동안 고가용성이 필요 없는 경우 알맞은 방법입니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-245">This may be a desirable option if you have a small database or if high availability is not crucial during the upgrade procedure.</span></span>

 <span data-ttu-id="308ba-246">로그 전달을 설정 하는 방법에 대 한 자세한 내용은 [로그 전달 &#40;구성 SQL Server&#41;](configure-log-shipping-sql-server.md)을 참조 하십시오.</span><span class="sxs-lookup"><span data-stu-id="308ba-246">For information about enabling log shipping, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="308ba-247">참고 항목</span><span class="sxs-lookup"><span data-stu-id="308ba-247">See Also</span></span>
 <span data-ttu-id="308ba-248">[트랜잭션 로그 백업은](../../relational-databases/backup-restore/transaction-log-backups-sql-server.md) [트랜잭션 로그 백업 &#40;SQL Server](../../relational-databases/backup-restore/apply-transaction-log-backups-sql-server.md)&#41;[로그 전달 테이블 및 저장 프로시저](log-shipping-tables-and-stored-procedures.md)&#41;적용 SQL Server &#40;합니다.</span><span class="sxs-lookup"><span data-stu-id="308ba-248">[Transaction Log Backups &#40;SQL Server&#41;](../../relational-databases/backup-restore/transaction-log-backups-sql-server.md) [Apply Transaction Log Backups &#40;SQL Server&#41;](../../relational-databases/backup-restore/apply-transaction-log-backups-sql-server.md) [Log Shipping Tables and Stored Procedures](log-shipping-tables-and-stored-procedures.md)</span></span>
