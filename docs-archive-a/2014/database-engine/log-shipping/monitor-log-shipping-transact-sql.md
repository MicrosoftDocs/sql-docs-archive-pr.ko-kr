---
title: 로그 전달 모니터링(Transact-SQL) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- log shipping [SQL Server], status
- history tables [SQL Server]
- historical information [SQL Server], log shipping
- log shipping [SQL Server], monitoring
- alerts [SQL Server], log shipping
- status information [SQL Server], log shipping
- monitoring log shipping [SQL Server]
ms.assetid: acf3cd99-55f7-4287-8414-0892f830f423
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 0ab87d5d8aa08b7b2860fe52fd097f33af327a94
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87648531"
---
# <a name="monitor-log-shipping-transact-sql"></a><span data-ttu-id="142d7-102">로그 전달 모니터링(Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="142d7-102">Monitor Log Shipping (Transact-SQL)</span></span>
  <span data-ttu-id="142d7-103">로그 전달을 구성한 후 모든 로그 전달 서버의 상태에 대한 정보를 모니터링할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-103">After you have configured log shipping, you can monitor information about the status of all the log shipping servers.</span></span> <span data-ttu-id="142d7-104">로그 전달 작업의 기록과 상태는 항상 로그 전달 작업에 의해 로컬에 저장됩니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-104">The history and status of log shipping operations are always saved locally by the log shipping jobs.</span></span> <span data-ttu-id="142d7-105">백업 작업의 기록과 상태는 주 서버에 저장되고 복사 및 복원 작업의 기록과 상태는 보조 서버에 저장됩니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-105">The history and status of the backup operation are stored at the primary server, and the history and status of the copy and restore operations are stored at the secondary server.</span></span> <span data-ttu-id="142d7-106">원격 모니터 서버를 구현한 경우 이 정보는 모니터 서버에도 저장됩니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-106">If you have implemented a remote monitor server, this information is also stored on the monitor server.</span></span>  
  
 <span data-ttu-id="142d7-107">로그 전달 작업이 예약된 대로 수행되지 않으면 경고가 발생하도록 구성할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-107">You can configure alerts that will fire if log shipping operations fail to occur as scheduled.</span></span> <span data-ttu-id="142d7-108">오류는 백업 및 복원 작업 상태를 감시하는 경고 작업에 의해 발생합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-108">Errors are raised by an alert job that watches the status of the backup and restore operations.</span></span> <span data-ttu-id="142d7-109">이러한 오류가 발생할 때 운영자에게 알리는 경고를 정의할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-109">You can define alerts that notify an operator when these errors are raised.</span></span> <span data-ttu-id="142d7-110">모니터 서버가 구성되어 있는 경우 모니터 서버에서 로그 전달 구성의 모든 작업에 대해 오류를 발생시키는 하나의 경고 작업이 실행됩니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-110">If a monitor server is configured, one alert job runs on the monitor server that raises errors for all operations in the log shipping configuration.</span></span> <span data-ttu-id="142d7-111">모니터 서버가 지정되지 않은 경우 경고 작업은 주 서버 인스턴스에서 실행되어 백업 작업을 모니터링합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-111">If a monitor server is not specified, an alert job runs on the primary server instance, which monitors the backup operation.</span></span> <span data-ttu-id="142d7-112">모니터 서버가 지정되어 있지 않으면 각 보조 서버 인스턴스에서도 경고 작업이 실행되어 로컬 복사 및 복원 작업을 모니터링합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-112">If a monitor server is not specified, an alert job also runs on each secondary server instance to monitor the local copy and restore operations.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="142d7-113">로그 전달 구성을 모니터링하려면 로그 전달을 설정할 때 모니터 서버를 추가해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-113">To monitor a log shipping configuration, you must add the monitor server when you enable log shipping.</span></span> <span data-ttu-id="142d7-114">나중에 모니터 서버를 추가하는 경우 로그 전달 구성을 제거한 다음 모니터 서버가 포함된 새 구성으로 바꾸어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-114">If you add a monitor server later, you must remove the log shipping configuration and then replace it with a new configuration that includes a monitor server.</span></span> <span data-ttu-id="142d7-115">자세한 내용은 [로그 전달 구성&#40;SQL Server&#41;](configure-log-shipping-sql-server.md)에서 도입되었습니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-115">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span> <span data-ttu-id="142d7-116">또한 모니터 서버를 구성한 후에는 로그 전달을 먼저 제거하지 않으면 모니터 서버를 변경할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-116">Furthermore, after the monitor server has been configured, it cannot be changed without removing log shipping first.</span></span>  
  
## <a name="history-tables-containing-monitoring-information"></a><span data-ttu-id="142d7-117">모니터링 정보가 들어 있는 기록 테이블</span><span class="sxs-lookup"><span data-stu-id="142d7-117">History Tables Containing Monitoring Information</span></span>  
 <span data-ttu-id="142d7-118">모니터링 기록 테이블에는 모니터 서버에 저장된 메타데이터가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-118">The monitoring history tables contain metadata that is stored on the monitor server.</span></span> <span data-ttu-id="142d7-119">지정된 주 서버 또는 보조 서버에 대한 정보의 복사본도 로컬에 저장됩니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-119">A copy of information specific to a given primary or secondary server is also stored locally.</span></span>  
  
 <span data-ttu-id="142d7-120">이러한 테이블을 쿼리하여 로그 전달 세션의 상태를 모니터링할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-120">You can query these tables to monitor the status of a log shipping session.</span></span> <span data-ttu-id="142d7-121">예를 들어 로그 전달 상태를 알려면 백업 작업, 복사 작업 및 복원 작업의 상태와 기록을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-121">For example, to learn status of log shipping, check the status and history of the backup job, copy job, and restore job.</span></span> <span data-ttu-id="142d7-122">다음의 모니터링 테이블을 쿼리하여 특정 로그 전달 기록 및 오류 정보를 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-122">You can view specific log shipping history and error details by querying the following monitoring tables.</span></span>  
  
|<span data-ttu-id="142d7-123">테이블</span><span class="sxs-lookup"><span data-stu-id="142d7-123">Table</span></span>|<span data-ttu-id="142d7-124">Description</span><span class="sxs-lookup"><span data-stu-id="142d7-124">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="142d7-125">log_shipping_monitor_alert</span><span class="sxs-lookup"><span data-stu-id="142d7-125">log_shipping_monitor_alert</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-alert-transact-sql)|<span data-ttu-id="142d7-126">경고 작업 ID를 저장합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-126">Stores alert job ID.</span></span>|  
|[<span data-ttu-id="142d7-127">log_shipping_monitor_error_detail</span><span class="sxs-lookup"><span data-stu-id="142d7-127">log_shipping_monitor_error_detail</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-error-detail-transact-sql)|<span data-ttu-id="142d7-128">로그 전달 작업에 대한 오류 정보를 저장합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-128">Stores error details for log shipping jobs.</span></span> <span data-ttu-id="142d7-129">이 테이블을 쿼리하여 에이전트 세션에 대한 오류를 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-129">You can query this table see the errors for an agent session.</span></span> <span data-ttu-id="142d7-130">필요에 따라 각 오류가 로그된 날짜 및 시간별로 오류를 정렬할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-130">Optionally, you can sort the errors by the date and time at which each was logged.</span></span> <span data-ttu-id="142d7-131">각 오류는 예외순으로 로그되고 에이전트 세션당 여러 개의 오류(시퀀스)가 로그될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-131">Each error is logged as a sequence of exceptions, and multiple errors (sequences) can per agent session.</span></span>|  
|[<span data-ttu-id="142d7-132">log_shipping_monitor_history_detail</span><span class="sxs-lookup"><span data-stu-id="142d7-132">log_shipping_monitor_history_detail</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-history-detail-transact-sql)|<span data-ttu-id="142d7-133">로그 전달 에이전트에 대한 기록 세부 정보가 들어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-133">Contains history details for log shipping agents.</span></span> <span data-ttu-id="142d7-134">이 테이블을 쿼리하여 에이전트 세션에 대한 기록 세부 정보를 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-134">You can query this table to see the history detail for an agent session.</span></span>|  
|[<span data-ttu-id="142d7-135">log_shipping_monitor_primary</span><span class="sxs-lookup"><span data-stu-id="142d7-135">log_shipping_monitor_primary</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-primary-transact-sql)|<span data-ttu-id="142d7-136">모니터링에 유용한 마지막 복원 파일과 마지막 백업 파일에 대한 정보를 포함하여 각 로그 전달 구성에 주 데이터베이스에 대한 하나의 모니터 레코드를 저장합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-136">Stores one monitor record for the primary database in each log shipping configuration, including information about the last backup file and last restored file that is useful for monitoring.</span></span>|  
|[<span data-ttu-id="142d7-137">log_shipping_monitor_secondary</span><span class="sxs-lookup"><span data-stu-id="142d7-137">log_shipping_monitor_secondary</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-secondary-transact-sql)|<span data-ttu-id="142d7-138">모니터링에 유용한 마지막 복원 파일과 마지막 백업 파일에 대한 정보를 포함하여 각 보조 데이터베이스에 대한 하나의 모니터 레코드를 저장합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-138">Stores one monitor record for each secondary database, including information about the last backup file and last restored file that is useful for monitoring.</span></span>|  
  
## <a name="stored-procedures-for-monitoring-log-shipping"></a><span data-ttu-id="142d7-139">로그 전달 모니터링을 위한 저장 프로시저</span><span class="sxs-lookup"><span data-stu-id="142d7-139">Stored Procedures for Monitoring Log Shipping</span></span>  
 <span data-ttu-id="142d7-140">로그 전달 저장 프로시저를 사용하여 액세스할 수 있는 **msdb**의 테이블에 모니터링 및 기록 정보가 저장됩니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-140">Monitoring and history information is stored in tables in **msdb**, which can be accessed using log shipping stored procedures.</span></span> <span data-ttu-id="142d7-141">다음 표에 표시된 서버에서 이러한 저장 프로시저를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-141">Run these stored procedures on the servers indicated in the following table.</span></span>  
  
|<span data-ttu-id="142d7-142">저장 프로시저</span><span class="sxs-lookup"><span data-stu-id="142d7-142">Stored procedure</span></span>|<span data-ttu-id="142d7-143">Description</span><span class="sxs-lookup"><span data-stu-id="142d7-143">Description</span></span>|<span data-ttu-id="142d7-144">프로시저 실행 위치</span><span class="sxs-lookup"><span data-stu-id="142d7-144">Run this procedure on</span></span>|  
|----------------------|-----------------|---------------------------|  
|[<span data-ttu-id="142d7-145">sp_help_log_shipping_monitor_primary</span><span class="sxs-lookup"><span data-stu-id="142d7-145">sp_help_log_shipping_monitor_primary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-primary-transact-sql)|<span data-ttu-id="142d7-146">**log_shipping_monitor_primary** 테이블에서 지정한 주 데이터베이스에 대한 모니터 레코드를 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-146">Returns monitor records for the specified primary database from the **log_shipping_monitor_primary** table.</span></span>|<span data-ttu-id="142d7-147">모니터 서버 또는 주 서버</span><span class="sxs-lookup"><span data-stu-id="142d7-147">Monitor server or primary server</span></span>|  
|[<span data-ttu-id="142d7-148">sp_help_log_shipping_monitor_secondary</span><span class="sxs-lookup"><span data-stu-id="142d7-148">sp_help_log_shipping_monitor_secondary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-secondary-transact-sql)|<span data-ttu-id="142d7-149">**log_shipping_monitor_secondary** 테이블에서 지정한 보조 데이터베이스에 대한 모니터 레코드를 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-149">Returns monitor records for the specified secondary database from the **log_shipping_monitor_secondary** table.</span></span>|<span data-ttu-id="142d7-150">모니터 서버 또는 보조 서버</span><span class="sxs-lookup"><span data-stu-id="142d7-150">Monitor server or secondary server</span></span>|  
|[<span data-ttu-id="142d7-151">sp_help_log_shipping_alert_job</span><span class="sxs-lookup"><span data-stu-id="142d7-151">sp_help_log_shipping_alert_job</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-alert-job-transact-sql)|<span data-ttu-id="142d7-152">경고 작업의 작업 ID를 반환합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-152">Returns the job ID of the alert job.</span></span>|<span data-ttu-id="142d7-153">모니터 서버 또는 정의된 모니터가 없으면 주 서버 또는 보조 서버</span><span class="sxs-lookup"><span data-stu-id="142d7-153">Monitor server, or primary or secondary server if no monitor is defined</span></span>|  
|[<span data-ttu-id="142d7-154">sp_help_log_shipping_primary_database</span><span class="sxs-lookup"><span data-stu-id="142d7-154">sp_help_log_shipping_primary_database</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-primary-database-transact-sql)|<span data-ttu-id="142d7-155">주 데이터베이스 설정을 검색하고 **log_shipping_primary_databases** 및 **log_shipping_monitor_primary** 테이블의 값을 표시합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-155">Retrieves primary database settings and displays the values from the **log_shipping_primary_databases** and **log_shipping_monitor_primary** tables.</span></span>|<span data-ttu-id="142d7-156">주 서버</span><span class="sxs-lookup"><span data-stu-id="142d7-156">Primary server</span></span>|  
|[<span data-ttu-id="142d7-157">sp_help_log_shipping_primary_secondary</span><span class="sxs-lookup"><span data-stu-id="142d7-157">sp_help_log_shipping_primary_secondary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-primary-secondary-transact-sql)|<span data-ttu-id="142d7-158">주 데이터베이스의 보조 데이터베이스 이름을 검색합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-158">Retrieves secondary database names for a primary database.</span></span>|<span data-ttu-id="142d7-159">주 서버</span><span class="sxs-lookup"><span data-stu-id="142d7-159">Primary server</span></span>|  
|[<span data-ttu-id="142d7-160">sp_help_log_shipping_secondary_database</span><span class="sxs-lookup"><span data-stu-id="142d7-160">sp_help_log_shipping_secondary_database</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-secondary-database-transact-sql)|<span data-ttu-id="142d7-161">**log_shipping_secondary**, **log_shipping_secondary_databases** 및 **log_shipping_monitor_secondary** 테이블에서 보조 데이터베이스 설정을 검색합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-161">Retrieves secondary-database settings from the **log_shipping_secondary**, **log_shipping_secondary_databases** and **log_shipping_monitor_secondary** tables.</span></span>|<span data-ttu-id="142d7-162">보조 서버</span><span class="sxs-lookup"><span data-stu-id="142d7-162">Secondary server</span></span>|  
|[<span data-ttu-id="142d7-163">sp_help_log_shipping_secondary_primary&#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="142d7-163">sp_help_log_shipping_secondary_primary &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-secondary-primary-transact-sql)|<span data-ttu-id="142d7-164">이 저장 프로시저는 보조 서버에서 지정된 주 데이터베이스의 설정을 검색합니다.</span><span class="sxs-lookup"><span data-stu-id="142d7-164">This stored procedure retrieves the settings for a given primary database on the secondary server.</span></span>|<span data-ttu-id="142d7-165">보조 서버</span><span class="sxs-lookup"><span data-stu-id="142d7-165">Secondary server</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="142d7-166">참고 항목</span><span class="sxs-lookup"><span data-stu-id="142d7-166">See Also</span></span>  
 <span data-ttu-id="142d7-167">[로그 전달 보고서 보기&#40;SQL Server Management Studio&#41;](view-the-log-shipping-report-sql-server-management-studio.md) </span><span class="sxs-lookup"><span data-stu-id="142d7-167">[View the Log Shipping Report &#40;SQL Server Management Studio&#41;](view-the-log-shipping-report-sql-server-management-studio.md) </span></span>  
 [<span data-ttu-id="142d7-168">로그 전달 저장 프로시저 및 테이블</span><span class="sxs-lookup"><span data-stu-id="142d7-168">Log Shipping Stored Procedures and Tables</span></span>](log-shipping-tables-and-stored-procedures.md)  
  
  
